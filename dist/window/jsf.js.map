{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/main/typescript/impl/core/Const.ts","webpack:///./src/main/typescript/ext/monadish/index.ts","webpack:///./src/main/typescript/ext/monadish/DomQuery.ts","webpack:///./src/main/typescript/ext/monadish/Monad.ts","webpack:///./src/main/typescript/impl/util/Lang.ts","webpack:///./src/main/typescript/ext/monadish/Lang.ts","webpack:///./src/main/typescript/ext/monadish/Stream.ts","webpack:///./src/main/typescript/ext/monadish/SourcesCollectors.ts","webpack:///./src/main/typescript/impl/AjaxImpl.ts","webpack:///./src/main/typescript/impl/util/Assertions.ts","webpack:///./src/main/typescript/impl/xhrCore/ErrorData.ts","webpack:///./src/main/typescript/impl/xhrCore/EventData.ts","webpack:///./src/main/typescript/api/Jsf.ts","webpack:///./src/main/typescript/impl/xhrCore/XhrFormData.ts","webpack:///./src/main/typescript/api/myfaces.ts","webpack:///./src/main/typescript/impl/xhrCore/Response.ts","webpack:///./src/main/typescript/ext/monadish/XmlQuery.ts","webpack:///./src/main/typescript/impl/xhrCore/ResponseProcessor.ts","webpack:///./src/main/typescript/impl/i18n/Messages.ts","webpack:///./src/main/typescript/impl/core/ImplTypes.ts","webpack:///./src/main/typescript/impl/xhrCore/ResonseDataResolver.ts","webpack:///./src/main/typescript/impl/xhrCore/XhrRequest.ts","webpack:///./src/main/typescript/impl/util/AsyncQueue.ts","webpack:///./src/main/typescript/impl/util/ExtDomQuery.ts","webpack:///./src/main/typescript/impl/PushImpl.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","Const","IDENT_ALL","IDENT_NONE","IDENT_THIS","IDENT_FORM","P_PARTIAL_SOURCE","PARTIAL_ID","P_VIEWSTATE","P_VIEWROOT","P_VIEWHEAD","P_VIEWBODY","P_CLIENTWINDOW","P_AJAX","P_EXECUTE","P_RENDER","P_EVT","P_CLIENT_WINDOW","P_RESET_VALUES","P_WIN_ID","P_WINDOW_ID","ERROR","EVENT","ON_ERROR","ON_EVENT","BEGIN","COMPLETE","SUCCESS","SOURCE","STATUS","ERROR_NAME","ERROR_MESSAGE","RESPONSE_TEXT","RESPONSE_XML","HTTPERROR","EMPTY_RESPONSE","MALFORMEDXML","SERVER_ERROR","CLIENT_ERROR","TIMEOUT_EVENT","CTX_PARAM_MF_INTERNAL","CTX_PARAM_SRC_FRM_ID","CTX_PARAM_SRC_CTL_ID","CTX_PARAM_TR_TYPE","CTX_PARAM_PASS_THR","CTX_PARAM_DELAY","CTX_PARAM_TIMEOUT","CTX_PARAM_RST","CTX_PARAM_EXECUTE","STAGE_DEVELOPMENT","CONTENT_TYPE","HEAD_FACES_REQ","REQ_ACCEPT","VAL_AJAX","ENCODED_URL","REQ_TYPE_GET","REQ_TYPE_POST","STATE_EVT_BEGIN","STATE_EVT_TIMEOUT","STATE_EVT_COMPLETE","URL_ENCODED","MULTIPART","NO_TIMEOUT","STD_ACCEPT","TAG_HEAD","TAG_FORM","TAG_BODY","TAG_BEFORE","TAG_AFTER","TAG_ATTR","SEL_VIEWSTATE_ELEM","SEL_RESPONSE_XML","PHASE_PROCESS_RESPONSE","ERR_NO_PARTIAL_RESPONSE","ATTR_URL","ATTR_NAME","ATTR_VALUE","ATTR_ID","RESP_PARTIAL","RESP_TYPE_ERROR","RESP_TYPE_REDIRECT","RESP_TYPE_CHANGES","CMD_CHANGES","CMD_UPDATE","CMD_DELETE","CMD_INSERT","CMD_EVAL","CMD_ERROR","CMD_ATTRIBUTES","CMD_EXTENSION","CMD_REDIRECT","UPDATE_FORMS","UPDATE_ELEMS","MYFACES","SEL_SCRIPTS_STYLES","MF_NONE","REASON_EXPIRED","APPLIED_VST","RECONNECT_INTERVAL","MAX_RECONNECT_ATTEMPTS","HTML_VIEWSTATE","join","EMPTY_FUNC","freeze","EMPTY_STR","EMPTY_MAP","DomQuery_1","DomQuery","ElementAttribute","DomQueryCollector","DQ","Lang_1","Lang","Monad_1","Config","Monad","Optional","ValueEmbedder","XmlQuery_1","XMLQuery","XQ","Stream_1","Stream","LazyStream","SourcesCollectors_1","ArrayStreamDataSource","MappedStreamDataSource","FilteredStreamDatasource","FlatMapStreamDataSource","QueryFormStringCollector","ArrayCollector","AssocArrayCollector","FormDataCollector","QueryFormDataCollector","extendStatics","__extends","this","b","setPrototypeOf","__proto__","Array","__","constructor","__spreadArrays","il","arguments","length","k","a","j","jl","trim","objToArray","isString","equalsIgnoreCase","_super","element","defaultVal","_this","_a","val","orElse","apply","values","getAttribute","set","cnt","setAttribute","configurable","getClass","fromNullable","valueKey","DEFAULT_JSF_WHITELIST","src","indexOf","rootNode","_i","pos","_limits","isAbsent","foundElement","querySelectorAll","push","getAsElem","allElems","getIf","isTag","tagName","nodeName","toLowerCase","isPresent","absent","of","allMatch","el","checked","newChecked","eachElem","stream","flatMap","item","formElement","elements","filter","collect","orElseLazy","attr","disabled","removeAttribute","childNodeArr","concat","childNodes","asArray","ofStreamDataSource","ret","each","selector","document","byId","byTagName","globalEval","code","nonce","fromMarkup","markup","doc","implementation","createHTMLDocument","lowerMarkup","documentElement","innerHTML","startsWithTag","str","tag1","tag2","dummyPlaceHolder","createElement","html","detach","index","defaults","presentRunnable","ifPresentLazy","delete","node","parentNode","removeChild","_b","_c","nodes","res","id","includeRoot","defaultValue","hasClass","clazz","hasIt","oldClass","oldClasses","split","found","addClass","removeClass","newClasses","isMultipartCandidate","firstElem","inval","innerHtml","retArr","elem","inVal","_mozMatchesSelector","toMatch","prot","matchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector","webkitMatchesSelector","matches","window","ownerDocument","filterSelector","matched","nodeSelector","selectorStage","func","len","first","reArr","head","getElementsByTagName","script","type","newScriptElement","appendChild","appendTo","theItem","loadScriptEval","defer","charSet","xhr","XMLHttpRequest","open","setRequestHeader","send","onload","responseData","setTimeout","responseText","replace","onerror","data","Error","insertAfter","toInsertParams","existingItem","existingElement","_loop_1","nextSibling","insertElem","insertBefore","elseValue","parents","retSet","Set","lowerTagName","resolveItem","has","add","copyAttrs","sourceItem","sourceNode","attrs_1","attributes","name_1","resolveAttributeHolder","attrName","outerHTML","runEmbeddedScripts","runEmbeddedCss","focusElementId","activeElement","caretPosition","getCaretPosition","toReplace","firstInsert","replaced","replaceChild","insertAdditionalItems","slice","runScripts","runCss","focusElement","setCaretPosition","whilteListed","finalScripts","equi","execScrpt","itemType","evalText","text","innerText","go","substring","sort","node1","node2","compareDocumentPosition","e","console","error","message","description","applyStyle","style","_d","_e","newSS","styleSheet","sheet","cssText","createTextNode","execCss","click","fireEvent","addEventListener","listener","options","removeEventListener","eventName","nodeType","dispatchEvent","eventClass","event_1","createEvent","initEvent","synthetic","event_2","createEventObject","textContent","joinstr","map","reduce","text1","text2","encodeFormElement","toMerge","target","shallowCopy","elemType","selectElem","selectedIndex","uLen","u","selected","elementOption","assign","files","inputValue","reduced","subNodes","from","to","Math","min","limits","end","hasNext","isLimitsReached","isEndOfArray","next","reset","ctrl","caretPos","selection","focus","createRange","moveStart","range","createTextRange","collapse","moveEnd","select","objAssign","_value","fn","mapped","currentPos","currKey","keyVal","arrPos","arrayIndex","getIfPresent","match","toJson","JSON","stringify","start","parseInt","resolve","resolver","rootElem","newVal","alternative","ConfigEntry","root","ofAssoc","shallowMerge","other","overwrite","keys","buildPath","retVal","assignIf","condition","setVal","parentVal","parentPos","alloc","arr","length1","length2","tempVal","Messages_1","monadish_1","ExtLang","installedLocale","nameSpace","getMessage","defaultMessage","templateParams","msg","Messages","param","RegExp","getEvent","evt","event","makeException","title","callerCls","callFunc","caller","toString","getLanguage","language","navigator","languages","failSaveResolve","resolverProducer","saveResolve","failSaveExecute","keyValToStr","delimiter","getEventTarget","srcElement","source","getGlobalConfig","configName","myfaces","config","getLocalOrGlobalConfig","localOptions","_f","_g","_h","getForm","FORM","queryElem","eventTarget","formId","foundForm","form","assertFormExists","ws","test","charAt","it","String","result","saveResolveLazy","strToArray","splitter","forEach","obj","offset","pack","destination","finalDest","assertType","probe","theType","isFunc","Function","theArgs","TypeError","nextSource","nextKey","ofDataSource","dataSource","onElem","strmR","isArray","startVal","val1","last","anyMatch","noneMatch","comparator","newArr","collector","finalValue","parent","isOverLimits","nextFilter","max","stop","value1","value2","el1","el2","dataPos","filterFunc","filteredNext","inputDataSource","mapFunc","resolveCurrentNext","resolveNextNext","activeDataSource","FormData","append","formData","item1","item2","ProjectStages","BlockFilter","myfacesConfig","Response_1","XhrRequest_1","AsyncQueue_1","Const_1","Assertions_1","XhrFormData_1","ExtDomQuery_1","ErrorData_1","Implementation","assert","Assertions","eventQueue","errorQueue","requestQueue","threshold","resolveProjectStateFromURL","foundStage","ExtDomquery","searchJsfJsFor","sendError","errorData","localHandler","errorCallback","alert","displayError","transformValues","targetConfig","targetKey","userValues","issuingForm","issuingElementId","iterValues","processed","queueHandler","addRequestToQueue","reqCtx","respPassThr","delay","timeout","AsynchronouseQueue","enqueue","XhrRequest","getSeparatorChar","globalConfig","separator","getProjectStage","projectStage","chain","funcs","sourceCode","resolveAndExecute","request","opts","mappedOpts","deepCopy","elementId","requestCtx","internalCtx","assertRequestIntegrity","windowId","applyWindowId","onevent","configId","resolveForm","resetValues","ctx","clientWindow","jsf","getClientWindow","applyClientWindowId","applyExecute","applyRender","getCfg","resolveDelay","resolveTimeout","response","context","Response","processResponse","addOnError","errorListener","addOnEvent","eventListener","sendEvent","stdErrorHandler","exception","clearRequestQueue","ErrorData","fromClient","cleanup","ALTERED","searchRoot","body","formWindowId","getViewState","XhrFormData","raiseError","assertFunction","assertUrlExists","assertValidXMLResponse","responseXML","isXMLParserError","parserErrorText","finalTitle","finalName","finalMessage","ErrorType","EventData_1","errorName","errorMessage","responseCode","status","typeDetails","serverErrorName","serverErrorMessage","stack","fromHttpConnection","HTTP_ERROR","fromGeneric","errorCode","errorType","getMsg","fromServerError","EventData","createFromRequest","eventData","sourceId","AjaxImpl_1","PushImpl_1","mf_impl","_impl","specversion","implversion","separatorchar","ajax","errorFunc","eventFunc","util","init","socketClientId","uri","channel","onopen","onmessage","onclose","behaviorScripts","autoconnect","PushImpl","close","myfaces2","ab","execute","render","partialIdsArray","handleStringSource","handleFormSource","encodeSubmittableFields","applyViewState","mergeEncodedString","encoded","splittedEntries","line","toFormData","defaultStr","entries","targetBuf","parentItem","partialIds","toEncode","ConfigHolder","ResponseProcessor_1","ResonseDataResolver_1","resolveResponseXML","ResonseDataResolver","resolveContexts","req","externalContext","internalContext","responseProcessor","ResponseProcessor","SEL_SUB_TAGS","redirect","ALLOWED_TAGS","processViewState","cdataBlock","cDATAAsString","replaceViewRoot","replaceHead","replaceBody","update","handleElementUpdate","processUpdateTag","eval","processInsert","processChangesTag","processPartialTag","fixViewStates","done","insertWithSubtags","insert","docType","xml","DOMParser","parser","ActiveXObject","async","parseFromString","contentType","loadXML","serialized","XMLSerializer","serializeToString","parseXML","txt","parseHTML","fromString","parseType","ImplTypes_1","shadowDocument","shadowHead","storeForEval","shadowBody","shadowInnerHTML","resultingBody","updateForms","storeForPostProcessing","mergedErrorData","hasResponseXML","redirectUrl","location","href","sourceForm","before","after","insertNodes","insertId","isViewStateNode","viewStateValue","ViewState","updateElems","affectedForms","affectedForms2","appendViewStateToForms","eventHandler","isAllFormResolution","forms","viewState","newViewStateElement","newViewState","toBeEvaled","storeForUpdate","_j","_k","MSG_TEST","MSG_DEV_MODE","MSG_AFFECTED_CLASS","MSG_AFFECTED_METHOD","MSG_ERROR_NAME","MSG_ERROR_MESSAGE","MSG_SERVER_ERROR_NAME","MSG_ERROR_DESC","MSG_ERROR_NO","MSG_ERROR_LINENO","ERR_FORM","ERR_VIEWSTATE","ERR_TRANSPORT","ERR_EVT_PASS","ERR_CONSTRUCT","ERR_MALFORMEDXML","ERR_SOURCE_FUNC","ERR_EV_OR_UNKNOWN","ERR_SOURCE_NOSTR","ERR_SOURCE_DEF_NULL","ERR_MUST_STRING","ERR_REF_OR_ID","ERR_PARAM_GENERIC","ERR_PARAM_STR","ERR_PARAM_STR_RE","ERR_PARAM_MIXMAPS","ERR_MUST_BE_PROVIDED","ERR_MUST_BE_PROVIDED1","ERR_REPLACE_EL","ERR_EMPTY_RESPONSE","ERR_ITEM_ID_NOTFOUND","ERR_PPR_IDREQ","ERR_PPR_INSERTBEFID","ERR_PPR_INSERTBEFID_1","ERR_PPR_INSERTBEFID_2","ERR_PPR_DELID","ERR_PPR_UNKNOWNCID","ERR_NO_VIEWROOTATTR","ERR_NO_HEADATTR","ERR_RED_URL","ERR_REQ_FAILED_UNKNOWN","ERR_REQU_FAILED","UNKNOWN","viewStatePos","substr","resolveSourceElement","elemId","resolveSourceElementId","resolveSourceForm","sourceFormId","requestContext","ajaxType","xhrObject","stopProgress","catchFuncs","thenFunc","registerXhrCallbacks","reject","fsExec","isMultipartRequest","passThroughParams","responseContext","resolveFinalUrl","sendRequest","handleError","cancel","abort","inputVal","catchFunc","catch","finally","then","onabort","onAbort","ontimeout","onTimeout","onSuccess","onloadend","onDone","onError","handleMalFormedXML","evtType","resolveHandlerFunc","funcName","resolveTargetUrl","srcFormElement","action","isPost","runnableQueue","delayTimeout","clearTimeout","appendElement","dequeue","shift","currentlyRunning","runEntry","isEmpty","callForNextElementToProcess","processNextElement","EVT_NEXT","fetchWindowIdFromURL","results","exec","curScript","currentScript","nonceScript","lazyStream","rexp","search","decodeURIComponent","ExtDQ","Jsf_1","URL_PROTOCOL","protocol","sockets","components","clientIdsByTokens","resolveFunction","WebSocket","channelToken","Socket","url","base","hostname","port","getBaseURL","getSocket","reconnectAttempts","socket","readyState","bindCallbacks","clientIds","onmmessage","parse","getElementById","functions","splice","reason"],"mappings":"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","file":"jsf.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 12);\n","\"use strict\";\r\n/* Licensed to the Apache Software Foundation (ASF) under one or more\r\n * contributor license agreements.  See the NOTICE file distributed with\r\n * this work for additional information regarding copyright ownership.\r\n * The ASF licenses this file to you under the Apache License, Version 2.0\r\n * (the \"License\"); you may not use this file except in compliance with\r\n * the License.  You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Const;\r\n(function (Const) {\r\n    /*internal identifiers for options*/\r\n    Const.IDENT_ALL = \"@all\";\r\n    Const.IDENT_NONE = \"@none\";\r\n    Const.IDENT_THIS = \"@this\";\r\n    Const.IDENT_FORM = \"@form\";\r\n    /*\r\n     * [export const] constants\r\n     */\r\n    Const.P_PARTIAL_SOURCE = \"javax.faces.source\";\r\n    Const.PARTIAL_ID = \"partialId\";\r\n    Const.P_VIEWSTATE = \"javax.faces.ViewState\";\r\n    Const.P_VIEWROOT = \"javax.faces.ViewRoot\";\r\n    Const.P_VIEWHEAD = \"javax.faces.ViewHead\";\r\n    Const.P_VIEWBODY = \"javax.faces.ViewBody\";\r\n    Const.P_CLIENTWINDOW = \"javax.faces.ClientWindow\";\r\n    Const.P_AJAX = \"javax.faces.partial.ajax\";\r\n    Const.P_EXECUTE = \"javax.faces.partial.execute\";\r\n    Const.P_RENDER = \"javax.faces.partial.render\";\r\n    Const.P_EVT = \"javax.faces.partial.event\";\r\n    Const.P_CLIENT_WINDOW = \"javax.faces.ClientWindow\";\r\n    Const.P_RESET_VALUES = \"javax.faces.partial.resetValues\";\r\n    Const.P_WIN_ID = \"javax.faces.WindowId\";\r\n    Const.P_WINDOW_ID = \"javax.faces.windowId\";\r\n    /* message types */\r\n    Const.ERROR = \"error\";\r\n    Const.EVENT = \"event\";\r\n    Const.ON_ERROR = \"onerror\";\r\n    Const.ON_EVENT = \"onevent\";\r\n    /* event emitting stages */\r\n    Const.BEGIN = \"begin\";\r\n    Const.COMPLETE = \"complete\";\r\n    Const.SUCCESS = \"success\";\r\n    Const.SOURCE = \"source\";\r\n    Const.STATUS = \"status\";\r\n    Const.ERROR_NAME = \"error-name\";\r\n    Const.ERROR_MESSAGE = \"error-message\";\r\n    Const.RESPONSE_TEXT = \"responseText\";\r\n    Const.RESPONSE_XML = \"responseXML\";\r\n    /*ajax errors spec 14.4.2*/\r\n    Const.HTTPERROR = \"httpError\";\r\n    Const.EMPTY_RESPONSE = \"emptyResponse\";\r\n    Const.MALFORMEDXML = \"malformedXML\";\r\n    Const.SERVER_ERROR = \"serverError\";\r\n    Const.CLIENT_ERROR = \"clientError\";\r\n    Const.TIMEOUT_EVENT = \"timeout\";\r\n    Const.CTX_PARAM_MF_INTERNAL = \"_mfInternal\";\r\n    Const.CTX_PARAM_SRC_FRM_ID = \"_mfSourceFormId\";\r\n    Const.CTX_PARAM_SRC_CTL_ID = \"_mfSourceControlId\";\r\n    Const.CTX_PARAM_TR_TYPE = \"_mfTransportType\";\r\n    Const.CTX_PARAM_PASS_THR = \"passThrgh\";\r\n    Const.CTX_PARAM_DELAY = \"delay\";\r\n    Const.CTX_PARAM_TIMEOUT = \"timeout\";\r\n    Const.CTX_PARAM_RST = \"resetValues\";\r\n    Const.CTX_PARAM_EXECUTE = \"execute\";\r\n    Const.STAGE_DEVELOPMENT = \"Development\";\r\n    Const.CONTENT_TYPE = \"Content-Type\";\r\n    Const.HEAD_FACES_REQ = \"Faces-Request\";\r\n    Const.REQ_ACCEPT = \"Accept\";\r\n    Const.VAL_AJAX = \"partial/ajax\";\r\n    Const.ENCODED_URL = \"javax.faces.encodedURL\";\r\n    Const.REQ_TYPE_GET = \"GET\";\r\n    Const.REQ_TYPE_POST = \"POST\";\r\n    Const.STATE_EVT_BEGIN = \"begin\"; //TODO remove this\r\n    Const.STATE_EVT_TIMEOUT = \"TIMEOUT_EVENT\";\r\n    Const.STATE_EVT_COMPLETE = \"complete\"; //TODO remove this\r\n    Const.URL_ENCODED = \"application/x-www-form-urlencoded\";\r\n    Const.MULTIPART = \"multipart/form-data\";\r\n    Const.NO_TIMEOUT = 0;\r\n    Const.STD_ACCEPT = \"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\";\r\n    Const.TAG_HEAD = \"head\";\r\n    Const.TAG_FORM = \"form\";\r\n    Const.TAG_BODY = \"body\";\r\n    Const.TAG_BEFORE = \"before\";\r\n    Const.TAG_AFTER = \"after\";\r\n    Const.TAG_ATTR = \"attribute\";\r\n    Const.SEL_VIEWSTATE_ELEM = \"[name='\" + Const.P_VIEWSTATE + \"']\";\r\n    Const.SEL_RESPONSE_XML = \"responseXML\";\r\n    Const.PHASE_PROCESS_RESPONSE = \"processResponse\";\r\n    Const.ERR_NO_PARTIAL_RESPONSE = \"Partial response not set\";\r\n    Const.ATTR_URL = \"url\";\r\n    Const.ATTR_NAME = \"name\";\r\n    Const.ATTR_VALUE = \"value\";\r\n    Const.ATTR_ID = \"id\";\r\n    /*partial response types*/\r\n    Const.RESP_PARTIAL = \"partial-response\";\r\n    Const.RESP_TYPE_ERROR = \"error\";\r\n    Const.RESP_TYPE_REDIRECT = \"redirect\";\r\n    Const.RESP_TYPE_CHANGES = \"changes\";\r\n    /*partial commands*/\r\n    Const.CMD_CHANGES = \"changes\";\r\n    Const.CMD_UPDATE = \"update\";\r\n    Const.CMD_DELETE = \"delete\";\r\n    Const.CMD_INSERT = \"insert\";\r\n    Const.CMD_EVAL = \"eval\";\r\n    Const.CMD_ERROR = \"error\";\r\n    Const.CMD_ATTRIBUTES = \"attributes\";\r\n    Const.CMD_EXTENSION = \"extension\";\r\n    Const.CMD_REDIRECT = \"redirect\";\r\n    /*other constants*/\r\n    Const.UPDATE_FORMS = \"_updateForms\";\r\n    Const.UPDATE_ELEMS = \"_updateElems\";\r\n    Const.MYFACES = \"myfaces\";\r\n    Const.SEL_SCRIPTS_STYLES = \"script, style, link\";\r\n    Const.MF_NONE = \"__mf_none__\";\r\n    Const.REASON_EXPIRED = \"Expired\";\r\n    Const.APPLIED_VST = \"appliedViewState\";\r\n    Const.RECONNECT_INTERVAL = 500;\r\n    Const.MAX_RECONNECT_ATTEMPTS = 25;\r\n    Const.HTML_VIEWSTATE = [\"<input type='hidden'\", \"id='\", Const.P_VIEWSTATE, \"' name='\", Const.P_VIEWSTATE, \"' value='' />\"].join(\"\");\r\n    Const.EMPTY_FUNC = Object.freeze(function () { });\r\n    Const.EMPTY_STR = \"\";\r\n    Const.EMPTY_MAP = Object.freeze({});\r\n})(Const = exports.Const || (exports.Const = {}));\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar DomQuery_1 = require(\"./DomQuery\");\r\nexports.DomQuery = DomQuery_1.DomQuery;\r\nexports.ElementAttribute = DomQuery_1.ElementAttribute;\r\nexports.DomQueryCollector = DomQuery_1.DomQueryCollector;\r\nexports.DQ = DomQuery_1.DQ;\r\nvar Lang_1 = require(\"./Lang\");\r\nexports.Lang = Lang_1.Lang;\r\nvar Monad_1 = require(\"./Monad\");\r\nexports.Config = Monad_1.Config;\r\nexports.Monad = Monad_1.Monad;\r\nexports.Optional = Monad_1.Optional;\r\nexports.ValueEmbedder = Monad_1.ValueEmbedder;\r\nvar XmlQuery_1 = require(\"./XmlQuery\");\r\nexports.XMLQuery = XmlQuery_1.XMLQuery;\r\nexports.XQ = XmlQuery_1.XQ;\r\nvar Stream_1 = require(\"./Stream\");\r\nexports.Stream = Stream_1.Stream;\r\nexports.LazyStream = Stream_1.LazyStream;\r\nvar SourcesCollectors_1 = require(\"./SourcesCollectors\");\r\nexports.ArrayStreamDataSource = SourcesCollectors_1.ArrayStreamDataSource;\r\nexports.MappedStreamDataSource = SourcesCollectors_1.MappedStreamDataSource;\r\nexports.FilteredStreamDatasource = SourcesCollectors_1.FilteredStreamDatasource;\r\nexports.FlatMapStreamDataSource = SourcesCollectors_1.FlatMapStreamDataSource;\r\nexports.QueryFormStringCollector = SourcesCollectors_1.QueryFormStringCollector;\r\nexports.ArrayCollector = SourcesCollectors_1.ArrayCollector;\r\nexports.AssocArrayCollector = SourcesCollectors_1.AssocArrayCollector;\r\nexports.FormDataCollector = SourcesCollectors_1.FormDataCollector;\r\nexports.QueryFormDataCollector = SourcesCollectors_1.QueryFormDataCollector;\r\n","\"use strict\";\r\n/* Licensed to the Apache Software Foundation (ASF) under one or more\r\n * contributor license agreements.  See the NOTICE file distributed with\r\n * this work for additional information regarding copyright ownership.\r\n * The ASF licenses this file to you under the Apache License, Version 2.0\r\n * (the \"License\"); you may not use this file except in compliance with\r\n * the License.  You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Monad_1 = require(\"./Monad\");\r\nvar Stream_1 = require(\"./Stream\");\r\nvar Lang_1 = require(\"./Lang\");\r\nvar trim = Lang_1.Lang.trim;\r\nvar objToArray = Lang_1.Lang.objToArray;\r\nvar isString = Lang_1.Lang.isString;\r\nvar equalsIgnoreCase = Lang_1.Lang.equalsIgnoreCase;\r\n// @ts-ignore supression needed here due to fromnullable\r\nvar ElementAttribute = /** @class */ (function (_super) {\r\n    __extends(ElementAttribute, _super);\r\n    function ElementAttribute(element, name, defaultVal) {\r\n        if (defaultVal === void 0) { defaultVal = null; }\r\n        var _this = _super.call(this, element, name) || this;\r\n        _this.element = element;\r\n        _this.name = name;\r\n        _this.defaultVal = defaultVal;\r\n        return _this;\r\n    }\r\n    Object.defineProperty(ElementAttribute.prototype, \"value\", {\r\n        get: function () {\r\n            var _a;\r\n            var val = (_a = this.element.get(0)).orElse.apply(_a, []).values;\r\n            if (!val.length) {\r\n                return this.defaultVal;\r\n            }\r\n            return val[0].getAttribute(this.name);\r\n        },\r\n        set: function (value) {\r\n            var _a;\r\n            var val = (_a = this.element.get(0)).orElse.apply(_a, []).values;\r\n            for (var cnt = 0; cnt < val.length; cnt++) {\r\n                val[cnt].setAttribute(this.name, value);\r\n            }\r\n            val[0].setAttribute(this.name, value);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ElementAttribute.prototype.getClass = function () {\r\n        return ElementAttribute;\r\n    };\r\n    ElementAttribute.fromNullable = function (value, valueKey) {\r\n        if (valueKey === void 0) { valueKey = \"value\"; }\r\n        return new ElementAttribute(value, valueKey);\r\n    };\r\n    return ElementAttribute;\r\n}(Monad_1.ValueEmbedder));\r\nexports.ElementAttribute = ElementAttribute;\r\n/**\r\n * small helper for the specialized jsf case\r\n * @param src\r\n * @constructor\r\n */\r\nvar DEFAULT_JSF_WHITELIST = function (src) {\r\n    return (src.indexOf(\"ln=scripts\") == -1 &&\r\n        src.indexOf(\"ln=javax.faces\") == -1) ||\r\n        (src.indexOf(\"/jsf.js\") == -1 &&\r\n            src.indexOf(\"/jsf-uncompressed.js\") == -1);\r\n};\r\n/**\r\n * Monadic DomNode representation, ala jquery\r\n * This is a thin wrapper over querySelectorAll\r\n * to get slim monadic support\r\n * to reduce implementation code on the users side.\r\n * This is vital for frameworks which want to rely on\r\n * plain dom but still do not want to lose\r\n * the reduced code footprint of querying dom trees and traversing\r\n * by using functional patterns.\r\n *\r\n * Also a few convenience methods are added to reduce\r\n * the code footprint of standard dom processing\r\n * operations like eval\r\n *\r\n * TODO add jquery fallback support, since it is supported\r\n * in most older systems\r\n * Note parts of this code still stem from the Dom.js I have written 10 years\r\n * ago, those parts look a little bit ancient and will be replaced over time.\r\n *\r\n */\r\nvar DomQuery = /** @class */ (function () {\r\n    function DomQuery() {\r\n        var _a;\r\n        var rootNode = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            rootNode[_i] = arguments[_i];\r\n        }\r\n        this.rootNode = [];\r\n        this.pos = -1;\r\n        this._limits = -1;\r\n        if (Monad_1.Optional.fromNullable(rootNode).isAbsent() || !rootNode.length) {\r\n            return;\r\n        }\r\n        else {\r\n            //we need to flatten out the arrays\r\n            for (var cnt = 0; cnt < rootNode.length; cnt++) {\r\n                if (isString(rootNode[cnt])) {\r\n                    var foundElement = DomQuery.querySelectorAll(rootNode[cnt]);\r\n                    if (!foundElement.isAbsent()) {\r\n                        rootNode.push.apply(rootNode, foundElement.values);\r\n                    }\r\n                }\r\n                else if (rootNode[cnt] instanceof DomQuery) {\r\n                    (_a = this.rootNode).push.apply(_a, rootNode[cnt].values);\r\n                }\r\n                else {\r\n                    this.rootNode.push(rootNode[cnt]);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    Object.defineProperty(DomQuery.prototype, \"value\", {\r\n        /**\r\n         * returns the first element\r\n         */\r\n        get: function () {\r\n            return this.getAsElem(0);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(DomQuery.prototype, \"values\", {\r\n        get: function () {\r\n            return this.allElems();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(DomQuery.prototype, \"id\", {\r\n        /**\r\n         * returns the id of the first element\r\n         */\r\n        get: function () {\r\n            return new ElementAttribute(this.get(0), \"id\");\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(DomQuery.prototype, \"length\", {\r\n        /**\r\n         * length of the entire query set\r\n         */\r\n        get: function () {\r\n            return this.rootNode.length;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(DomQuery.prototype, \"tagName\", {\r\n        /**\r\n         * convenience method for tagName\r\n         */\r\n        get: function () {\r\n            return this.getAsElem(0).getIf(\"tagName\");\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(DomQuery.prototype, \"nodeName\", {\r\n        /**\r\n         * convenience method for nodeName\r\n         */\r\n        get: function () {\r\n            return this.getAsElem(0).getIf(\"nodeName\");\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    DomQuery.prototype.isTag = function (tagName) {\r\n        return !this.isAbsent()\r\n            && (this.nodeName.orElse(\"__none___\")\r\n                .value.toLowerCase() == tagName.toLowerCase()\r\n                || this.tagName.orElse(\"__none___\")\r\n                    .value.toLowerCase() == tagName.toLowerCase());\r\n    };\r\n    Object.defineProperty(DomQuery.prototype, \"type\", {\r\n        /**\r\n         * convenience property for type\r\n         *\r\n         * returns null in case of no type existing otherwise\r\n         * the type of the first element\r\n         */\r\n        get: function () {\r\n            return this.getAsElem(0).getIf(\"type\");\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(DomQuery.prototype, \"name\", {\r\n        /**\r\n         * convenience property for name\r\n         *\r\n         * returns null in case of no type existing otherwise\r\n         * the name of the first element\r\n         */\r\n        get: function () {\r\n            return new Monad_1.ValueEmbedder(this.getAsElem(0).value, \"name\");\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(DomQuery.prototype, \"inputValue\", {\r\n        /**\r\n         * convenience property for value\r\n         *\r\n         * returns null in case of no type existing otherwise\r\n         * the value of the first element\r\n         */\r\n        get: function () {\r\n            if (this.getAsElem(0).getIf(\"value\").isPresent()) {\r\n                return new Monad_1.ValueEmbedder(this.getAsElem(0).value);\r\n            }\r\n            else {\r\n                return Monad_1.ValueEmbedder.absent;\r\n            }\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(DomQuery.prototype, \"checked\", {\r\n        get: function () {\r\n            return Stream_1.Stream.of.apply(Stream_1.Stream, this.values).allMatch(function (el) { return !!el.checked; });\r\n        },\r\n        set: function (newChecked) {\r\n            this.eachElem(function (el) { return el.checked = newChecked; });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(DomQuery.prototype, \"elements\", {\r\n        get: function () {\r\n            var _this = this;\r\n            var elements = this.stream.flatMap(function (item) {\r\n                var formElement = item.value.value;\r\n                return new Stream_1.Stream(formElement.elements ? objToArray(formElement.elements) : []);\r\n            }).filter(function (item) { return !!item; }).collect(new DomQueryCollector());\r\n            return elements\r\n                .orElseLazy(function () { return _this.querySelectorAll(\"input, select, textarea, fieldset\"); });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(DomQuery.prototype, \"disabled\", {\r\n        /**\r\n         * todo align this api with the rest of the apis\r\n         */\r\n        get: function () {\r\n            return this.attr(\"disabled\").isPresent();\r\n        },\r\n        set: function (disabled) {\r\n            // this.attr(\"disabled\").value = disabled + \"\";\r\n            if (!disabled) {\r\n                this.removeAttribute(\"disabled\");\r\n            }\r\n            else {\r\n                this.attr(\"disabled\").value = \"disabled\";\r\n            }\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    DomQuery.prototype.removeAttribute = function (name) {\r\n        this.eachElem(function (item) { return item.removeAttribute(name); });\r\n    };\r\n    Object.defineProperty(DomQuery.prototype, \"childNodes\", {\r\n        get: function () {\r\n            var childNodeArr = [];\r\n            this.eachElem(function (item) {\r\n                childNodeArr = childNodeArr.concat(objToArray(item.childNodes));\r\n            });\r\n            return new (DomQuery.bind.apply(DomQuery, __spreadArrays([void 0], childNodeArr)))();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(DomQuery.prototype, \"stream\", {\r\n        /**\r\n         * binding into stream\r\n         */\r\n        get: function () {\r\n            return new (Stream_1.Stream.bind.apply(Stream_1.Stream, __spreadArrays([void 0], this.asArray)))();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(DomQuery.prototype, \"lazyStream\", {\r\n        /**\r\n         * fetches a lazy stream representation\r\n         * lazy should be applied if you have some filters etc\r\n         * in between, this can reduce the number of post filter operations\r\n         * and ram usage\r\n         * significantly because the operations are done lazily and stop\r\n         * once they hit a dead end.\r\n         */\r\n        get: function () {\r\n            return Stream_1.LazyStream.ofStreamDataSource(this);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(DomQuery.prototype, \"asArray\", {\r\n        get: function () {\r\n            var ret = [];\r\n            this.each(function (item) {\r\n                ret.push(item);\r\n            });\r\n            return ret;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * easy query selector all producer\r\n     *\r\n     * @param selector the selector\r\n     * @returns a results dom query object\r\n     */\r\n    DomQuery.querySelectorAll = function (selector) {\r\n        return new DomQuery(document).querySelectorAll(selector);\r\n    };\r\n    /**\r\n     * byId producer\r\n     *\r\n     * @param selector id\r\n     * @return a DomQuery containing the found elements\r\n     */\r\n    DomQuery.byId = function (selector) {\r\n        if (isString(selector)) {\r\n            return new DomQuery(document).byId(selector);\r\n        }\r\n        else {\r\n            return new DomQuery(selector);\r\n        }\r\n    };\r\n    /**\r\n     * byTagName producer\r\n     *\r\n     * @param selector name\r\n     * @return a DomQuery containing the found elements\r\n     */\r\n    DomQuery.byTagName = function (selector) {\r\n        if (isString(selector)) {\r\n            return new DomQuery(document).byTagName(selector);\r\n        }\r\n        else {\r\n            return new DomQuery(selector);\r\n        }\r\n    };\r\n    DomQuery.globalEval = function (code, nonce) {\r\n        return new DomQuery(document).globalEval(code, nonce);\r\n    };\r\n    /**\r\n     * builds the ie nodes properly in a placeholder\r\n     * and bypasses a non script insert bug that way\r\n     * @param markup the marku code\r\n     */\r\n    DomQuery.fromMarkup = function (markup) {\r\n        //https://developer.mozilla.org/de/docs/Web/API/DOMParser license creative commons\r\n        var doc = document.implementation.createHTMLDocument(\"\");\r\n        markup = trim(markup);\r\n        var lowerMarkup = markup.toLowerCase();\r\n        if (lowerMarkup.indexOf('<!doctype') != -1 ||\r\n            lowerMarkup.indexOf('<html') != -1 ||\r\n            lowerMarkup.indexOf('<head') != -1 || //TODO proper regexps here to avoid embedded tags with same element names to be triggered\r\n            lowerMarkup.indexOf('<body') != -1) {\r\n            doc.documentElement.innerHTML = markup;\r\n            return new DomQuery(doc.documentElement);\r\n        }\r\n        else {\r\n            var startsWithTag = function (str, tagName) {\r\n                var tag1 = [\"<\", tagName, \">\"].join(\"\");\r\n                var tag2 = [\"<\", tagName, \" \"].join(\"\");\r\n                return (str.indexOf(tag1) == 0) || (str.indexOf(tag2) == 0);\r\n            };\r\n            var dummyPlaceHolder = new DomQuery(document.createElement(\"div\"));\r\n            //table needs special treatment due to the browsers auto creation\r\n            if (startsWithTag(lowerMarkup, \"thead\") || startsWithTag(lowerMarkup, \"tbody\")) {\r\n                dummyPlaceHolder.html(\"<table>\" + markup + \"</table>\");\r\n                return dummyPlaceHolder.querySelectorAll(\"table\").get(0).childNodes.detach();\r\n            }\r\n            else if (startsWithTag(lowerMarkup, \"tfoot\")) {\r\n                dummyPlaceHolder.html(\"<table><thead></thead><tbody><tbody\" + markup + \"</table>\");\r\n                return dummyPlaceHolder.querySelectorAll(\"table\").get(2).childNodes.detach();\r\n            }\r\n            else if (startsWithTag(lowerMarkup, \"tr\")) {\r\n                dummyPlaceHolder.html(\"<table><tbody>\" + markup + \"</tbody></table>\");\r\n                return dummyPlaceHolder.querySelectorAll(\"tbody\").get(0).childNodes.detach();\r\n            }\r\n            else if (startsWithTag(lowerMarkup, \"td\")) {\r\n                dummyPlaceHolder.html(\"<table><tbody><tr>\" + markup + \"</tr></tbody></table>\");\r\n                return dummyPlaceHolder.querySelectorAll(\"tr\").get(0).childNodes.detach();\r\n            }\r\n            dummyPlaceHolder.html(markup);\r\n            return dummyPlaceHolder.childNodes.detach();\r\n        }\r\n    };\r\n    /**\r\n     * returns the nth element as domquery\r\n     * from the internal elements\r\n     * note if you try to reach a non existing element position\r\n     * you will get back an absent entry\r\n     *\r\n     * @param index the nth index\r\n     */\r\n    DomQuery.prototype.get = function (index) {\r\n        return (index < this.rootNode.length) ? new DomQuery(this.rootNode[index]) : DomQuery.absent;\r\n    };\r\n    /**\r\n     * returns the nth element as optional of an Element object\r\n     * @param index the number from the index\r\n     * @param defaults the default value if the index is overrun default Optional.absent\r\n     */\r\n    DomQuery.prototype.getAsElem = function (index, defaults) {\r\n        if (defaults === void 0) { defaults = Monad_1.Optional.absent; }\r\n        return (index < this.rootNode.length) ? Monad_1.Optional.fromNullable(this.rootNode[index]) : defaults;\r\n    };\r\n    /**\r\n     * returns the value array< of all elements\r\n     */\r\n    DomQuery.prototype.allElems = function () {\r\n        return this.rootNode;\r\n    };\r\n    /**\r\n     * absent no values reached?\r\n     */\r\n    DomQuery.prototype.isAbsent = function () {\r\n        return this.length == 0;\r\n    };\r\n    /**\r\n     * should make the code clearer\r\n     * note if you pass a function\r\n     * this refers to the active dopmquery object\r\n     */\r\n    DomQuery.prototype.isPresent = function (presentRunnable) {\r\n        var absent = this.isAbsent();\r\n        if (!absent && presentRunnable) {\r\n            presentRunnable.call(this, this);\r\n        }\r\n        return !absent;\r\n    };\r\n    /**\r\n     * should make the code clearer\r\n     * note if you pass a function\r\n     * this refers to the active dopmquery object\r\n     *\r\n     *\r\n     * @param presentRunnable\r\n     */\r\n    DomQuery.prototype.ifPresentLazy = function (presentRunnable) {\r\n        if (presentRunnable === void 0) { presentRunnable = function () {\r\n        }; }\r\n        this.isPresent.call(this, presentRunnable);\r\n        return this;\r\n    };\r\n    /**\r\n     * remove all affected nodes from this query object from the dom tree\r\n     */\r\n    DomQuery.prototype.delete = function () {\r\n        this.eachElem(function (node) {\r\n            if (node.parentNode) {\r\n                node.parentNode.removeChild(node);\r\n            }\r\n        });\r\n    };\r\n    /**\r\n     * query selector all on the existing dom query object\r\n     *\r\n     * @param selector the standard selector\r\n     * @return a DomQuery with the results\r\n     */\r\n    DomQuery.prototype.querySelectorAll = function (selector) {\r\n        var _a, _b, _c;\r\n        if (!((_b = (_a = this) === null || _a === void 0 ? void 0 : _a.rootNode) === null || _b === void 0 ? void 0 : _b.length)) {\r\n            return this;\r\n        }\r\n        var nodes = [];\r\n        for (var cnt = 0; cnt < this.rootNode.length; cnt++) {\r\n            if (!((_c = this.rootNode[cnt]) === null || _c === void 0 ? void 0 : _c.querySelectorAll)) {\r\n                continue;\r\n            }\r\n            var res = this.rootNode[cnt].querySelectorAll(selector);\r\n            nodes = nodes.concat(objToArray(res));\r\n        }\r\n        return new (DomQuery.bind.apply(DomQuery, __spreadArrays([void 0], nodes)))();\r\n    };\r\n    /**\r\n     * core byId method\r\n     * @param id the id to search for\r\n     * @param includeRoot also match the root element?\r\n     */\r\n    DomQuery.prototype.byId = function (id, includeRoot) {\r\n        var _a;\r\n        var res = [];\r\n        for (var cnt = 0; includeRoot && cnt < this.rootNode.length; cnt++) {\r\n            if (((_a = this.rootNode[cnt]) === null || _a === void 0 ? void 0 : _a.id) == id) {\r\n                res.push(new DomQuery(this.rootNode[cnt]));\r\n            }\r\n        }\r\n        //for some strange kind of reason the # selector fails\r\n        //on hidden elements we use the attributes match selector\r\n        //that works\r\n        res = res.concat(this.querySelectorAll(\"[id=\\\"\" + id + \"\\\"]\"));\r\n        return new (DomQuery.bind.apply(DomQuery, __spreadArrays([void 0], res)))();\r\n    };\r\n    /**\r\n     * same as byId just for the tag name\r\n     * @param tagName\r\n     * @param includeRoot\r\n     */\r\n    DomQuery.prototype.byTagName = function (tagName, includeRoot) {\r\n        var _a;\r\n        var res = [];\r\n        for (var cnt = 0; includeRoot && cnt < this.rootNode.length; cnt++) {\r\n            if (((_a = this.rootNode[cnt]) === null || _a === void 0 ? void 0 : _a.tagName) == tagName) {\r\n                res.push(new DomQuery(this.rootNode[cnt]));\r\n            }\r\n        }\r\n        res = res.concat(this.querySelectorAll(tagName));\r\n        return new (DomQuery.bind.apply(DomQuery, __spreadArrays([void 0], res)))();\r\n    };\r\n    /**\r\n     * attr accessor, usage myQuery.attr(\"class\").value = \"bla\"\r\n     * or let value myQuery.attr(\"class\").value\r\n     * @param attr the attribute to set\r\n     * @param defaultValue the default value in case nothing is presented (defaults to null)\r\n     */\r\n    DomQuery.prototype.attr = function (attr, defaultValue) {\r\n        if (defaultValue === void 0) { defaultValue = null; }\r\n        return new ElementAttribute(this, attr, defaultValue);\r\n    };\r\n    /**\r\n     * hasclass, checks for an existing class in the class attributes\r\n     *\r\n     * @param clazz the class to search for\r\n     */\r\n    DomQuery.prototype.hasClass = function (clazz) {\r\n        var hasIt = false;\r\n        this.each(function (item) {\r\n            var oldClass = item.attr(\"class\").value || \"\";\r\n            if (oldClass.toLowerCase().indexOf(clazz.toLowerCase()) == -1) {\r\n                return;\r\n            }\r\n            else {\r\n                var oldClasses = oldClass.split(/\\s+/gi);\r\n                var found = false;\r\n                for (var cnt = 0; cnt < oldClasses.length && !found; cnt++) {\r\n                    found = oldClasses[cnt].toLowerCase() == clazz.toLowerCase();\r\n                }\r\n                hasIt = hasIt || found;\r\n                if (hasIt) {\r\n                    return false;\r\n                }\r\n            }\r\n        });\r\n        return hasIt;\r\n    };\r\n    /**\r\n     * appends a class string if not already in the element(s)\r\n     *\r\n     * @param clazz the style class to append\r\n     */\r\n    DomQuery.prototype.addClass = function (clazz) {\r\n        var _this = this;\r\n        this.each(function (item) {\r\n            var oldClass = item.attr(\"class\").value || \"\";\r\n            if (!_this.hasClass(clazz)) {\r\n                item.attr(\"class\").value = trim(oldClass + \" \" + clazz);\r\n                return;\r\n            }\r\n        });\r\n        return this;\r\n    };\r\n    /**\r\n     * remove the style class if in the class definitions\r\n     *\r\n     * @param clazz\r\n     */\r\n    DomQuery.prototype.removeClass = function (clazz) {\r\n        var _this = this;\r\n        this.each(function (item) {\r\n            if (_this.hasClass(clazz)) {\r\n                var oldClass = item.attr(\"class\").value || \"\";\r\n                var newClasses = [];\r\n                var oldClasses = oldClass.split(/\\s+/gi);\r\n                for (var cnt = 0; cnt < oldClasses.length; cnt++) {\r\n                    if (oldClasses[cnt].toLowerCase() != clazz.toLowerCase()) {\r\n                        newClasses.push(oldClasses[cnt]);\r\n                    }\r\n                }\r\n                item.attr(\"class\").value = newClasses.join(\" \");\r\n            }\r\n        });\r\n        return this;\r\n    };\r\n    /**\r\n     * checks whether we have a multipart element in our children\r\n     */\r\n    DomQuery.prototype.isMultipartCandidate = function () {\r\n        return this.querySelectorAll(\"input[type='file']\").firstElem().isPresent();\r\n    };\r\n    /**\r\n     * innerHtml equivalkent\r\n     * equivalent to jqueries html\r\n     * as setter the html is set and the\r\n     * DomQuery is given back\r\n     * as getter the html string is returned\r\n     *\r\n     * @param inval\r\n     */\r\n    DomQuery.prototype.html = function (inval) {\r\n        if (Monad_1.Optional.fromNullable(inval).isAbsent()) {\r\n            return this.isPresent() ? Monad_1.Optional.fromNullable(this.innerHtml) : Monad_1.Optional.absent;\r\n        }\r\n        this.innerHtml = inval;\r\n        return this;\r\n    };\r\n    Object.defineProperty(DomQuery.prototype, \"innerHtml\", {\r\n        get: function () {\r\n            var retArr = [];\r\n            this.eachElem(function (elem) { return retArr.push(elem.innerHTML); });\r\n            return retArr.join(\"\");\r\n        },\r\n        set: function (inVal) {\r\n            this.eachElem(function (elem) { return elem.innerHTML = inVal; });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    //source: https://developer.mozilla.org/en-US/docs/Web/API/Element/matches\r\n    //code snippet license: https://creativecommons.org/licenses/by-sa/2.5/\r\n    DomQuery.prototype._mozMatchesSelector = function (toMatch, selector) {\r\n        var prot = toMatch;\r\n        var matchesSelector = prot.matchesSelector ||\r\n            prot.mozMatchesSelector ||\r\n            prot.msMatchesSelector ||\r\n            prot.oMatchesSelector ||\r\n            prot.webkitMatchesSelector ||\r\n            function (s) {\r\n                var matches = (document || window.ownerDocument).querySelectorAll(s), i = matches.length;\r\n                while (--i >= 0 && matches.item(i) !== toMatch) {\r\n                }\r\n                return i > -1;\r\n            };\r\n        return matchesSelector.call(toMatch, selector);\r\n    };\r\n    /**\r\n     * filters the current dom query elements\r\n     * upon a given selector\r\n     *\r\n     * @param selector\r\n     */\r\n    DomQuery.prototype.filterSelector = function (selector) {\r\n        var _this = this;\r\n        var matched = [];\r\n        this.eachElem(function (item) {\r\n            if (_this._mozMatchesSelector(item, selector)) {\r\n                matched.push(item);\r\n            }\r\n        });\r\n        return new (DomQuery.bind.apply(DomQuery, __spreadArrays([void 0], matched)))();\r\n    };\r\n    DomQuery.prototype.matchesSelector = function (selector) {\r\n        var _this = this;\r\n        this.eachElem(function (item) {\r\n            if (!_this._mozMatchesSelector(item, selector)) {\r\n                return false;\r\n            }\r\n        });\r\n        return true;\r\n    };\r\n    /**\r\n     * easy node traversal, you can pass\r\n     * a set of node selectors which are joined as direct childs\r\n     *\r\n     * not the rootnodes are not in the getIf, those are always the child nodes\r\n     *\r\n     * @param nodeSelector\r\n     */\r\n    DomQuery.prototype.getIf = function () {\r\n        var nodeSelector = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            nodeSelector[_i] = arguments[_i];\r\n        }\r\n        var selectorStage = this.childNodes;\r\n        for (var cnt = 0; cnt < nodeSelector.length; cnt++) {\r\n            selectorStage = selectorStage.filterSelector(nodeSelector[cnt]);\r\n            if (selectorStage.isAbsent()) {\r\n                return selectorStage;\r\n            }\r\n        }\r\n        return selectorStage;\r\n    };\r\n    DomQuery.prototype.eachElem = function (func) {\r\n        for (var cnt = 0, len = this.rootNode.length; cnt < len; cnt++) {\r\n            if (func(this.rootNode[cnt], cnt) === false) {\r\n                break;\r\n            }\r\n        }\r\n        return this;\r\n    };\r\n    DomQuery.prototype.firstElem = function (func) {\r\n        if (func === void 0) { func = function (item) { return item; }; }\r\n        if (this.rootNode.length > 1) {\r\n            func(this.rootNode[0], 0);\r\n        }\r\n        return this;\r\n    };\r\n    DomQuery.prototype.each = function (func) {\r\n        Stream_1.Stream.of.apply(Stream_1.Stream, this.rootNode).each(function (item, cnt) {\r\n            //we could use a filter, but for the best performance we dont\r\n            if (item == null) {\r\n                return;\r\n            }\r\n            return func(DomQuery.byId(item), cnt);\r\n        });\r\n        return this;\r\n    };\r\n    /**\r\n     * returns a new dom query containing only the first element max\r\n     *\r\n     * @param func a an optional callback function to perform an operation on the first element\r\n     */\r\n    DomQuery.prototype.first = function (func) {\r\n        if (func === void 0) { func = function (item) { return item; }; }\r\n        if (this.rootNode.length >= 1) {\r\n            func(this.get(0), 0);\r\n            return this.get(0);\r\n        }\r\n        return this;\r\n    };\r\n    /**\r\n     * filter function which filters a subset\r\n     *\r\n     * @param func\r\n     */\r\n    DomQuery.prototype.filter = function (func) {\r\n        var reArr = [];\r\n        this.each(function (item) {\r\n            func(item) ? reArr.push(item) : null;\r\n        });\r\n        return new (DomQuery.bind.apply(DomQuery, __spreadArrays([void 0], reArr)))();\r\n    };\r\n    //TODO append prepend\r\n    /**\r\n     * global eval head appendix method\r\n     * no other methods are supported anymore\r\n     * @param code the code to be evaled\r\n     * @param  nonce optional  nonce key for higher security\r\n     */\r\n    DomQuery.prototype.globalEval = function (code, nonce) {\r\n        var head = document.getElementsByTagName(\"head\")[0] || document.documentElement;\r\n        var script = document.createElement(\"script\");\r\n        if (nonce) {\r\n            script.setAttribute(\"nonce\", nonce);\r\n        }\r\n        script.type = \"text/javascript\";\r\n        script.innerHTML = code;\r\n        var newScriptElement = head.appendChild(script);\r\n        head.removeChild(newScriptElement);\r\n        return this;\r\n    };\r\n    /**\r\n     * detaches a set of nodes from their parent elements\r\n     * in a browser independend manner\r\n     * @param {Object} items the items which need to be detached\r\n     * @return {Array} an array of nodes with the detached dom nodes\r\n     */\r\n    DomQuery.prototype.detach = function () {\r\n        this.eachElem(function (item) {\r\n            item.parentNode.removeChild(item);\r\n        });\r\n        return this;\r\n    };\r\n    /**\r\n     * appends the current set of elements\r\n     * to the element or first element passed via elem\r\n     * @param elem\r\n     */\r\n    DomQuery.prototype.appendTo = function (elem) {\r\n        this.eachElem(function (item) {\r\n            var value1 = elem.getAsElem(0).orElseLazy(function () {\r\n                return {\r\n                    appendChild: function (theItem) {\r\n                    }\r\n                };\r\n            }).value;\r\n            value1.appendChild(item);\r\n        });\r\n    };\r\n    /**\r\n     * loads and evals a script from a source uri\r\n     *\r\n     * @param src the source to be loaded and evaled\r\n     * @param defer in miliseconds execution default (0 == no defer)\r\n     * @param charSet\r\n     */\r\n    DomQuery.prototype.loadScriptEval = function (src, defer, charSet) {\r\n        var _this = this;\r\n        if (defer === void 0) { defer = 0; }\r\n        if (charSet === void 0) { charSet = \"utf-8\"; }\r\n        var xhr = new XMLHttpRequest();\r\n        xhr.open(\"GET\", src, false);\r\n        if (charSet) {\r\n            xhr.setRequestHeader(\"Content-Type\", \"application/x-javascript; charset:\" + charSet);\r\n        }\r\n        xhr.send(null);\r\n        xhr.onload = function (responseData) {\r\n            //defer also means we have to process after the ajax response\r\n            //has been processed\r\n            //we can achieve that with a small timeout, the timeout\r\n            //triggers after the processing is done!\r\n            if (!defer) {\r\n                _this.globalEval(xhr.responseText.replace(\"\\n\", \"\\r\\n\") + \"\\r\\n//@ sourceURL=\" + src);\r\n            }\r\n            else {\r\n                //TODO not ideal we maybe ought to move to something else here\r\n                //but since it is not in use yet, it is ok\r\n                setTimeout(function () {\r\n                    _this.globalEval(xhr.responseText + \"\\r\\n//@ sourceURL=\" + src);\r\n                }, defer);\r\n            }\r\n        };\r\n        xhr.onerror = function (data) {\r\n            throw Error(data);\r\n        };\r\n        //since we are synchronous we do it after not with onReadyStateChange\r\n        return this;\r\n    };\r\n    DomQuery.prototype.insertAfter = function () {\r\n        var toInsertParams = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            toInsertParams[_i] = arguments[_i];\r\n        }\r\n        this.each(function (existingItem) {\r\n            var existingElement = existingItem.getAsElem(0).value;\r\n            var rootNode = existingElement.parentNode;\r\n            var _loop_1 = function (cnt) {\r\n                var nextSibling = existingElement.nextSibling;\r\n                toInsertParams[cnt].eachElem(function (insertElem) {\r\n                    if (nextSibling) {\r\n                        rootNode.insertBefore(insertElem, nextSibling);\r\n                        existingElement = nextSibling;\r\n                    }\r\n                    else {\r\n                        rootNode.appendChild(insertElem);\r\n                    }\r\n                });\r\n            };\r\n            for (var cnt = 0; cnt < toInsertParams.length; cnt++) {\r\n                _loop_1(cnt);\r\n            }\r\n        });\r\n        var res = [];\r\n        res.push(this);\r\n        res = res.concat(toInsertParams);\r\n        return new (DomQuery.bind.apply(DomQuery, __spreadArrays([void 0], res)))();\r\n    };\r\n    DomQuery.prototype.insertBefore = function () {\r\n        var toInsertParams = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            toInsertParams[_i] = arguments[_i];\r\n        }\r\n        this.each(function (existingItem) {\r\n            var existingElement = existingItem.getAsElem(0).value;\r\n            var rootNode = existingElement.parentNode;\r\n            for (var cnt = 0; cnt < toInsertParams.length; cnt++) {\r\n                toInsertParams[cnt].eachElem(function (insertElem) {\r\n                    rootNode.insertBefore(insertElem, existingElement);\r\n                });\r\n            }\r\n        });\r\n        var res = [];\r\n        res.push(this);\r\n        res = res.concat(toInsertParams);\r\n        return new (DomQuery.bind.apply(DomQuery, __spreadArrays([void 0], res)))();\r\n    };\r\n    DomQuery.prototype.orElse = function () {\r\n        var elseValue = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            elseValue[_i] = arguments[_i];\r\n        }\r\n        if (this.isPresent()) {\r\n            return this;\r\n        }\r\n        else {\r\n            return new (DomQuery.bind.apply(DomQuery, __spreadArrays([void 0], elseValue)))();\r\n        }\r\n    };\r\n    DomQuery.prototype.orElseLazy = function (func) {\r\n        if (this.isPresent()) {\r\n            return this;\r\n        }\r\n        else {\r\n            return new DomQuery(func());\r\n        }\r\n    };\r\n    DomQuery.prototype.parents = function (tagName) {\r\n        var retSet = new Set();\r\n        var retArr = [];\r\n        var lowerTagName = tagName.toLowerCase();\r\n        var resolveItem = function (item) {\r\n            if ((item.tagName || \"\").toLowerCase() == lowerTagName && !retSet.has(item)) {\r\n                retSet.add(item);\r\n                retArr.push(item);\r\n            }\r\n        };\r\n        this.eachElem(function (item) {\r\n            while (item.parentNode) {\r\n                item = item.parentNode;\r\n                resolveItem(item);\r\n                //nested forms not possible, performance shortcut\r\n                if (tagName == \"form\" && retArr.length) {\r\n                    return false;\r\n                }\r\n            }\r\n        });\r\n        return new (DomQuery.bind.apply(DomQuery, __spreadArrays([void 0], retArr)))();\r\n    };\r\n    DomQuery.prototype.copyAttrs = function (sourceItem) {\r\n        var _this = this;\r\n        sourceItem.eachElem(function (sourceNode) {\r\n            var attrs = objToArray(sourceNode.attributes);\r\n            for (var _i = 0, attrs_1 = attrs; _i < attrs_1.length; _i++) {\r\n                var item = attrs_1[_i];\r\n                var value = item.value;\r\n                var name_1 = item.name;\r\n                switch (name_1) {\r\n                    case \"id\":\r\n                        _this.id.value = value;\r\n                        break;\r\n                    case \"disabled\":\r\n                        _this.resolveAttributeHolder(\"disabled\").disabled = value;\r\n                        break;\r\n                    case \"checked\":\r\n                        _this.resolveAttributeHolder(\"checked\").checked = value;\r\n                        break;\r\n                    default:\r\n                        _this.attr(name_1).value = value;\r\n                }\r\n            }\r\n        });\r\n        return this;\r\n    };\r\n    /**\r\n     * resolves an attribute holder compared\r\n     * @param attrName the attribute name\r\n     */\r\n    DomQuery.prototype.resolveAttributeHolder = function (attrName) {\r\n        if (attrName === void 0) { attrName = \"value\"; }\r\n        var ret = [];\r\n        ret[attrName] = null;\r\n        return (attrName in this.getAsElem(0).value) ?\r\n            this.getAsElem(0).value :\r\n            ret;\r\n    };\r\n    /**\r\n     * outerhtml convenience method\r\n     * browsers only support innerHTML but\r\n     * for instance for your jsf.js we have a full\r\n     * replace pattern which needs outerHTML processing\r\n     *\r\n     * @param markup\r\n     * @param runEmbeddedScripts\r\n     * @param runEmbeddedCss\r\n     */\r\n    DomQuery.prototype.outerHTML = function (markup, runEmbeddedScripts, runEmbeddedCss) {\r\n        var _a, _b;\r\n        if (this.isAbsent()) {\r\n            return;\r\n        }\r\n        var focusElementId = (_b = (_a = document) === null || _a === void 0 ? void 0 : _a.activeElement) === null || _b === void 0 ? void 0 : _b.id;\r\n        var caretPosition = (focusElementId) ? DomQuery.getCaretPosition(document.activeElement) : null;\r\n        var nodes = DomQuery.fromMarkup(markup);\r\n        var res = [];\r\n        var toReplace = this.getAsElem(0).value;\r\n        var firstInsert = nodes.get(0);\r\n        var parentNode = toReplace.parentNode;\r\n        var replaced = firstInsert.getAsElem(0).value;\r\n        parentNode.replaceChild(replaced, toReplace);\r\n        res.push(new DomQuery(replaced));\r\n        //no replacement possible\r\n        if (this.isAbsent()) {\r\n            return this;\r\n        }\r\n        var insertAdditionalItems = [];\r\n        if (nodes.length > 1) {\r\n            insertAdditionalItems = insertAdditionalItems.concat.apply(insertAdditionalItems, nodes.values.slice(1));\r\n            res.push(DomQuery.byId(replaced).insertAfter(new (DomQuery.bind.apply(DomQuery, __spreadArrays([void 0], insertAdditionalItems)))()));\r\n        }\r\n        if (runEmbeddedScripts) {\r\n            this.runScripts();\r\n        }\r\n        if (runEmbeddedCss) {\r\n            this.runCss();\r\n        }\r\n        var focusElement = DomQuery.byId(focusElementId);\r\n        if (focusElementId && focusElement.isPresent() &&\r\n            caretPosition != null && \"undefined\" != typeof caretPosition) {\r\n            focusElement.eachElem(function (item) { return DomQuery.setCaretPosition(item, caretPosition); });\r\n        }\r\n        return nodes;\r\n    };\r\n    /**\r\n     * Run through the given nodes in the DomQuery execute the inline scripts\r\n     * @param whilteListed: optional whitelist function which can filter out script tags which are not processed\r\n     * defaults to the standard jsf.js exclusion (we use this code for myfaces)\r\n     */\r\n    DomQuery.prototype.runScripts = function (whilteListed) {\r\n        var _this = this;\r\n        if (whilteListed === void 0) { whilteListed = DEFAULT_JSF_WHITELIST; }\r\n        var finalScripts = [], equi = equalsIgnoreCase, execScrpt = function (item) {\r\n            var tagName = item.tagName;\r\n            var itemType = item.type || \"\";\r\n            if (tagName && equi(tagName, \"script\") &&\r\n                (itemType === \"\" || equi(itemType, \"text/javascript\") ||\r\n                    equi(itemType, \"javascript\") ||\r\n                    equi(itemType, \"text/ecmascript\") ||\r\n                    equi(itemType, \"ecmascript\"))) {\r\n                var src = item.getAttribute('src');\r\n                if ('undefined' != typeof src\r\n                    && null != src\r\n                    && src.length > 0) {\r\n                    //we have to move this into an inner if because chrome otherwise chokes\r\n                    //due to changing the and order instead of relying on left to right\r\n                    //if jsf.js is already registered we do not replace it anymore\r\n                    if (whilteListed(src)) {\r\n                        if (finalScripts.length) {\r\n                            //script source means we have to eval the existing\r\n                            //scripts before running the include\r\n                            _this.globalEval(finalScripts.join(\"\\n\"));\r\n                            finalScripts = [];\r\n                        }\r\n                        _this.loadScriptEval(src, 0, \"UTF-8\");\r\n                    }\r\n                }\r\n                else {\r\n                    // embedded script auto eval\r\n                    //TODO this probably needs to be changed due to our new parsing structures\r\n                    //probably not needed anymore\r\n                    var evalText = trim(item.text || item.innerText || item.innerHTML);\r\n                    var go = true;\r\n                    while (go) {\r\n                        go = false;\r\n                        if (evalText.substring(0, 4) == \"<!--\") {\r\n                            evalText = evalText.substring(4);\r\n                            go = true;\r\n                        }\r\n                        if (evalText.substring(0, 4) == \"//<!--\") {\r\n                            evalText = evalText.substring(6);\r\n                            go = true;\r\n                        }\r\n                        if (evalText.substring(0, 11) == \"//<![CDATA[\") {\r\n                            evalText = evalText.substring(11);\r\n                            go = true;\r\n                        }\r\n                    }\r\n                    // we have to run the script under a global context\r\n                    //we store the script for less calls to eval\r\n                    finalScripts.push(evalText);\r\n                }\r\n            }\r\n        };\r\n        try {\r\n            var scriptElements = new DomQuery(this.filterSelector(\"script\"), this.querySelectorAll(\"script\"));\r\n            //script execution order by relative pos in their dom tree\r\n            scriptElements.stream\r\n                .flatMap(function (item) {\r\n                return Stream_1.Stream.of(item.values);\r\n            })\r\n                .sort(function (node1, node2) {\r\n                return node1.compareDocumentPosition(node2) - 3; //preceding 2, following == 4\r\n            })\r\n                .each(function (item) { return execScrpt(item); });\r\n            if (finalScripts.length) {\r\n                this.globalEval(finalScripts.join(\"\\n\"));\r\n            }\r\n        }\r\n        catch (e) {\r\n            if (window.console && window.console.error) {\r\n                //not sure if we\r\n                //should use our standard\r\n                //error mechanisms here\r\n                //because in the head appendix\r\n                //method only a console\r\n                //error would be raised as well\r\n                console.error(e.message || e.description);\r\n            }\r\n        }\r\n        finally {\r\n            //the usual ie6 fix code\r\n            //the IE6 garbage collector is broken\r\n            //nulling closures helps somewhat to reduce\r\n            //mem leaks, which are impossible to avoid\r\n            //at this browser\r\n            execScrpt = null;\r\n        }\r\n        return this;\r\n    };\r\n    DomQuery.prototype.runCss = function () {\r\n        var applyStyle = function (item, style) {\r\n            var _a, _b, _c, _d, _e;\r\n            var newSS = document.createElement(\"style\");\r\n            document.getElementsByTagName(\"head\")[0].appendChild(newSS);\r\n            var styleSheet = (_a = newSS.sheet, (_a !== null && _a !== void 0 ? _a : newSS.styleSheet));\r\n            newSS.setAttribute(\"rel\", (_b = item.getAttribute(\"rel\"), (_b !== null && _b !== void 0 ? _b : \"stylesheet\")));\r\n            newSS.setAttribute(\"type\", (_c = item.getAttribute(\"type\"), (_c !== null && _c !== void 0 ? _c : \"text/css\")));\r\n            if (_e = (_d = styleSheet) === null || _d === void 0 ? void 0 : _d.cssText, (_e !== null && _e !== void 0 ? _e : false)) {\r\n                styleSheet.cssText = style;\r\n            }\r\n            else {\r\n                newSS.appendChild(document.createTextNode(style));\r\n            }\r\n        }, execCss = function (item) {\r\n            var tagName = item.tagName;\r\n            if (tagName && equalsIgnoreCase(tagName, \"link\") && equalsIgnoreCase(item.getAttribute(\"type\"), \"text/css\")) {\r\n                applyStyle(item, \"@import url('\" + item.getAttribute(\"href\") + \"');\");\r\n            }\r\n            else if (tagName && equalsIgnoreCase(tagName, \"style\") && equalsIgnoreCase(item.getAttribute(\"type\"), \"text/css\")) {\r\n                var innerText = [];\r\n                //compliant browsers know child nodes\r\n                var childNodes = item.childNodes;\r\n                if (childNodes) {\r\n                    var len = childNodes.length;\r\n                    for (var cnt = 0; cnt < len; cnt++) {\r\n                        innerText.push(childNodes[cnt].innerHTML || childNodes[cnt].data);\r\n                    }\r\n                    //non compliant ones innerHTML\r\n                }\r\n                else if (item.innerHTML) {\r\n                    innerText.push(item.innerHTML);\r\n                }\r\n                applyStyle(item, innerText.join(\"\"));\r\n            }\r\n        };\r\n        var scriptElements = new DomQuery(this.filterSelector(\"link, style\"), this.querySelectorAll(\"link, style\"));\r\n        scriptElements.stream\r\n            .flatMap(function (item) {\r\n            return Stream_1.Stream.of(item.values);\r\n        })\r\n            .sort(function (node1, node2) {\r\n            return node1.compareDocumentPosition(node2) - 3; //preceding 2, following == 4\r\n        })\r\n            .each(function (item) { return execCss(item); });\r\n        return this;\r\n    };\r\n    /**\r\n     * fires a click event on the underlying dom elements\r\n     */\r\n    DomQuery.prototype.click = function () {\r\n        this.fireEvent(\"click\");\r\n        return this;\r\n    };\r\n    DomQuery.prototype.addEventListener = function (type, listener, options) {\r\n        this.eachElem(function (node) {\r\n            node.addEventListener(type, listener, options);\r\n        });\r\n        return this;\r\n    };\r\n    DomQuery.prototype.removeEventListener = function (type, listener, options) {\r\n        this.eachElem(function (node) {\r\n            node.removeEventListener(type, listener, options);\r\n        });\r\n        return this;\r\n    };\r\n    /**\r\n     * fires an event\r\n     */\r\n    DomQuery.prototype.fireEvent = function (eventName) {\r\n        this.eachElem(function (node) {\r\n            var doc;\r\n            if (node.ownerDocument) {\r\n                doc = node.ownerDocument;\r\n            }\r\n            else if (node.nodeType == 9) {\r\n                // the node may be the document itself, nodeType 9 = DOCUMENT_NODE\r\n                doc = node;\r\n            }\r\n            else {\r\n                throw new Error(\"Invalid node passed to fireEvent: \" + node.id);\r\n            }\r\n            if (node.dispatchEvent) {\r\n                // Gecko-style approach (now the standard) takes more work\r\n                var eventClass = \"\";\r\n                // Different events have different event classes.\r\n                // If this switch statement can't map an eventName to an eventClass,\r\n                // the event firing is going to fail.\r\n                switch (eventName) {\r\n                    case \"click\": // Dispatching of 'click' appears to not work correctly in Safari. Use 'mousedown' or 'mouseup' instead.\r\n                    case \"mousedown\":\r\n                    case \"mouseup\":\r\n                        eventClass = \"MouseEvents\";\r\n                        break;\r\n                    case \"focus\":\r\n                    case \"change\":\r\n                    case \"blur\":\r\n                    case \"select\":\r\n                        eventClass = \"HTMLEvents\";\r\n                        break;\r\n                    default:\r\n                        throw \"fireEvent: Couldn't find an event class for event '\" + eventName + \"'.\";\r\n                        break;\r\n                }\r\n                var event_1 = doc.createEvent(eventClass);\r\n                event_1.initEvent(eventName, true, true); // All events created as bubbling and cancelable.\r\n                event_1.synthetic = true; // allow detection of synthetic events\r\n                // The second parameter says go ahead with the default action\r\n                node.dispatchEvent(event_1);\r\n            }\r\n            else if (node.fireEvent) {\r\n                // IE-old school style, you can drop this if you don't need to support IE8 and lower\r\n                var event_2 = doc.createEventObject();\r\n                event_2.synthetic = true; // allow detection of synthetic events\r\n                node.fireEvent(\"on\" + eventName, event_2);\r\n            }\r\n        });\r\n    };\r\n    DomQuery.prototype.textContent = function (joinstr) {\r\n        if (joinstr === void 0) { joinstr = \"\"; }\r\n        return this.stream\r\n            .map(function (value) {\r\n            var item = value.getAsElem(0).orElseLazy(function () {\r\n                return {\r\n                    textContent: \"\"\r\n                };\r\n            }).value;\r\n            return item.textContent || \"\";\r\n        })\r\n            .reduce(function (text1, text2) { return text1 + joinstr + text2; }, \"\").value;\r\n    };\r\n    DomQuery.prototype.innerText = function (joinstr) {\r\n        if (joinstr === void 0) { joinstr = \"\"; }\r\n        return this.stream\r\n            .map(function (value) {\r\n            var item = value.getAsElem(0).orElseLazy(function () {\r\n                return {\r\n                    innerText: \"\"\r\n                };\r\n            }).value;\r\n            return item.innerText || \"\";\r\n        })\r\n            .reduce(function (text1, text2) { return [text1, text2].join(joinstr); }, \"\").value;\r\n    };\r\n    /**\r\n     * encodes all input elements properly into respective\r\n     * config entries, this can be used\r\n     * for legacy systems, for newer usecases, use the\r\n     * HTML5 Form class which all newer browsers provide\r\n     *\r\n     * @param toMerge optional config which can be merged in\r\n     * @return a copy pf\r\n     */\r\n    DomQuery.prototype.encodeFormElement = function (toMerge) {\r\n        if (toMerge === void 0) { toMerge = new Monad_1.Config({}); }\r\n        //browser behavior no element name no encoding (normal submit fails in that case)\r\n        //https://issues.apache.org/jira/browse/MYFACES-2847\r\n        if (this.name.isAbsent()) {\r\n            return;\r\n        }\r\n        //lets keep it sideffects free\r\n        var target = toMerge.shallowCopy;\r\n        this.each(function (element) {\r\n            if (element.name.isAbsent()) { //no name, no encoding\r\n                return;\r\n            }\r\n            var name = element.name.value;\r\n            var tagName = element.tagName.orElse(\"__none__\").value.toLowerCase();\r\n            var elemType = element.type.orElse(\"__none__\").value.toLowerCase();\r\n            elemType = elemType.toLowerCase();\r\n            // routine for all elements\r\n            // rules:\r\n            // - process only inputs, textareas and selects\r\n            // - elements muest have attribute \"name\"\r\n            // - elements must not be disabled\r\n            if (((tagName == \"input\" || tagName == \"textarea\" || tagName == \"select\") &&\r\n                (name != null && name != \"\")) && !element.disabled) {\r\n                // routine for select elements\r\n                // rules:\r\n                // - if select-one and value-Attribute exist => \"name=value\"\r\n                // (also if value empty => \"name=\")\r\n                // - if select-one and value-Attribute don't exist =>\r\n                // \"name=DisplayValue\"\r\n                // - if select multi and multple selected => \"name=value1&name=value2\"\r\n                // - if select and selectedIndex=-1 don't submit\r\n                if (tagName == \"select\") {\r\n                    // selectedIndex must be >= 0 sein to be submittet\r\n                    var selectElem = element.getAsElem(0).value;\r\n                    if (selectElem.selectedIndex >= 0) {\r\n                        var uLen = selectElem.options.length;\r\n                        for (var u = 0; u < uLen; u++) {\r\n                            // find all selected options\r\n                            //let subBuf = [];\r\n                            if (selectElem.options[u].selected) {\r\n                                var elementOption = selectElem.options[u];\r\n                                target.assign(name).value = (elementOption.getAttribute(\"value\") != null) ?\r\n                                    elementOption.value : elementOption.text;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                // routine for remaining elements\r\n                // rules:\r\n                // - don't submit no selects (processed above), buttons, reset buttons, submit buttons,\r\n                // - submit checkboxes and radio inputs only if checked\r\n                if ((tagName != \"select\" && elemType != \"button\"\r\n                    && elemType != \"reset\" && elemType != \"submit\" && elemType != \"image\")\r\n                    && ((elemType != \"checkbox\" && elemType != \"radio\") || element.checked)) {\r\n                    var files = element.value.files;\r\n                    if (files && files.length) {\r\n                        //xhr level2\r\n                        target.assign(name).value = files[0];\r\n                    }\r\n                    else {\r\n                        target.assign(name).value = element.inputValue.value;\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        return target;\r\n    };\r\n    Object.defineProperty(DomQuery.prototype, \"cDATAAsString\", {\r\n        get: function () {\r\n            var cDataBlock = [];\r\n            // response may contain several blocks\r\n            return this.stream\r\n                .flatMap(function (item) { return item.childNodes.stream; }).reduce(function (reduced, item) {\r\n                var _a, _b, _c, _d;\r\n                reduced.push((_d = (_c = (_b = (_a = item) === null || _a === void 0 ? void 0 : _a.value) === null || _b === void 0 ? void 0 : _b.value) === null || _c === void 0 ? void 0 : _c.data, (_d !== null && _d !== void 0 ? _d : \"\")));\r\n                return reduced;\r\n            }, []).value.join(\"\");\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    DomQuery.prototype.subNodes = function (from, to) {\r\n        if (Monad_1.Optional.fromNullable(to).isAbsent()) {\r\n            to = this.length;\r\n        }\r\n        return new (DomQuery.bind.apply(DomQuery, __spreadArrays([void 0], this.rootNode.slice(from, Math.min(to, this.length)))))();\r\n    };\r\n    DomQuery.prototype.limits = function (end) {\r\n        this._limits = end;\r\n        return this;\r\n    };\r\n    //-- internally exposed methods needed for the interconnectivity\r\n    DomQuery.prototype.hasNext = function () {\r\n        var isLimitsReached = this._limits != -1 && this.pos >= this._limits - 1;\r\n        var isEndOfArray = this.pos >= this.values.length - 1;\r\n        return !(isLimitsReached ||\r\n            isEndOfArray);\r\n    };\r\n    DomQuery.prototype.next = function () {\r\n        if (!this.hasNext()) {\r\n            return null;\r\n        }\r\n        this.pos++;\r\n        return new DomQuery(this.values[this.pos]);\r\n    };\r\n    DomQuery.prototype.reset = function () {\r\n        this.pos = -1;\r\n    };\r\n    //from\r\n    // http://blog.vishalon.net/index.php/javascript-getting-and-setting-caret-position-in-textarea/\r\n    DomQuery.getCaretPosition = function (ctrl) {\r\n        var _a;\r\n        var caretPos = 0;\r\n        try {\r\n            if ((_a = document) === null || _a === void 0 ? void 0 : _a.selection) {\r\n                ctrl.focus();\r\n                var selection = document.selection.createRange();\r\n                //the selection now is start zero\r\n                selection.moveStart('character', -ctrl.value.length);\r\n                //the caretposition is the selection start\r\n                caretPos = selection.text.length;\r\n            }\r\n        }\r\n        catch (e) {\r\n            //now this is ugly, but not supported input types throw errors for selectionStart\r\n            //just in case someone dumps this code onto unsupported browsers\r\n        }\r\n        return caretPos;\r\n    };\r\n    DomQuery.setCaretPosition = function (ctrl, pos) {\r\n        var range = ctrl.createTextRange();\r\n        range.collapse(true);\r\n        range.moveEnd('character', pos);\r\n        range.moveStart('character', pos);\r\n        range.select();\r\n    };\r\n    DomQuery.absent = new DomQuery();\r\n    return DomQuery;\r\n}());\r\nexports.DomQuery = DomQuery;\r\n/**\r\n * Various collectors\r\n * which can be used in conjunction with Streams\r\n */\r\n/**\r\n * A collector which bundles a full dom query stream into a single dom query element\r\n *\r\n * This connects basically our stream back into DomQuery\r\n */\r\nvar DomQueryCollector = /** @class */ (function () {\r\n    function DomQueryCollector() {\r\n        this.data = [];\r\n    }\r\n    DomQueryCollector.prototype.collect = function (element) {\r\n        this.data.push(element);\r\n    };\r\n    Object.defineProperty(DomQueryCollector.prototype, \"finalValue\", {\r\n        get: function () {\r\n            return new (DomQuery.bind.apply(DomQuery, __spreadArrays([void 0], this.data)))();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return DomQueryCollector;\r\n}());\r\nexports.DomQueryCollector = DomQueryCollector;\r\n/**\r\n * abbreviation for DomQuery\r\n */\r\nexports.DQ = DomQuery;\r\n","\"use strict\";\r\n/* Licensed to the Apache Software Foundation (ASF) under one or more\r\n * contributor license agreements.  See the NOTICE file distributed with\r\n * this work for additional information regarding copyright ownership.\r\n * The ASF licenses this file to you under the Apache License, Version 2.0\r\n * (the \"License\"); you may not use this file except in compliance with\r\n * the License.  You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/**\r\n * A module which keeps  basic monadish like definitions in place without any sidedependencies to other modules.\r\n * Useful if you need the functions in another library to keep its dependencies down\r\n */\r\n/*IMonad definitions*/\r\nvar Lang_1 = require(\"./Lang\");\r\nvar SourcesCollectors_1 = require(\"./SourcesCollectors\");\r\nvar Stream_1 = require(\"./Stream\");\r\nvar objAssign = Lang_1.Lang.objAssign;\r\n/**\r\n * Implementation of a monad\r\n * (Sideffect free), no write allowed directly on the monads\r\n * value state\r\n */\r\nvar Monad = /** @class */ (function () {\r\n    function Monad(value) {\r\n        this._value = value;\r\n    }\r\n    Object.defineProperty(Monad.prototype, \"value\", {\r\n        get: function () {\r\n            return this._value;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Monad.prototype.map = function (fn) {\r\n        if (!fn) {\r\n            fn = function (inval) { return inval; };\r\n        }\r\n        var result = fn(this.value);\r\n        return new Monad(result);\r\n    };\r\n    Monad.prototype.flatMap = function (fn) {\r\n        var _a;\r\n        var mapped = this.map(fn);\r\n        while (((_a = mapped) === null || _a === void 0 ? void 0 : _a.value) instanceof Monad) {\r\n            mapped = mapped.value;\r\n        }\r\n        return mapped;\r\n    };\r\n    return Monad;\r\n}());\r\nexports.Monad = Monad;\r\n/**\r\n * optional implementation, an optional is basically an implementation of a Monad with additional syntactic\r\n * sugar on top\r\n * (Sideeffect free, since value assignment is not allowed)\r\n * */\r\nvar Optional = /** @class */ (function (_super) {\r\n    __extends(Optional, _super);\r\n    function Optional(value) {\r\n        return _super.call(this, value) || this;\r\n    }\r\n    Object.defineProperty(Optional.prototype, \"value\", {\r\n        get: function () {\r\n            if (this._value instanceof Monad) {\r\n                return this._value.flatMap().value;\r\n            }\r\n            return this._value;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Optional.fromNullable = function (value) {\r\n        return new Optional(value);\r\n    };\r\n    /*syntactic sugar for absent and present checks*/\r\n    Optional.prototype.isAbsent = function () {\r\n        return \"undefined\" == typeof this.value || null == this.value;\r\n    };\r\n    /**\r\n     * any value present\r\n     */\r\n    Optional.prototype.isPresent = function (presentRunnable) {\r\n        var absent = this.isAbsent();\r\n        if (!absent && presentRunnable) {\r\n            presentRunnable.call(this, this);\r\n        }\r\n        return !absent;\r\n    };\r\n    Optional.prototype.ifPresentLazy = function (presentRunnable) {\r\n        if (presentRunnable === void 0) { presentRunnable = function () {\r\n        }; }\r\n        this.isPresent.call(this, presentRunnable);\r\n        return this;\r\n    };\r\n    Optional.prototype.orElse = function (elseValue) {\r\n        if (this.isPresent()) {\r\n            return this;\r\n        }\r\n        else {\r\n            //shortcut\r\n            if (elseValue == null) {\r\n                return Optional.absent;\r\n            }\r\n            return this.flatMap(function () { return elseValue; });\r\n        }\r\n    };\r\n    /**\r\n     * lazy, passes a function which then is lazily evaluated\r\n     * instead of a direct value\r\n     * @param func\r\n     */\r\n    Optional.prototype.orElseLazy = function (func) {\r\n        if (this.isPresent()) {\r\n            return this;\r\n        }\r\n        else {\r\n            return this.flatMap(func);\r\n        }\r\n    };\r\n    /*\r\n     * we need to implement it to fullfill the contract, although it is used only internally\r\n     * all values are flattened when accessed anyway, so there is no need to call this methiod\r\n     */\r\n    Optional.prototype.flatMap = function (fn) {\r\n        var val = _super.prototype.flatMap.call(this, fn);\r\n        if (!(val instanceof Optional)) {\r\n            return Optional.fromNullable(val.value);\r\n        }\r\n        return val.flatMap();\r\n    };\r\n    /*\r\n     * elvis operation, take care, if you use this you lose typesafety and refactoring\r\n     * capabilites, unfortunately typesceript does not allow to have its own elvis operator\r\n     * this is some syntactic sugar however which is quite useful*/\r\n    Optional.prototype.getIf = function () {\r\n        var key = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            key[_i] = arguments[_i];\r\n        }\r\n        var currentPos = this;\r\n        for (var cnt = 0; cnt < key.length; cnt++) {\r\n            var currKey = this.keyVal(key[cnt]);\r\n            var arrPos = this.arrayIndex(key[cnt]);\r\n            if (currKey === \"\" && arrPos >= 0) {\r\n                currentPos = this.getClass().fromNullable(!(currentPos.value instanceof Array) ? null : (currentPos.value.length < arrPos ? null : currentPos.value[arrPos]));\r\n                if (currentPos.isAbsent()) {\r\n                    return currentPos;\r\n                }\r\n                continue;\r\n            }\r\n            else if (currKey && arrPos >= 0) {\r\n                if (currentPos.getIfPresent(currKey).isAbsent()) {\r\n                    return currentPos;\r\n                }\r\n                currentPos = (currentPos.getIfPresent(currKey).value instanceof Array) ? this.getClass().fromNullable(currentPos.getIfPresent(currKey).value[arrPos]) : this.getClass().absent;\r\n                if (currentPos.isAbsent()) {\r\n                    return currentPos;\r\n                }\r\n                continue;\r\n            }\r\n            else {\r\n                currentPos = currentPos.getIfPresent(currKey);\r\n            }\r\n            if (currentPos.isAbsent()) {\r\n                return currentPos;\r\n            }\r\n            else if (arrPos > -1) {\r\n                currentPos = this.getClass().fromNullable(currentPos.value[arrPos]);\r\n            }\r\n        }\r\n        var retVal = currentPos;\r\n        return retVal;\r\n    };\r\n    /**\r\n     * simple match, if the first order function call returns\r\n     * true then there is a match, if the value is not present\r\n     * it never matches\r\n     *\r\n     * @param fn the first order function performing the match\r\n     */\r\n    Optional.prototype.match = function (fn) {\r\n        if (this.isAbsent()) {\r\n            return false;\r\n        }\r\n        return fn(this.value);\r\n    };\r\n    /**\r\n     * convenience function to flatmap the internal value\r\n     * and replace it with a default in case of being absent\r\n     *\r\n     * @param defaultVal\r\n     * @returns {Optional<any>}\r\n     */\r\n    Optional.prototype.get = function (defaultVal) {\r\n        if (defaultVal === void 0) { defaultVal = Optional.absent; }\r\n        if (this.isAbsent()) {\r\n            return this.getClass().fromNullable(defaultVal).flatMap();\r\n        }\r\n        return this.getClass().fromNullable(this.value).flatMap();\r\n    };\r\n    Optional.prototype.toJson = function () {\r\n        return JSON.stringify(this.value);\r\n    };\r\n    /**\r\n     * helper to override several implementations in a more fluent way\r\n     * by having a getClass operation we can avoid direct calls into the constructor or\r\n     * static methods and do not have to implement several methods which rely on the type\r\n     * of \"this\"\r\n     * @returns {Monadish.Optional}\r\n     */\r\n    Optional.prototype.getClass = function () {\r\n        return Optional;\r\n    };\r\n    /*helper method for getIf with array access aka <name>[<indexPos>]*/\r\n    Optional.prototype.arrayIndex = function (key) {\r\n        var start = key.indexOf(\"[\");\r\n        var end = key.indexOf(\"]\");\r\n        if (start >= 0 && end > 0 && start < end) {\r\n            return parseInt(key.substring(start + 1, end));\r\n        }\r\n        else {\r\n            return -1;\r\n        }\r\n    };\r\n    /*helper method for getIf with array access aka <name>[<indexPos>]*/\r\n    Optional.prototype.keyVal = function (key) {\r\n        var start = key.indexOf(\"[\");\r\n        if (start >= 0) {\r\n            return key.substring(0, start);\r\n        }\r\n        else {\r\n            return key;\r\n        }\r\n    };\r\n    /**\r\n     * additional syntactic sugar which is not part of the usual optional implementation\r\n     * but makes life easier, if you want to sacrifice typesafety and refactoring\r\n     * capabilities in typescript\r\n     */\r\n    Optional.prototype.getIfPresent = function (key) {\r\n        if (this.isAbsent()) {\r\n            return this.getClass().absent;\r\n        }\r\n        return this.getClass().fromNullable(this.value[key]).flatMap();\r\n    };\r\n    /**\r\n     * elvis like typesafe functional save resolver\r\n     * a typesafe option for getIfPresent\r\n     *\r\n     * usage myOptional.resolve(value => value.subAttr.subAttr2).orElseLazy(....)\r\n     * if this is resolvable without any errors an Optional with the value is returned\r\n     * if not, then an Optional absent is returned, also if you return Optional absent\r\n     * it is flatmapped into absent\r\n     *\r\n     * @param resolver the resolver function, can throw any arbitrary errors, int  the error case\r\n     * the resolution goes towards absent\r\n     */\r\n    Optional.prototype.resolve = function (resolver) {\r\n        if (this.isAbsent()) {\r\n            return Optional.absent;\r\n        }\r\n        try {\r\n            return Optional.fromNullable(resolver(this.value));\r\n        }\r\n        catch (e) {\r\n            return Optional.absent;\r\n        }\r\n    };\r\n    /*default value for absent*/\r\n    Optional.absent = Optional.fromNullable(null);\r\n    return Optional;\r\n}(Monad));\r\nexports.Optional = Optional;\r\n// --------------------- From here onwards we break out the sideffects free limits ------------\r\n/**\r\n * ValueEmbedder is the writeable version\r\n * of optional, it basically is a wrappber\r\n * around a construct which has a state\r\n * and can be written to.\r\n *\r\n * For the readonly version see Optional\r\n */\r\nvar ValueEmbedder = /** @class */ (function (_super) {\r\n    __extends(ValueEmbedder, _super);\r\n    function ValueEmbedder(rootElem, valueKey) {\r\n        if (valueKey === void 0) { valueKey = \"value\"; }\r\n        var _this = _super.call(this, rootElem) || this;\r\n        _this.key = valueKey;\r\n        return _this;\r\n    }\r\n    Object.defineProperty(ValueEmbedder.prototype, \"value\", {\r\n        get: function () {\r\n            return this._value ? this._value[this.key] : null;\r\n        },\r\n        set: function (newVal) {\r\n            if (!this._value) {\r\n                return;\r\n            }\r\n            this._value[this.key] = newVal;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ValueEmbedder.prototype.orElse = function (elseValue) {\r\n        var alternative = {};\r\n        alternative[this.key] = elseValue;\r\n        return this.isPresent() ? this : new ValueEmbedder(alternative, this.key);\r\n    };\r\n    ValueEmbedder.prototype.orElseLazy = function (func) {\r\n        if (this.isPresent()) {\r\n            return this;\r\n        }\r\n        else {\r\n            var alternative = {};\r\n            alternative[this.key] = func();\r\n            return new ValueEmbedder(alternative, this.key);\r\n        }\r\n    };\r\n    /**\r\n     * helper to override several implementations in a more fluent way\r\n     * by having a getClass operation we can avoid direct calls into the constructor or\r\n     * static methods and do not have to implement several methods which rely on the type\r\n     * of \"this\"\r\n     * @returns {Monadish.Optional}\r\n     */\r\n    ValueEmbedder.prototype.getClass = function () {\r\n        return ValueEmbedder;\r\n    };\r\n    ValueEmbedder.fromNullable = function (value, valueKey) {\r\n        if (valueKey === void 0) { valueKey = \"value\"; }\r\n        return new ValueEmbedder(value, valueKey);\r\n    };\r\n    /*default value for absent*/\r\n    ValueEmbedder.absent = ValueEmbedder.fromNullable(null);\r\n    return ValueEmbedder;\r\n}(Optional));\r\nexports.ValueEmbedder = ValueEmbedder;\r\n/**\r\n * specialized value embedder\r\n * for our Configuration\r\n */\r\nvar ConfigEntry = /** @class */ (function (_super) {\r\n    __extends(ConfigEntry, _super);\r\n    function ConfigEntry(rootElem, key, arrPos) {\r\n        var _this = _super.call(this, rootElem, key) || this;\r\n        _this.arrPos = (arrPos !== null && arrPos !== void 0 ? arrPos : -1);\r\n        return _this;\r\n    }\r\n    Object.defineProperty(ConfigEntry.prototype, \"value\", {\r\n        get: function () {\r\n            if (this.key == \"\" && this.arrPos >= 0) {\r\n                return this._value[this.arrPos];\r\n            }\r\n            else if (this.key && this.arrPos >= 0) {\r\n                return this._value[this.key][this.arrPos];\r\n            }\r\n            return this._value[this.key];\r\n        },\r\n        set: function (val) {\r\n            if (this.key == \"\" && this.arrPos >= 0) {\r\n                this._value[this.arrPos] = val;\r\n                return;\r\n            }\r\n            else if (this.key && this.arrPos >= 0) {\r\n                this._value[this.key][this.arrPos] = val;\r\n                return;\r\n            }\r\n            this._value[this.key] = val;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /*default value for absent*/\r\n    ConfigEntry.absent = ConfigEntry.fromNullable(null);\r\n    return ConfigEntry;\r\n}(ValueEmbedder));\r\n/**\r\n * Config, basically an optional wrapper for a json structure\r\n * (not sideeffect free, since we can alter the internal config state\r\n * without generating a new config), not sure if we should make it sideffect free\r\n * since this would swallow a lot of performane and ram\r\n */\r\nvar Config = /** @class */ (function (_super) {\r\n    __extends(Config, _super);\r\n    function Config(root) {\r\n        return _super.call(this, root) || this;\r\n    }\r\n    Object.defineProperty(Config.prototype, \"shallowCopy\", {\r\n        get: function () {\r\n            return new Config(Stream_1.Stream.ofAssoc(this.value).collect(new SourcesCollectors_1.AssocArrayCollector()));\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Config.prototype, \"deepCopy\", {\r\n        get: function () {\r\n            return new Config(objAssign({}, this.value));\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Config.fromNullable = function (value) {\r\n        return new Config(value);\r\n    };\r\n    /**\r\n     * simple merge for the root configs\r\n     */\r\n    Config.prototype.shallowMerge = function (other, overwrite) {\r\n        if (overwrite === void 0) { overwrite = true; }\r\n        for (var key in other.value) {\r\n            if (overwrite || !(key in this.value)) {\r\n                this.assign(key).value = other.getIf(key).value;\r\n            }\r\n        }\r\n    };\r\n    Config.prototype.assign = function () {\r\n        var keys = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            keys[_i] = arguments[_i];\r\n        }\r\n        if (keys.length < 1) {\r\n            return;\r\n        }\r\n        this.buildPath(keys);\r\n        var currKey = this.keyVal(keys[keys.length - 1]);\r\n        var arrPos = this.arrayIndex(keys[keys.length - 1]);\r\n        var retVal = new ConfigEntry(keys.length == 1 ? this.value : this.getIf.apply(this, keys.slice(0, keys.length - 1)).value, currKey, arrPos);\r\n        return retVal;\r\n    };\r\n    Config.prototype.assignIf = function (condition) {\r\n        var keys = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            keys[_i - 1] = arguments[_i];\r\n        }\r\n        return condition ? this.assign.apply(this, keys) : { value: null };\r\n    };\r\n    Config.prototype.getIf = function () {\r\n        var keys = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            keys[_i] = arguments[_i];\r\n        }\r\n        return this.getClass().fromNullable(_super.prototype.getIf.apply(this, keys).value);\r\n    };\r\n    Config.prototype.get = function (defaultVal) {\r\n        return this.getClass().fromNullable(_super.prototype.get.call(this, defaultVal).value);\r\n    };\r\n    //empties the current config entry\r\n    Config.prototype.delete = function (key) {\r\n        if (key in this.value) {\r\n            delete this.value[key];\r\n        }\r\n        return this;\r\n    };\r\n    Config.prototype.toJson = function () {\r\n        return JSON.stringify(this.value);\r\n    };\r\n    Config.prototype.getClass = function () {\r\n        return Config;\r\n    };\r\n    Config.prototype.setVal = function (val) {\r\n        this._value = val;\r\n    };\r\n    Config.prototype.buildPath = function (keys) {\r\n        var val = this;\r\n        var parentVal = this.getClass().fromNullable(null);\r\n        var parentPos = -1;\r\n        var alloc = function (arr, length) {\r\n            var length1 = arr.length;\r\n            var length2 = length1 + length;\r\n            for (var cnt = length1; cnt < length2; cnt++) {\r\n                arr.push({});\r\n            }\r\n        };\r\n        for (var cnt = 0; cnt < keys.length; cnt++) {\r\n            var currKey = this.keyVal(keys[cnt]);\r\n            var arrPos = this.arrayIndex(keys[cnt]);\r\n            if (currKey === \"\" && arrPos >= 0) {\r\n                val.setVal((val.value instanceof Array) ? val.value : []);\r\n                alloc(val.value, arrPos + 1);\r\n                if (parentPos >= 0) {\r\n                    parentVal.value[parentPos] = val.value;\r\n                }\r\n                parentVal = val;\r\n                parentPos = arrPos;\r\n                val = this.getClass().fromNullable(val.value[arrPos]);\r\n                continue;\r\n            }\r\n            var tempVal = val.getIf(currKey);\r\n            if (arrPos == -1) {\r\n                if (tempVal.isAbsent()) {\r\n                    tempVal = this.getClass().fromNullable(val.value[currKey] = {});\r\n                }\r\n                else {\r\n                    val = tempVal;\r\n                }\r\n            }\r\n            else {\r\n                var arr = (tempVal.value instanceof Array) ? tempVal.value : [];\r\n                alloc(arr, arrPos + 1);\r\n                val.value[currKey] = arr;\r\n                tempVal = this.getClass().fromNullable(arr[arrPos]);\r\n            }\r\n            parentVal = val;\r\n            parentPos = arrPos;\r\n            val = tempVal;\r\n        }\r\n        return this;\r\n    };\r\n    return Config;\r\n}(Optional));\r\nexports.Config = Config;\r\n","\"use strict\";\r\n/* Licensed to the Apache Software Foundation (ASF) under one or more\r\n * contributor license agreements.  See the NOTICE file distributed with\r\n * this work for additional information regarding copyright ownership.\r\n * The ASF licenses this file to you under the Apache License, Version 2.0\r\n * (the \"License\"); you may not use this file except in compliance with\r\n * the License.  You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n *\r\n * todo replace singleton with module definition\r\n *\r\n */\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Lang_1 = require(\"../../ext/monadish/Lang\");\r\nvar Messages_1 = require(\"../i18n/Messages\");\r\nvar DomQuery_1 = require(\"../../ext/monadish/DomQuery\");\r\nvar monadish_1 = require(\"../../ext/monadish\");\r\nvar ExtLang;\r\n(function (ExtLang) {\r\n    var installedLocale;\r\n    var nameSpace = \"impl/util/Lang/\";\r\n    function getLanguage() {\r\n        //TODO global config override\r\n        var _a, _b, _c;\r\n        var language = (_b = (_a = navigator.languages) === null || _a === void 0 ? void 0 : _a[0], (_b !== null && _b !== void 0 ? _b : (_c = navigator) === null || _c === void 0 ? void 0 : _c.language));\r\n        language = language.split(\"-\")[0];\r\n        return language;\r\n    }\r\n    ExtLang.getLanguage = getLanguage;\r\n    //should be in lang, but for now here to avoid recursive imports, not sure if typescript still has a problem with those\r\n    /**\r\n     * helper function to savely resolve anything\r\n     * this is not an elvis operator, it resolves\r\n     * a value without exception in a tree and if\r\n     * it is not resolvable then an optional of\r\n     * a default value is restored or Optional.empty\r\n     * if none is given\r\n     *\r\n     * usage\r\n     * <code>\r\n     *     let var: Optional<string> = saveResolve(() => a.b.c.d.e, \"foobaz\")\r\n     * </code>\r\n     *\r\n     * @param resolverProducer a lambda which can produce the value\r\n     * @param defaultValue an optional default value if the producer failes to produce anything\r\n     * @returns an Optional of the produced value\r\n     */\r\n    function failSaveResolve(resolverProducer, defaultValue) {\r\n        if (defaultValue === void 0) { defaultValue = null; }\r\n        return Lang_1.Lang.saveResolve(resolverProducer, defaultValue);\r\n    }\r\n    ExtLang.failSaveResolve = failSaveResolve;\r\n    function failSaveExecute(resolverProducer, defaultValue) {\r\n        if (defaultValue === void 0) { defaultValue = null; }\r\n        Lang_1.Lang.saveResolve(resolverProducer, defaultValue);\r\n    }\r\n    ExtLang.failSaveExecute = failSaveExecute;\r\n    /**\r\n     * returns a given localized message upon a given key\r\n     * basic java log like templating functionality is included\r\n     *\r\n     * @param {String} key the key for the message\r\n     * @param {String} defaultMessage optional default message if none was found\r\n     *\r\n     * Additionally you can pass additional arguments, which are used\r\n     * in the same way java log templates use the params\r\n     *\r\n     * @param templateParams the param list to be filled in\r\n     */\r\n    function getMessage(key, defaultMessage) {\r\n        var templateParams = [];\r\n        for (var _i = 2; _i < arguments.length; _i++) {\r\n            templateParams[_i - 2] = arguments[_i];\r\n        }\r\n        var _a, _b;\r\n        installedLocale = (installedLocale !== null && installedLocale !== void 0 ? installedLocale : new Messages_1.Messages());\r\n        var msg = (_b = (_a = installedLocale[key], (_a !== null && _a !== void 0 ? _a : defaultMessage)), (_b !== null && _b !== void 0 ? _b : key + \" - undefined message\"));\r\n        monadish_1.Stream.of.apply(monadish_1.Stream, templateParams).each(function (param, cnt) {\r\n            msg = msg.replace(new RegExp([\"\\\\{\", cnt, \"\\\\}\"].join(\"\"), \"g\"), param);\r\n        });\r\n        return msg;\r\n    }\r\n    ExtLang.getMessage = getMessage;\r\n    /**\r\n     * transforms a key value pair into a string\r\n     * @param key the key\r\n     * @param val the value\r\n     * @param delimiter the delimiter\r\n     */\r\n    function keyValToStr(key, val, delimiter) {\r\n        if (delimiter === void 0) { delimiter = \"\\n\"; }\r\n        return [key, val].join(delimiter);\r\n    }\r\n    ExtLang.keyValToStr = keyValToStr;\r\n    /**\r\n     * determines the correct event depending\r\n     * on the browsers state\r\n     *\r\n     * @param evt incoming event object (note not all browsers\r\n     * have this)\r\n     *\r\n     * @return an event object no matter what is incoming\r\n     */\r\n    function getEvent(evt) {\r\n        var _a, _b;\r\n        return _b = (evt !== null && evt !== void 0 ? evt : (_a = window) === null || _a === void 0 ? void 0 : _a.event), (_b !== null && _b !== void 0 ? _b : {});\r\n    }\r\n    ExtLang.getEvent = getEvent;\r\n    /**\r\n     * cross port from the dojo lib\r\n     * browser save event resolution\r\n     * @param evt the event object\r\n     * (with a fallback for ie events if none is present)\r\n     */\r\n    function getEventTarget(evt) {\r\n        var _a, _b, _c, _d, _e;\r\n        //ie6 and 7 fallback\r\n        evt = getEvent(evt);\r\n        /**\r\n         * evt source is defined in the jsf events\r\n         * seems like some component authors use our code\r\n         * so we add it here see also\r\n         * https://issues.apache.org/jira/browse/MYFACES-2458\r\n         * not entirely a bug but makes sense to add this\r\n         * behavior. I dont use it that way but nevertheless it\r\n         * does not break anything so why not\r\n         * */\r\n        var t = (_d = (_b = (_a = evt) === null || _a === void 0 ? void 0 : _a.srcElement, (_b !== null && _b !== void 0 ? _b : (_c = evt) === null || _c === void 0 ? void 0 : _c.target)), (_d !== null && _d !== void 0 ? _d : (_e = evt) === null || _e === void 0 ? void 0 : _e.source));\r\n        while ((t) && (t.nodeType != 1)) {\r\n            t = t.parentNode;\r\n        }\r\n        return t;\r\n    }\r\n    ExtLang.getEventTarget = getEventTarget;\r\n    /**\r\n     * creates an exeption with additional internal parameters\r\n     * for extra information\r\n     *\r\n     * @param {String} title the exception title\r\n     * @param {String} name  the exception name\r\n     * @param {String} callerCls the caller class\r\n     * @param {String} callFunc the caller function\r\n     * @param {String} message the message for the exception\r\n     */\r\n    function makeException(error, title, name, callerCls, callFunc, message) {\r\n        var _a;\r\n        return new Error((_a = message + ((callerCls !== null && callerCls !== void 0 ? callerCls : nameSpace)) + callFunc, (_a !== null && _a !== void 0 ? _a : (\"\" + arguments.caller.toString()))));\r\n    }\r\n    ExtLang.makeException = makeException;\r\n    /**\r\n     * fetches a global config entry\r\n     * @param {String} configName the name of the configuration entry\r\n     * @param {Object} defaultValue\r\n     *\r\n     * @return either the config entry or if none is given the default value\r\n     */\r\n    function getGlobalConfig(configName, defaultValue) {\r\n        var _a, _b, _c, _d;\r\n        /**\r\n         * note we could use exists but this is an heavy operation, since the config name usually\r\n         * given this function here is called very often\r\n         * is a single entry without . in between we can do the lighter shortcut\r\n         */\r\n        return _d = (_c = (_b = (_a = window) === null || _a === void 0 ? void 0 : _a.myfaces) === null || _b === void 0 ? void 0 : _b.config) === null || _c === void 0 ? void 0 : _c[configName], (_d !== null && _d !== void 0 ? _d : defaultValue);\r\n    }\r\n    ExtLang.getGlobalConfig = getGlobalConfig;\r\n    /**\r\n     * gets the local or global options with local ones having higher priority\r\n     * if no local or global one was found then the default value is given back\r\n     *\r\n     * @param {String} configName the name of the configuration entry\r\n     * @param {String} localOptions the local options root for the configuration myfaces as default marker is added implicitely\r\n     *\r\n     * @param {Object} defaultValue\r\n     *\r\n     * @return either the config entry or if none is given the default value\r\n     */\r\n    function getLocalOrGlobalConfig(localOptions, configName, defaultValue) {\r\n        var _a, _b, _c, _d, _e, _f, _g, _h;\r\n        return _h = (_d = (_c = (_b = (_a = localOptions.value) === null || _a === void 0 ? void 0 : _a.myfaces) === null || _b === void 0 ? void 0 : _b.config) === null || _c === void 0 ? void 0 : _c[configName], (_d !== null && _d !== void 0 ? _d : (_g = (_f = (_e = window) === null || _e === void 0 ? void 0 : _e.myfaces) === null || _f === void 0 ? void 0 : _f.config) === null || _g === void 0 ? void 0 : _g[configName])), (_h !== null && _h !== void 0 ? _h : defaultValue);\r\n    }\r\n    ExtLang.getLocalOrGlobalConfig = getLocalOrGlobalConfig;\r\n    ;\r\n    /**\r\n     * fetches the form in an unprecise manner depending\r\n     * on an element or event target\r\n     *\r\n     * @param elem\r\n     * @param event\r\n     */\r\n    function getForm(elem, event) {\r\n        var FORM = \"form\";\r\n        var queryElem = new DomQuery_1.DQ(elem);\r\n        var eventTarget = new DomQuery_1.DQ(ExtLang.getEventTarget(event));\r\n        if (queryElem.isTag(FORM)) {\r\n            return queryElem;\r\n        }\r\n        //html 5 for handling\r\n        if (queryElem.attr(FORM).isPresent()) {\r\n            var formId = queryElem.attr(FORM).value;\r\n            var foundForm = DomQuery_1.DQ.byId(formId);\r\n            if (foundForm.isPresent()) {\r\n                return foundForm;\r\n            }\r\n        }\r\n        var form = queryElem.parents(FORM)\r\n            .orElseLazy(function () { return queryElem.byTagName(FORM, true); })\r\n            .orElseLazy(function () { return eventTarget.parents(FORM); })\r\n            .orElseLazy(function () { return eventTarget.byTagName(FORM); })\r\n            .first();\r\n        assertFormExists(form);\r\n        return form;\r\n    }\r\n    ExtLang.getForm = getForm;\r\n    function assertFormExists(form) {\r\n        if (form.isAbsent()) {\r\n            throw makeException(new Error(), null, null, \"Impl\", \"getForm\", getMessage(\"ERR_FORM\"));\r\n        }\r\n    }\r\n})(ExtLang = exports.ExtLang || (exports.ExtLang = {}));\r\n","\"use strict\";\r\n/* Licensed to the Apache Software Foundation (ASF) under one or more\r\n * contributor license agreements.  See the NOTICE file distributed with\r\n * this work for additional information regarding copyright ownership.\r\n * The ASF licenses this file to you under the Apache License, Version 2.0\r\n * (the \"License\"); you may not use this file except in compliance with\r\n * the License.  You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Monad_1 = require(\"./Monad\");\r\n/**\r\n * Lang helpers crossported from the apache myfaces project\r\n */\r\nvar Lang;\r\n(function (Lang) {\r\n    //should be in lang, but for now here to avoid recursive imports, not sure if typescript still has a problem with those\r\n    /**\r\n     * helper function to savely resolve anything\r\n     * this is not an elvis operator, it resolves\r\n     * a value without exception in a tree and if\r\n     * it is not resolvable then an optional of\r\n     * a default value is restored or Optional.empty\r\n     * if none is given\r\n     *\r\n     * usage\r\n     * <code>\r\n     *     let var: Optiona<string> = saveResolve(() => a.b.c.d.e, \"foobaz\")\r\n     * </code>\r\n     *\r\n     * @param resolverProducer a lambda which can produce the value\r\n     * @param defaultValue an optional default value if the producer failes to produce anything\r\n     * @returns an Optional of the produced value\r\n     */\r\n    function saveResolve(resolverProducer, defaultValue) {\r\n        if (defaultValue === void 0) { defaultValue = null; }\r\n        try {\r\n            var result = resolverProducer();\r\n            return Monad_1.Optional.fromNullable((result !== null && result !== void 0 ? result : defaultValue));\r\n        }\r\n        catch (e) {\r\n            return Monad_1.Optional.absent;\r\n        }\r\n    }\r\n    Lang.saveResolve = saveResolve;\r\n    function saveResolveLazy(resolverProducer, defaultValue) {\r\n        if (defaultValue === void 0) { defaultValue = null; }\r\n        try {\r\n            var result = resolverProducer();\r\n            return Monad_1.Optional.fromNullable((result !== null && result !== void 0 ? result : defaultValue()));\r\n        }\r\n        catch (e) {\r\n            return Monad_1.Optional.absent;\r\n        }\r\n    }\r\n    Lang.saveResolveLazy = saveResolveLazy;\r\n    /**\r\n     * String to array function performs a string to array transformation\r\n     * @param {String} it the string which has to be changed into an array\r\n     * @param {RegExp} splitter our splitter reglar expression\r\n     * @return a trimmed array of the splitted string\r\n     */\r\n    function strToArray(it, splitter) {\r\n        if (splitter === void 0) { splitter = /\\./gi; }\r\n        var ret = [];\r\n        it.split(splitter).forEach((function (element) {\r\n            ret.push(trim(element));\r\n        }));\r\n        return ret;\r\n    }\r\n    Lang.strToArray = strToArray;\r\n    /**\r\n     * hyperfast trim\r\n     * http://blog.stevenlevithan.com/archives/faster-trim-javascript\r\n     * crossported from dojo\r\n     */\r\n    function trim(str) {\r\n        str = str.replace(/^\\s\\s*/, '');\r\n        var ws = /\\s/, i = str.length;\r\n        while (ws.test(str.charAt(--i))) {\r\n            //do nothing\r\n        }\r\n        return str.slice(0, i + 1);\r\n    }\r\n    Lang.trim = trim;\r\n    /**\r\n     * generic object arrays like dom definitions to array conversion method which\r\n     * transforms any object to something array like\r\n     * @param obj\r\n     * @param offset\r\n     * @param pack\r\n     * @returns an array converted from the object\r\n     */\r\n    function objToArray(obj, offset, pack) {\r\n        if (offset === void 0) { offset = 0; }\r\n        if (pack === void 0) { pack = []; }\r\n        if (((obj !== null && obj !== void 0 ? obj : \"__undefined__\")) == \"__undefined__\") {\r\n            return (pack !== null && pack !== void 0 ? pack : null);\r\n        }\r\n        //since offset is numeric we cannot use the shortcut due to 0 being false\r\n        //special condition array delivered no offset no pack\r\n        if (obj instanceof Array && !offset && !pack)\r\n            return obj;\r\n        return pack.concat(Array.prototype.slice.call(obj, offset));\r\n    }\r\n    Lang.objToArray = objToArray;\r\n    /**\r\n     * equalsIgnoreCase, case insensitive comparison of two strings\r\n     *\r\n     * @param source\r\n     * @param destination\r\n     */\r\n    function equalsIgnoreCase(source, destination) {\r\n        var finalSource = (source !== null && source !== void 0 ? source : \"___no_value__\");\r\n        var finalDest = (destination !== null && destination !== void 0 ? destination : \"___no_value__\");\r\n        //in any other case we do a strong string comparison\r\n        return finalSource.toLowerCase() === finalDest.toLowerCase();\r\n    }\r\n    Lang.equalsIgnoreCase = equalsIgnoreCase;\r\n    /**\r\n     * runtime type assertion\r\n     *\r\n     * @param probe the probe to be tested for a type\r\n     * @param theType the type to be tested for\r\n     */\r\n    function assertType(probe, theType) {\r\n        return isString(theType) ? typeof probe == theType : probe instanceof theType;\r\n    }\r\n    Lang.assertType = assertType;\r\n    /**\r\n     * Backported from dojo\r\n     * a failsafe string determination method\r\n     * (since in javascript String != \"\" typeof alone fails!)\r\n     * @param it {|Object|} the object to be checked for being a string\r\n     * @return true in case of being a string false otherwise\r\n     */\r\n    function isString(it) {\r\n        //\tsummary:\r\n        //\t\tReturn true if it is a String\r\n        return !!arguments.length && it != null && (typeof it == \"string\" || it instanceof String); // Boolean\r\n    }\r\n    Lang.isString = isString;\r\n    function isFunc(it) {\r\n        return it instanceof Function || typeof it === \"function\";\r\n    }\r\n    Lang.isFunc = isFunc;\r\n    // code from https://developer.mozilla.org/de/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\r\n    // license https://creativecommons.org/licenses/by-sa/2.5/\r\n    function objAssign(target) {\r\n        var theArgs = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            theArgs[_i - 1] = arguments[_i];\r\n        }\r\n        if (target == null) { // TypeError if undefined or null\r\n            throw new TypeError('Cannot convert undefined or null to object');\r\n        }\r\n        var to = Object(target);\r\n        if (Object.assign) {\r\n            theArgs.forEach(function (item) { return Object.assign(to, item); });\r\n            return to;\r\n        }\r\n        theArgs.forEach(function (item) {\r\n            var nextSource = item;\r\n            if (nextSource != null) { // Skip over if undefined or null\r\n                for (var nextKey in nextSource) {\r\n                    // Avoid bugs when hasOwnProperty is shadowed\r\n                    if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\r\n                        to[nextKey] = nextSource[nextKey];\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        return to;\r\n    }\r\n    Lang.objAssign = objAssign;\r\n})(Lang = exports.Lang || (exports.Lang = {}));\r\n","\"use strict\";\r\n/* Licensed to the Apache Software Foundation (ASF) under one or more\r\n * contributor license agreements.  See the NOTICE file distributed with\r\n * this work for additional information regarding copyright ownership.\r\n * The ASF licenses this file to you under the Apache License, Version 2.0\r\n * (the \"License\"); you may not use this file except in compliance with\r\n * the License.  You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/*\r\n * A small stream implementation\r\n */\r\nvar Monad_1 = require(\"./Monad\");\r\nvar SourcesCollectors_1 = require(\"./SourcesCollectors\");\r\n/**\r\n * A simple typescript based reimplementation of streams\r\n *\r\n * This is the early eval version\r\n * for a lazy eval version check, LazyStream, which is api compatible\r\n * to this implementation, however with the benefit of being able\r\n * to provide infinite data sources and generic data providers, the downside\r\n * is, it might be a tad slower in some situations\r\n */\r\nvar Stream = /** @class */ (function () {\r\n    function Stream() {\r\n        var value = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            value[_i] = arguments[_i];\r\n        }\r\n        this._limits = -1;\r\n        this.pos = -1;\r\n        this.value = value;\r\n    }\r\n    Stream.of = function () {\r\n        var data = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            data[_i] = arguments[_i];\r\n        }\r\n        return new (Stream.bind.apply(Stream, __spreadArrays([void 0], data)))();\r\n    };\r\n    Stream.ofAssoc = function (data) {\r\n        return this.of.apply(this, Object.keys(data)).map(function (key) { return [key, data[key]]; });\r\n    };\r\n    Stream.ofDataSource = function (dataSource) {\r\n        var value = [];\r\n        while (dataSource.hasNext()) {\r\n            value.push(dataSource.next());\r\n        }\r\n        return new (Stream.bind.apply(Stream, __spreadArrays([void 0], value)))();\r\n    };\r\n    Stream.prototype.limits = function (end) {\r\n        this._limits = end;\r\n        return this;\r\n    };\r\n    Stream.prototype.onElem = function (fn) {\r\n        for (var cnt = 0; cnt < this.value.length && (this._limits == -1 || cnt < this._limits); cnt++) {\r\n            if (fn(this.value[cnt], cnt) === false) {\r\n                break;\r\n            }\r\n        }\r\n        return this;\r\n    };\r\n    Stream.prototype.each = function (fn) {\r\n        this.onElem(fn);\r\n    };\r\n    Stream.prototype.map = function (fn) {\r\n        if (!fn) {\r\n            fn = function (inval) { return inval; };\r\n        }\r\n        var res = [];\r\n        this.each(function (item, cnt) {\r\n            res.push(fn(item));\r\n        });\r\n        return new (Stream.bind.apply(Stream, __spreadArrays([void 0], res)))();\r\n    };\r\n    /*\r\n     * we need to implement it to fullfill the contract, although it is used only internally\r\n     * all values are flattened when accessed anyway, so there is no need to call this methiod\r\n     */\r\n    Stream.prototype.flatMap = function (fn) {\r\n        var ret = [];\r\n        this.each(function (item) {\r\n            var strmR = fn(item);\r\n            ret = Array.isArray(strmR) ? ret.concat(strmR) : ret.concat.apply(ret, strmR.value);\r\n        });\r\n        return Stream.of.apply(Stream, ret);\r\n    };\r\n    Stream.prototype.filter = function (fn) {\r\n        var res = [];\r\n        this.each(function (data) {\r\n            if (fn(data)) {\r\n                res.push(data);\r\n            }\r\n        });\r\n        return new (Stream.bind.apply(Stream, __spreadArrays([void 0], res)))();\r\n    };\r\n    Stream.prototype.reduce = function (fn, startVal) {\r\n        if (startVal === void 0) { startVal = null; }\r\n        var offset = startVal != null ? 0 : 1;\r\n        var val1 = startVal != null ? startVal : this.value.length ? this.value[0] : null;\r\n        for (var cnt = offset; cnt < this.value.length && (this._limits == -1 || cnt < this._limits); cnt++) {\r\n            val1 = fn(val1, this.value[cnt]);\r\n        }\r\n        return Monad_1.Optional.fromNullable(val1);\r\n    };\r\n    Stream.prototype.first = function () {\r\n        return this.value && this.value.length ? Monad_1.Optional.fromNullable(this.value[0]) : Monad_1.Optional.absent;\r\n    };\r\n    Stream.prototype.last = function () {\r\n        //could be done via reduce, but is faster this way\r\n        var length = this._limits > 0 ? Math.min(this._limits, this.value.length) : this.value.length;\r\n        return Monad_1.Optional.fromNullable(length ? this.value[length - 1] : null);\r\n    };\r\n    Stream.prototype.anyMatch = function (fn) {\r\n        for (var cnt = 0; cnt < this.value.length && (this._limits == -1 || cnt < this._limits); cnt++) {\r\n            if (fn(this.value[cnt])) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n    Stream.prototype.allMatch = function (fn) {\r\n        if (!this.value.length) {\r\n            return false;\r\n        }\r\n        var matches = 0;\r\n        for (var cnt = 0; cnt < this.value.length; cnt++) {\r\n            if (fn(this.value[cnt])) {\r\n                matches++;\r\n            }\r\n        }\r\n        return matches == this.value.length;\r\n    };\r\n    Stream.prototype.noneMatch = function (fn) {\r\n        var matches = 0;\r\n        for (var cnt = 0; cnt < this.value.length; cnt++) {\r\n            if (!fn(this.value[cnt])) {\r\n                matches++;\r\n            }\r\n        }\r\n        return matches == this.value.length;\r\n    };\r\n    Stream.prototype.sort = function (comparator) {\r\n        var newArr = this.value.slice().sort(comparator);\r\n        return Stream.of.apply(Stream, newArr);\r\n    };\r\n    Stream.prototype.collect = function (collector) {\r\n        this.each(function (data) { return collector.collect(data); });\r\n        return collector.finalValue;\r\n    };\r\n    //-- internally exposed methods needed for the interconnectivity\r\n    Stream.prototype.hasNext = function () {\r\n        var isLimitsReached = this._limits != -1 && this.pos >= this._limits - 1;\r\n        var isEndOfArray = this.pos >= this.value.length - 1;\r\n        return !(isLimitsReached || isEndOfArray);\r\n    };\r\n    Stream.prototype.next = function () {\r\n        if (!this.hasNext()) {\r\n            return null;\r\n        }\r\n        this.pos++;\r\n        return this.value[this.pos];\r\n    };\r\n    Stream.prototype.reset = function () {\r\n        this.pos = -1;\r\n    };\r\n    return Stream;\r\n}());\r\nexports.Stream = Stream;\r\n/**\r\n * Lazy implementation of a Stream\r\n * The idea is to connect the intermediate\r\n * streams as datasources like a linked list\r\n * with reverse referencing and for special\r\n * operations like filtering flatmapping\r\n * have intermediate datasources in the list\r\n * with specialized functions.\r\n *\r\n * Sort of a modified pipe valve pattern\r\n * the streams are the pipes the intermediate\r\n * data sources are the valves\r\n *\r\n * We then can use passed in functions to control\r\n * the flow in the valves\r\n *\r\n * That way we can have a lazy evaluating stream\r\n *\r\n * So if an endpoint requests data\r\n * a callback trace goes back the stream list\r\n * which triggers an operation upwards\r\n * which sends data down the drain which then is processed\r\n * and filtered until one element hits the endpoint.\r\n *\r\n * That is repeated, until all elements are processed\r\n * or an internal limit is hit.\r\n *\r\n */\r\nvar LazyStream = /** @class */ (function () {\r\n    function LazyStream(parent) {\r\n        this._limits = -1;\r\n        /*\r\n         * needed to have the limits check working\r\n         * we need to keep track of the current position\r\n         * in the stream\r\n         */\r\n        this.pos = -1;\r\n        this.dataSource = parent;\r\n    }\r\n    LazyStream.of = function () {\r\n        var values = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            values[_i] = arguments[_i];\r\n        }\r\n        return new LazyStream(new (SourcesCollectors_1.ArrayStreamDataSource.bind.apply(SourcesCollectors_1.ArrayStreamDataSource, __spreadArrays([void 0], values)))());\r\n    };\r\n    LazyStream.ofAssoc = function (data) {\r\n        return this.of.apply(this, Object.keys(data)).map(function (key) { return [key, data[key]]; });\r\n    };\r\n    LazyStream.ofStreamDataSource = function (value) {\r\n        return new LazyStream(value);\r\n    };\r\n    LazyStream.prototype.hasNext = function () {\r\n        if (this.isOverLimits()) {\r\n            return false;\r\n        }\r\n        return this.dataSource.hasNext();\r\n    };\r\n    LazyStream.prototype.next = function () {\r\n        var next = this.dataSource.next();\r\n        // @ts-ignore\r\n        this.pos++;\r\n        return next;\r\n    };\r\n    LazyStream.prototype.reset = function () {\r\n        this.dataSource.reset();\r\n        this.pos = 0;\r\n        this._limits = -1;\r\n    };\r\n    LazyStream.prototype.nextFilter = function (fn) {\r\n        if (this.hasNext()) {\r\n            var newVal = this.next();\r\n            if (!fn(newVal)) {\r\n                return this.nextFilter(fn);\r\n            }\r\n            return newVal;\r\n        }\r\n        return null;\r\n    };\r\n    LazyStream.prototype.limits = function (max) {\r\n        this._limits = max;\r\n        return this;\r\n    };\r\n    //main stream methods\r\n    LazyStream.prototype.collect = function (collector) {\r\n        while (this.hasNext()) {\r\n            var t = this.next();\r\n            collector.collect(t);\r\n        }\r\n        return collector.finalValue;\r\n    };\r\n    LazyStream.prototype.onElem = function (fn) {\r\n        var _this = this;\r\n        return new LazyStream(new SourcesCollectors_1.MappedStreamDataSource(function (el) {\r\n            if (fn(el, _this.pos) === false) {\r\n                _this.stop();\r\n            }\r\n            return el;\r\n        }, this));\r\n    };\r\n    LazyStream.prototype.filter = function (fn) {\r\n        return new LazyStream(new SourcesCollectors_1.FilteredStreamDatasource(fn, this));\r\n    };\r\n    LazyStream.prototype.map = function (fn) {\r\n        return new LazyStream(new SourcesCollectors_1.MappedStreamDataSource(fn, this));\r\n    };\r\n    LazyStream.prototype.flatMap = function (fn) {\r\n        return new LazyStream(new SourcesCollectors_1.FlatMapStreamDataSource(fn, this));\r\n    };\r\n    //endpoint\r\n    LazyStream.prototype.each = function (fn) {\r\n        while (this.hasNext()) {\r\n            if (fn(this.next()) === false) {\r\n                this.stop();\r\n            }\r\n        }\r\n    };\r\n    LazyStream.prototype.reduce = function (fn, startVal) {\r\n        if (startVal === void 0) { startVal = null; }\r\n        if (!this.hasNext()) {\r\n            return Monad_1.Optional.absent;\r\n        }\r\n        var value1 = null;\r\n        var value2 = null;\r\n        if (startVal != null) {\r\n            value1 = startVal;\r\n            value2 = this.next();\r\n        }\r\n        else {\r\n            value1 = this.next();\r\n            if (!this.hasNext()) {\r\n                return Monad_1.Optional.fromNullable(value1);\r\n            }\r\n            value2 = this.next();\r\n        }\r\n        value1 = fn(value1, value2);\r\n        while (this.hasNext()) {\r\n            value2 = this.next();\r\n            value1 = fn(value1, value2);\r\n        }\r\n        return Monad_1.Optional.fromNullable(value1);\r\n    };\r\n    LazyStream.prototype.last = function () {\r\n        if (!this.hasNext()) {\r\n            return Monad_1.Optional.absent;\r\n        }\r\n        return this.reduce(function (el1, el2) { return el2; });\r\n    };\r\n    LazyStream.prototype.first = function () {\r\n        this.reset();\r\n        if (!this.hasNext()) {\r\n            return Monad_1.Optional.absent;\r\n        }\r\n        return Monad_1.Optional.fromNullable(this.next());\r\n    };\r\n    LazyStream.prototype.anyMatch = function (fn) {\r\n        while (this.hasNext()) {\r\n            if (fn(this.next())) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n    LazyStream.prototype.allMatch = function (fn) {\r\n        while (this.hasNext()) {\r\n            if (!fn(this.next())) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    };\r\n    LazyStream.prototype.noneMatch = function (fn) {\r\n        while (this.hasNext()) {\r\n            if (fn(this.next())) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    };\r\n    LazyStream.prototype.sort = function (comparator) {\r\n        var arr = this.collect(new SourcesCollectors_1.ArrayCollector());\r\n        arr = arr.sort(comparator);\r\n        return LazyStream.of.apply(LazyStream, arr);\r\n    };\r\n    Object.defineProperty(LazyStream.prototype, \"value\", {\r\n        get: function () {\r\n            return this.collect(new SourcesCollectors_1.ArrayCollector());\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    LazyStream.prototype.stop = function () {\r\n        this.pos = this._limits + 1000000000;\r\n    };\r\n    LazyStream.prototype.isOverLimits = function () {\r\n        return this._limits != -1 && this.pos >= this._limits - 1;\r\n    };\r\n    return LazyStream;\r\n}());\r\nexports.LazyStream = LazyStream;\r\n","\"use strict\";\r\n/* Licensed to the Apache Software Foundation (ASF) under one or more\r\n * contributor license agreements.  See the NOTICE file distributed with\r\n * this work for additional information regarding copyright ownership.\r\n * The ASF licenses this file to you under the Apache License, Version 2.0\r\n * (the \"License\"); you may not use this file except in compliance with\r\n * the License.  You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Stream_1 = require(\"./Stream\");\r\n/**\r\n * implementation of iteratable on top of array\r\n */\r\nvar ArrayStreamDataSource = /** @class */ (function () {\r\n    function ArrayStreamDataSource() {\r\n        var value = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            value[_i] = arguments[_i];\r\n        }\r\n        this.dataPos = -1;\r\n        this.value = value;\r\n    }\r\n    ArrayStreamDataSource.prototype.hasNext = function () {\r\n        return this.value.length - 1 > this.dataPos;\r\n    };\r\n    ArrayStreamDataSource.prototype.next = function () {\r\n        this.dataPos++;\r\n        return this.value[this.dataPos];\r\n    };\r\n    ArrayStreamDataSource.prototype.reset = function () {\r\n        this.dataPos = -1;\r\n    };\r\n    return ArrayStreamDataSource;\r\n}());\r\nexports.ArrayStreamDataSource = ArrayStreamDataSource;\r\n/**\r\n * an intermediate data source wich prefilters\r\n * incoming stream data\r\n * and lets only the data out which\r\n * passes the filter function check\r\n */\r\nvar FilteredStreamDatasource = /** @class */ (function () {\r\n    function FilteredStreamDatasource(filterFunc, parent) {\r\n        this.filteredNext = null;\r\n        this.filterFunc = filterFunc;\r\n        this.inputDataSource = parent;\r\n    }\r\n    /**\r\n     * in order to filter we have to make a look ahead until the\r\n     * first next allowed element\r\n     * hence we prefetch the element and then\r\n     * serve it via next\r\n     */\r\n    FilteredStreamDatasource.prototype.hasNext = function () {\r\n        while (this.filteredNext == null && this.inputDataSource.hasNext()) {\r\n            var next = this.inputDataSource.next();\r\n            if (this.filterFunc(next)) {\r\n                this.filteredNext = next;\r\n                return true;\r\n            }\r\n            else {\r\n                this.filteredNext = null;\r\n            }\r\n        }\r\n        return this.filteredNext != null;\r\n    };\r\n    /**\r\n     * serve the next element\r\n     */\r\n    FilteredStreamDatasource.prototype.next = function () {\r\n        var ret = this.filteredNext;\r\n        this.filteredNext = null;\r\n        //We have to call hasNext, to roll another\r\n        //prefetch in case someone runs next\r\n        //sequentially without calling hasNext\r\n        this.hasNext();\r\n        return ret;\r\n    };\r\n    FilteredStreamDatasource.prototype.reset = function () {\r\n        this.filteredNext = null;\r\n        this.inputDataSource.reset();\r\n    };\r\n    return FilteredStreamDatasource;\r\n}());\r\nexports.FilteredStreamDatasource = FilteredStreamDatasource;\r\n/**\r\n * an intermediate datasource which maps the items from\r\n * one into another\r\n */\r\nvar MappedStreamDataSource = /** @class */ (function () {\r\n    function MappedStreamDataSource(mapFunc, parent) {\r\n        this.mapFunc = mapFunc;\r\n        this.inputDataSource = parent;\r\n    }\r\n    MappedStreamDataSource.prototype.hasNext = function () {\r\n        return this.inputDataSource.hasNext();\r\n    };\r\n    MappedStreamDataSource.prototype.next = function () {\r\n        return this.mapFunc(this.inputDataSource.next());\r\n    };\r\n    MappedStreamDataSource.prototype.reset = function () {\r\n        this.inputDataSource.reset();\r\n    };\r\n    return MappedStreamDataSource;\r\n}());\r\nexports.MappedStreamDataSource = MappedStreamDataSource;\r\n/**\r\n * Same for flatmap to deal with element -> stream mappings\r\n */\r\nvar FlatMapStreamDataSource = /** @class */ (function () {\r\n    function FlatMapStreamDataSource(func, parent) {\r\n        this.mapFunc = func;\r\n        this.inputDataSource = parent;\r\n    }\r\n    FlatMapStreamDataSource.prototype.hasNext = function () {\r\n        return this.resolveCurrentNext() || this.resolveNextNext();\r\n    };\r\n    FlatMapStreamDataSource.prototype.resolveCurrentNext = function () {\r\n        var next = false;\r\n        if (this.activeDataSource) {\r\n            next = this.activeDataSource.hasNext();\r\n        }\r\n        return next;\r\n    };\r\n    FlatMapStreamDataSource.prototype.resolveNextNext = function () {\r\n        var next = false;\r\n        while (!next && this.inputDataSource.hasNext()) {\r\n            var mapped = this.mapFunc(this.inputDataSource.next());\r\n            if (Array.isArray(mapped)) {\r\n                this.activeDataSource = new (ArrayStreamDataSource.bind.apply(ArrayStreamDataSource, __spreadArrays([void 0], mapped)))();\r\n            }\r\n            else {\r\n                this.activeDataSource = mapped;\r\n            }\r\n            next = this.activeDataSource.hasNext();\r\n        }\r\n        return next;\r\n    };\r\n    FlatMapStreamDataSource.prototype.next = function () {\r\n        return this.activeDataSource.next();\r\n    };\r\n    FlatMapStreamDataSource.prototype.reset = function () {\r\n        this.inputDataSource.reset();\r\n    };\r\n    return FlatMapStreamDataSource;\r\n}());\r\nexports.FlatMapStreamDataSource = FlatMapStreamDataSource;\r\n/**\r\n * For the time being we only need one collector\r\n * a collector which collects a stream back into arrays\r\n */\r\nvar ArrayCollector = /** @class */ (function () {\r\n    function ArrayCollector() {\r\n        this.data = [];\r\n    }\r\n    ArrayCollector.prototype.collect = function (element) {\r\n        this.data.push(element);\r\n    };\r\n    Object.defineProperty(ArrayCollector.prototype, \"finalValue\", {\r\n        get: function () {\r\n            return this.data;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return ArrayCollector;\r\n}());\r\nexports.ArrayCollector = ArrayCollector;\r\n/**\r\n * collects an assoc stream back to an assoc array\r\n */\r\nvar AssocArrayCollector = /** @class */ (function () {\r\n    function AssocArrayCollector() {\r\n        this.finalValue = {};\r\n    }\r\n    AssocArrayCollector.prototype.collect = function (element) {\r\n        var _a, _b;\r\n        this.finalValue[_a = element[0], (_a !== null && _a !== void 0 ? _a : element)] = (_b = element[1], (_b !== null && _b !== void 0 ? _b : true));\r\n    };\r\n    return AssocArrayCollector;\r\n}());\r\nexports.AssocArrayCollector = AssocArrayCollector;\r\n/**\r\n * Form data collector for key value pair streams\r\n */\r\nvar FormDataCollector = /** @class */ (function () {\r\n    function FormDataCollector() {\r\n        this.finalValue = new FormData();\r\n    }\r\n    FormDataCollector.prototype.collect = function (element) {\r\n        this.finalValue.append(element.key, element.value);\r\n    };\r\n    return FormDataCollector;\r\n}());\r\nexports.FormDataCollector = FormDataCollector;\r\n/**\r\n * Form data collector for DomQuery streams\r\n */\r\nvar QueryFormDataCollector = /** @class */ (function () {\r\n    function QueryFormDataCollector() {\r\n        this.finalValue = new FormData();\r\n    }\r\n    QueryFormDataCollector.prototype.collect = function (element) {\r\n        var toMerge = element.encodeFormElement();\r\n        if (toMerge.isPresent()) {\r\n            this.finalValue.append(element.name.value, toMerge.get(element.name).value);\r\n        }\r\n    };\r\n    return QueryFormDataCollector;\r\n}());\r\nexports.QueryFormDataCollector = QueryFormDataCollector;\r\n/**\r\n * Encoded String collector from dom query streams\r\n */\r\nvar QueryFormStringCollector = /** @class */ (function () {\r\n    function QueryFormStringCollector() {\r\n        this.formData = [];\r\n    }\r\n    QueryFormStringCollector.prototype.collect = function (element) {\r\n        var toMerge = element.encodeFormElement();\r\n        if (toMerge.isPresent()) {\r\n            this.formData.push([element.name.value, toMerge.get(element.name).value]);\r\n        }\r\n    };\r\n    Object.defineProperty(QueryFormStringCollector.prototype, \"finalValue\", {\r\n        get: function () {\r\n            return Stream_1.Stream.of.apply(Stream_1.Stream, this.formData).map(function (keyVal) { return keyVal.join(\"=\"); })\r\n                .reduce(function (item1, item2) { return [item1, item2].join(\"&\"); })\r\n                .orElse(\"\").value;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return QueryFormStringCollector;\r\n}());\r\nexports.QueryFormStringCollector = QueryFormStringCollector;\r\n","\"use strict\";\r\n/* Licensed to the Apache Software Foundation (ASF) under one or more\r\n * contributor license agreements.  See the NOTICE file distributed with\r\n * this work for additional information regarding copyright ownership.\r\n * The ASF licenses this file to you under the Apache License, Version 2.0\r\n * (the \"License\"); you may not use this file except in compliance with\r\n * the License.  You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar myfacesConfig = require(\"../api/myfaces\");\r\nvar Response_1 = require(\"./xhrCore/Response\");\r\nvar XhrRequest_1 = require(\"./xhrCore/XhrRequest\");\r\nvar AsyncQueue_1 = require(\"./util/AsyncQueue\");\r\nvar Monad_1 = require(\"../ext/monadish/Monad\");\r\nvar Const_1 = require(\"./core/Const\");\r\nvar Assertions_1 = require(\"./util/Assertions\");\r\nvar XhrFormData_1 = require(\"./xhrCore/XhrFormData\");\r\nvar ExtDomQuery_1 = require(\"./util/ExtDomQuery\");\r\nvar ErrorData_1 = require(\"./xhrCore/ErrorData\");\r\nvar DomQuery_1 = require(\"../ext/monadish/DomQuery\");\r\nvar monadish_1 = require(\"../ext/monadish\");\r\nvar SourcesCollectors_1 = require(\"../ext/monadish/SourcesCollectors\");\r\nvar Lang_1 = require(\"./util/Lang\");\r\n/*\r\n * allowed project stages\r\n */\r\nvar ProjectStages;\r\n(function (ProjectStages) {\r\n    ProjectStages[\"Production\"] = \"Production\";\r\n    ProjectStages[\"Development\"] = \"Development\";\r\n    ProjectStages[\"SystemTest\"] = \"SystemTest\";\r\n    ProjectStages[\"UnitTest\"] = \"UnitTest\";\r\n})(ProjectStages || (ProjectStages = {}));\r\n/*\r\n *   blockfilter for the passthrough filtering; the attributes given here\r\n *   will not be transmitted from the options into the passthrough\r\n */\r\nvar BlockFilter;\r\n(function (BlockFilter) {\r\n    BlockFilter[\"onerror\"] = \"onerror\";\r\n    BlockFilter[\"onevent\"] = \"onevent\";\r\n    BlockFilter[\"render\"] = \"render\";\r\n    BlockFilter[\"execute\"] = \"execute\";\r\n    BlockFilter[\"myfaces\"] = \"myfaces\";\r\n    BlockFilter[\"delay\"] = \"delay\";\r\n    BlockFilter[\"timeout\"] = \"timeout\";\r\n    BlockFilter[\"windowId\"] = \"windowId\";\r\n})(BlockFilter || (BlockFilter = {}));\r\n/**\r\n * Core Implementation\r\n * to distinct between api and impl\r\n *\r\n * The original idea was to make the implementation pluggable\r\n * but this is pointless, you always can overwrite the thin api layer\r\n * however a dedicated api makes sense for readability reasons\r\n */\r\nvar Implementation;\r\n(function (Implementation) {\r\n    var trim = monadish_1.Lang.trim;\r\n    var getMessage = Lang_1.ExtLang.getMessage;\r\n    var getForm = Lang_1.ExtLang.getForm;\r\n    var getLocalOrGlobalConfig = Lang_1.ExtLang.getLocalOrGlobalConfig;\r\n    var getEvent = Lang_1.ExtLang.getEvent;\r\n    var getGlobalConfig = Lang_1.ExtLang.getGlobalConfig;\r\n    var assert = Assertions_1.Assertions.assert;\r\n    var globalConfig = myfacesConfig.myfaces.config;\r\n    var projectStage = null;\r\n    var separator = null;\r\n    var eventQueue = [];\r\n    var errorQueue = [];\r\n    Implementation.requestQueue = null;\r\n    /*error reporting threshold*/\r\n    var threshold = \"ERROR\";\r\n    //we need to proxy this in the tests\r\n    Implementation.queueHandler = {\r\n        /**\r\n         * public to make it shimmable for tests\r\n         */\r\n        addRequestToQueue: function (elem, form, reqCtx, respPassThr, delay, timeout) {\r\n            if (delay === void 0) { delay = 0; }\r\n            if (timeout === void 0) { timeout = 0; }\r\n            Implementation.requestQueue = (Implementation.requestQueue !== null && Implementation.requestQueue !== void 0 ? Implementation.requestQueue : new AsyncQueue_1.AsynchronouseQueue());\r\n            Implementation.requestQueue.enqueue(new XhrRequest_1.XhrRequest(elem, form, reqCtx, respPassThr, [], timeout), delay);\r\n        }\r\n    };\r\n    /**\r\n     * fetches the separator char from the given script tags\r\n     *\r\n     * @return {char} the separator char for the given script tags\r\n     */\r\n    function getSeparatorChar() {\r\n        var _a, _b, _c, _d, _e;\r\n        return _e = (_c = (_b = (_a = this) === null || _a === void 0 ? void 0 : _a.globalConfig) === null || _b === void 0 ? void 0 : _b.separator, (_c !== null && _c !== void 0 ? _c : (_d = this) === null || _d === void 0 ? void 0 : _d.separator)), (_e !== null && _e !== void 0 ? _e : (separator = ExtDomQuery_1.ExtDomquery.searchJsfJsFor(/separator=([^&;]*)/).orElse(\":\").value));\r\n    }\r\n    Implementation.getSeparatorChar = getSeparatorChar;\r\n    //for testing only\r\n    function reset() {\r\n        globalConfig = myfacesConfig.myfaces.config;\r\n        projectStage = null;\r\n        separator = null;\r\n        eventQueue = [];\r\n        errorQueue = [];\r\n        Implementation.requestQueue = null;\r\n    }\r\n    Implementation.reset = reset;\r\n    /**\r\n     * @return the project stage also emitted by the server:\r\n     * it cannot be cached and must be delivered over the server\r\n     * The value for it comes from the requestInternal parameter of the jsf.js script called \"stage\".\r\n     */\r\n    function getProjectStage() {\r\n        var _a, _b, _c, _d, _e;\r\n        return _e = (_c = (_b = (_a = this) === null || _a === void 0 ? void 0 : _a.globalConfig) === null || _b === void 0 ? void 0 : _b.projectStage, (_c !== null && _c !== void 0 ? _c : (_d = this) === null || _d === void 0 ? void 0 : _d.projectStage)), (_e !== null && _e !== void 0 ? _e : (projectStage = resolveProjectStateFromURL()));\r\n    }\r\n    Implementation.getProjectStage = getProjectStage;\r\n    function resolveProjectStateFromURL() {\r\n        /* run through all script tags and try to find the one that includes jsf.js */\r\n        var foundStage = ExtDomQuery_1.ExtDomquery.searchJsfJsFor(/stage=([^&;]*)/).value;\r\n        return (foundStage in ProjectStages) ? foundStage : null;\r\n    }\r\n    Implementation.resolveProjectStateFromURL = resolveProjectStateFromURL;\r\n    function chain(source, event) {\r\n        var funcs = [];\r\n        for (var _i = 2; _i < arguments.length; _i++) {\r\n            funcs[_i - 2] = arguments[_i];\r\n        }\r\n        var ret = true;\r\n        var resolveAndExecute = function (func) {\r\n            if (\"string\" != typeof func) {\r\n                return (ret = ret && (func.call(source, event) !== false));\r\n            }\r\n            else {\r\n                //either a function or a string can be passed in case of a string we have to wrap it into another function\r\n                //it it is not a plain executable code but a definition\r\n                var sourceCode = trim(func);\r\n                if (sourceCode.indexOf(\"function \") == 0) {\r\n                    sourceCode = \"return \" + sourceCode + \" (event)\";\r\n                }\r\n                return (ret = ret && (new Function(\"event\", sourceCode).call(source, event) !== false));\r\n            }\r\n        };\r\n        monadish_1.Stream.of.apply(monadish_1.Stream, funcs).each(function (func) { return resolveAndExecute(func); });\r\n        return ret;\r\n    }\r\n    Implementation.chain = chain;\r\n    /**\r\n     * this function has to send the ajax requests\r\n     *\r\n     * following request conditions must be met:\r\n     * <ul>\r\n     *  <li> the request must be sent asynchronously! </li>\r\n     *  <li> the request must be a POST!!! request </li>\r\n     *  <li> the request url must be the form action attribute </li>\r\n     *  <li> all requests must be queued with a client side request queue to ensure the request ordering!</li>\r\n     * </ul>\r\n     *\r\n     * @param {String|Node} elem any dom element no matter being it html or jsf, from which the event is emitted\r\n     * @param {|Event|} event any javascript event supported by that object\r\n     * @param {|Object|} options  map of options being pushed into the ajax cycle\r\n     *\r\n     *\r\n     * a) transformArguments out of the function\r\n     * b) passThrough handling with a map copy with a filter map block map\r\n     */\r\n    function request(el, event, opts) {\r\n        var _a, _b, _c, _d, _e, _f, _g, _h;\r\n        /*\r\n         *namespace remap for our local function context we mix the entire function namespace into\r\n         *a local function variable so that we do not have to write the entire namespace\r\n         *all the time\r\n         */\r\n        event = getEvent(event);\r\n        //options not set we define a default one with nothing\r\n        var options = new Monad_1.Config(opts).deepCopy;\r\n        var elem = DomQuery_1.DQ.byId(el || event.target);\r\n        var elementId = elem.id;\r\n        var requestCtx = new Monad_1.Config({});\r\n        var internalCtx = new Monad_1.Config({});\r\n        Assertions_1.Assertions.assertRequestIntegrity(options, elem);\r\n        applyWindowId(options);\r\n        requestCtx.assign(Const_1.Const.CTX_PARAM_PASS_THR).value = fetchPassthroughValues(options.value);\r\n        requestCtx.assignIf(!!event, Const_1.Const.CTX_PARAM_PASS_THR, Const_1.Const.P_EVT).value = (_a = event) === null || _a === void 0 ? void 0 : _a.type;\r\n        /**\r\n         * ajax pass through context with the source\r\n         * onevent and onerror\r\n         */\r\n        requestCtx.assign(Const_1.Const.SOURCE).value = elementId.value;\r\n        /**\r\n         * on event and onError...\r\n         * those values will be traversed later on\r\n         * also into the response context\r\n         */\r\n        requestCtx.assign(Const_1.Const.ON_EVENT).value = (_b = options.value) === null || _b === void 0 ? void 0 : _b.onevent;\r\n        requestCtx.assign(Const_1.Const.ON_ERROR).value = (_c = options.value) === null || _c === void 0 ? void 0 : _c.onerror;\r\n        /**\r\n         * lets drag the myfaces config params also in\r\n         */\r\n        requestCtx.assign(Const_1.Const.MYFACES).value = (_d = options.value) === null || _d === void 0 ? void 0 : _d.myfaces;\r\n        /**\r\n         * fetch the parent form\r\n         *\r\n         * note we also add an override possibility here\r\n         * so that people can use dummy forms and work\r\n         * with detached objects\r\n         */\r\n        var configId = (_g = (_f = (_e = requestCtx.value) === null || _e === void 0 ? void 0 : _e.myfaces) === null || _f === void 0 ? void 0 : _f.form, (_g !== null && _g !== void 0 ? _g : Const_1.Const.MF_NONE));\r\n        var form = resolveForm(requestCtx, elem, event);\r\n        /**\r\n         * binding contract the javax.faces.source must be set\r\n         */\r\n        requestCtx.assign(Const_1.Const.CTX_PARAM_PASS_THR, Const_1.Const.P_PARTIAL_SOURCE).value = elementId.value;\r\n        /**\r\n         * javax.faces.partial.ajax must be set to true\r\n         */\r\n        requestCtx.assign(Const_1.Const.CTX_PARAM_PASS_THR, Const_1.Const.P_AJAX).value = true;\r\n        /**\r\n         * binding contract the javax.faces.source must be set\r\n         */\r\n        requestCtx.assign(Const_1.Const.CTX_PARAM_PASS_THR, Const_1.Const.P_PARTIAL_SOURCE).value = elementId.value;\r\n        /**\r\n         * if resetValues is set to true\r\n         * then we have to set javax.faces.resetValues as well\r\n         * as pass through parameter\r\n         * the value has to be explicitly true, according to\r\n         * the specs jsdoc\r\n         */\r\n        requestCtx.assignIf(true === ((_h = options.value) === null || _h === void 0 ? void 0 : _h.resetValues), Const_1.Const.CTX_PARAM_PASS_THR, Const_1.Const.P_RESET_VALUES).value = true;\r\n        //additional meta information to speed things up, note internal non jsf\r\n        //pass through options are stored under _mfInternal in the context\r\n        internalCtx.assign(Const_1.Const.CTX_PARAM_SRC_FRM_ID).value = form.id.value;\r\n        internalCtx.assign(Const_1.Const.CTX_PARAM_SRC_CTL_ID).value = elementId.value;\r\n        internalCtx.assign(Const_1.Const.CTX_PARAM_TR_TYPE).value = Const_1.Const.REQ_TYPE_POST;\r\n        //mojarra compatibility, mojarra is sending the form id as well\r\n        //this is not documented behavior but can be determined by running\r\n        //mojarra under blackbox conditions\r\n        //i assume it does the same as our formId_submit=1 so leaving it out\r\n        //wont hurt but for the sake of compatibility we are going to add it\r\n        requestCtx.assign(Const_1.Const.CTX_PARAM_PASS_THR, form.id.value).value = form.id.value;\r\n        applyClientWindowId(form, requestCtx);\r\n        applyExecute(options, requestCtx, form, elementId.value);\r\n        applyRender(options, requestCtx, form, elementId.value);\r\n        var delay = resolveDelay(options, requestCtx);\r\n        var timeout = resolveTimeout(options, requestCtx);\r\n        //now we enqueue the request as asynchronous runnable into our request\r\n        //queue and let the queue take over the rest\r\n        Implementation.queueHandler.addRequestToQueue(elem, form, requestCtx, internalCtx, delay, timeout);\r\n    }\r\n    Implementation.request = request;\r\n    /**\r\n     * Spec. 13.3.3\r\n     * Examining the response markup and updating the DOM tree\r\n     * @param {XMLHttpRequest} request - the ajax request\r\n     * @param {Object} context - the ajax context\r\n     */\r\n    function response(request, context) {\r\n        Response_1.Response.processResponse(request, context);\r\n    }\r\n    Implementation.response = response;\r\n    function addOnError(errorListener) {\r\n        /*error handling already done in the assert of the queue*/\r\n        errorQueue.push(errorListener);\r\n    }\r\n    Implementation.addOnError = addOnError;\r\n    function addOnEvent(eventListener) {\r\n        /*error handling already done in the assert of the queue*/\r\n        eventQueue.push(eventListener);\r\n    }\r\n    Implementation.addOnEvent = addOnEvent;\r\n    /**\r\n     * sends an event\r\n     */\r\n    function sendEvent(data, localHandler) {\r\n        if (localHandler === void 0) { localHandler = function (data) { }; }\r\n        /*now we serve the queue as well*/\r\n        localHandler(data);\r\n        eventQueue.forEach(function (fn) { return fn(data); });\r\n    }\r\n    Implementation.sendEvent = sendEvent;\r\n    /**\r\n     * error handler behavior called internally\r\n     * and only into the impl it takes care of the\r\n     * internal message transformation to a myfaces internal error\r\n     * and then uses the standard send error mechanisms\r\n     * also a double error logging prevention is done as well\r\n     *\r\n     * @param request the request currently being processed\r\n     * @param context the context affected by this error\r\n     * @param exception the exception being thrown\r\n     * @param clearRequestQueue if set to true, clears the request queue of all pending requests\r\n     */\r\n    function stdErrorHandler(request, context, exception, clearRequestQueue) {\r\n        if (clearRequestQueue === void 0) { clearRequestQueue = false; }\r\n        //newer browsers do not allow to hold additional values on native objects like exceptions\r\n        //we hence capsule it into the request, which is gced automatically\r\n        //on ie as well, since the stdErrorHandler usually is called between requests\r\n        //this is a valid approach\r\n        try {\r\n            if (threshold == \"ERROR\") {\r\n                var errorData = ErrorData_1.ErrorData.fromClient(exception);\r\n                sendError(errorData);\r\n            }\r\n        }\r\n        finally {\r\n            if (clearRequestQueue) {\r\n                Implementation.requestQueue.cleanup();\r\n            }\r\n        }\r\n    }\r\n    Implementation.stdErrorHandler = stdErrorHandler;\r\n    /**\r\n     * implementation triggering the error chain\r\n     *\r\n     * @param {Object} request the request object which comes from the xhr cycle\r\n     * @param {Object} context (Map) the context object being pushed over the xhr cycle keeping additional metadata\r\n     * @param {String} errorName the error name\r\n     * @param {String} errorMessage the error name\r\n     * @param {String} responseCode response Code\r\n     * @param {String} responseMessage response Message\r\n     *\r\n     * @param {String} serverErrorName the server error name in case of a server error\r\n     * @param {String} serverErrorMessage the server error message in case of a server error\r\n     * @param {String} caller optional caller reference for extended error messages\r\n     * @param {String} callFunc optional caller Function reference for extended error messages\r\n     *\r\n     *  handles the errors, in case of an onError exists within the context the onError is called as local error handler\r\n     *  the registered error handlers in the queue receiv an error message to be dealt with\r\n     *  and if the projectStage is at development an alert box is displayed\r\n     *\r\n     *  note: we have additional functionality here, via the global config myfaces.config.defaultErrorOutput a function can be provided\r\n     *  which changes the default output behavior from alert to something else\r\n     *\r\n     *\r\n     */\r\n    function sendError(errorData, localHandler) {\r\n        if (localHandler === void 0) { localHandler = function (data) { }; }\r\n        localHandler(errorData);\r\n        errorQueue.forEach(function (errorCallback) {\r\n            errorCallback(errorData);\r\n        });\r\n        var displayError = getGlobalConfig(\"defaultErrorOutput\", (console ? console.error : alert));\r\n        displayError(errorData);\r\n    }\r\n    Implementation.sendError = sendError;\r\n    /**\r\n     * @return the client window id of the current window, if one is given\r\n     */\r\n    function getClientWindow(node) {\r\n        var _a;\r\n        var ALTERED = \"___mf_id_altered__\";\r\n        var INIT = \"___init____\";\r\n        /**\r\n         * the search root for the dom element search\r\n         */\r\n        var searchRoot = new DomQuery_1.DQ(node || document.body);\r\n        /**\r\n         * a set of input elements holding the window id over the entire document\r\n         */\r\n        var windowIdHolders = searchRoot.querySelectorAll(\"form #\" + Const_1.Const.P_WIN_ID);\r\n        /**\r\n         * lazy helper to fetch the window id from the window url\r\n         */\r\n        var fetchWindowIdFromUrl = function () { return ExtDomQuery_1.ExtDomquery.searchJsfJsFor(/jfwid=([^&;]*)/).orElse(null).value; };\r\n        /**\r\n         * functional double check based on stream reduction\r\n         * the values should be identical or on INIT value which is a premise to\r\n         * skip the first check\r\n         *\r\n         * @param value1\r\n         * @param value2\r\n         */\r\n        var doubleCheck = function (value1, value2) {\r\n            if (value1 == ALTERED) {\r\n                return value1;\r\n            }\r\n            else if (value1 == INIT) {\r\n                return value2;\r\n            }\r\n            else if (value1 != value2) {\r\n                return ALTERED;\r\n            }\r\n            return value2;\r\n        };\r\n        /**\r\n         * helper for cleaner code, maps the value from an item\r\n         *\r\n         * @param item\r\n         */\r\n        var getValue = function (item) { return item.attr(\"value\").value; };\r\n        /**\r\n         * fetch the window id from the forms\r\n         * window ids must be present in all forms\r\n         * or non existent. If they exist all of them must be the same\r\n         */\r\n        var formWindowId = searchRoot.stream.map(getValue).reduce(doubleCheck, INIT);\r\n        //if the resulting window id is set on altered then we have an unresolvable problem\r\n        assert(formWindowId.value != ALTERED, \"Multiple different windowIds found in document\");\r\n        /**\r\n         * return the window id or null\r\n         * prio, forms under node/document and if not given then from the url\r\n         */\r\n        return _a = formWindowId.value, (_a !== null && _a !== void 0 ? _a : fetchWindowIdFromUrl());\r\n    }\r\n    Implementation.getClientWindow = getClientWindow;\r\n    /**\r\n     * collect and encode data for a given form element (must be of type form)\r\n     * find the javax.faces.ViewState element and encode its value as well!\r\n     * return a concatenated string of the encoded values!\r\n     *\r\n     * @throws Error in case of the given element not being of type form!\r\n     * https://issues.apache.org/jira/browse/MYFACES-2110\r\n     */\r\n    function getViewState(form) {\r\n        /**\r\n         *  typecheck assert!, we opt for strong typing here\r\n         *  because it makes it easier to detect bugs\r\n         */\r\n        var element = DomQuery_1.DQ.byId(form);\r\n        if (!element.isTag(\"form\")) {\r\n            throw new Error(getMessage(\"ERR_VIEWSTATE\"));\r\n        }\r\n        var formData = new XhrFormData_1.XhrFormData(element);\r\n        return formData.toString();\r\n    }\r\n    Implementation.getViewState = getViewState;\r\n    //----------------------------------------------- Methods ---------------------------------------------------------------------\r\n    function applyWindowId(options) {\r\n        var _a, _b, _c;\r\n        var windowId = (_c = (_b = (_a = options) === null || _a === void 0 ? void 0 : _a.value) === null || _b === void 0 ? void 0 : _b.windowId, (_c !== null && _c !== void 0 ? _c : ExtDomQuery_1.ExtDomquery.windowId));\r\n        options.assignIf(!!windowId, Const_1.Const.P_WINDOW_ID).value = windowId;\r\n        options.delete(\"windowId\");\r\n    }\r\n    function applyRender(options, ctx, form, elementId) {\r\n        if (options.getIf(\"render\").isPresent()) {\r\n            transformValues(ctx.getIf(Const_1.Const.CTX_PARAM_PASS_THR).get({}), Const_1.Const.P_RENDER, options.getIf(\"render\").value, form, elementId);\r\n        }\r\n    }\r\n    function applyExecute(options, ctx, form, elementId) {\r\n        if (options.getIf(Const_1.Const.CTX_PARAM_EXECUTE).isPresent()) {\r\n            /*the options must be a blank delimited list of strings*/\r\n            /*compliance with Mojarra which automatically adds @this to an execute\r\n             * the spec rev 2.0a however states, if none is issued nothing at all should be sent down\r\n             */\r\n            options.assign(Const_1.Const.CTX_PARAM_EXECUTE).value = options.getIf(Const_1.Const.CTX_PARAM_EXECUTE).value + \" @this\";\r\n            transformValues(ctx.getIf(Const_1.Const.CTX_PARAM_PASS_THR).get({}), Const_1.Const.P_EXECUTE, options.getIf(Const_1.Const.CTX_PARAM_EXECUTE).value, form, elementId);\r\n        }\r\n        else {\r\n            ctx.assign(Const_1.Const.CTX_PARAM_PASS_THR, Const_1.Const.P_EXECUTE).value = elementId;\r\n        }\r\n    }\r\n    function applyClientWindowId(form, ctx) {\r\n        var clientWindow = jsf.getClientWindow(form.getAsElem(0).value);\r\n        if (clientWindow) {\r\n            ctx.assign(Const_1.Const.CTX_PARAM_PASS_THR, Const_1.Const.P_CLIENTWINDOW).value = clientWindow;\r\n        }\r\n    }\r\n    /**\r\n     * transforms the user values to the expected one\r\n     * with the proper none all form and this handling\r\n     * (note we also could use a simple string replace but then\r\n     * we would have had double entries under some circumstances)\r\n     *\r\n     * there are several standardized constants which need a special treatment\r\n     * like @all, @none, @form, @this\r\n     *\r\n     * @param targetConfig the target configuration receiving the final values\r\n     * @param targetKey the target key\r\n     * @param userValues the passed user values (aka input string which needs to be transformed)\r\n     * @param issuingForm the form where the issuing element originates\r\n     * @param issuingElementId the issuing element\r\n     */\r\n    function transformValues(targetConfig, targetKey, userValues, issuingForm, issuingElementId) {\r\n        //a cleaner implementation of the transform list method\r\n        var iterValues = (userValues) ? trim(userValues).split(/\\s+/gi) : [];\r\n        var ret = [];\r\n        var processed = {};\r\n        //TODO make this code cleaner\r\n        //the idea is simply to loop over all values and then replace\r\n        //their generic values and filter out doubles\r\n        //this is more readable than the old indexed based solution\r\n        //and not really slower because we had to build up the index in our old solution\r\n        //anyway\r\n        for (var cnt = 0; cnt < iterValues.length; cnt++) {\r\n            //avoid doubles\r\n            if (iterValues[cnt] in processed) {\r\n                continue;\r\n            }\r\n            switch (iterValues[cnt]) {\r\n                //@none no values should be sent\r\n                case Const_1.Const.IDENT_NONE:\r\n                    return targetConfig.delete(targetKey);\r\n                //@all is a pass through case according to the spec\r\n                case Const_1.Const.IDENT_ALL:\r\n                    targetConfig.assign(targetKey).value = Const_1.Const.IDENT_ALL;\r\n                    return targetConfig;\r\n                //@form pushes the issuing form id into our list\r\n                case Const_1.Const.IDENT_FORM:\r\n                    ret.push(issuingForm.id.value);\r\n                    processed[issuingForm.id.value] = true;\r\n                    break;\r\n                //@this is replaced with the current issuing element id\r\n                case Const_1.Const.IDENT_THIS:\r\n                    if (!(issuingElementId in processed)) {\r\n                        ret.push(issuingElementId);\r\n                        processed[issuingElementId] = true;\r\n                    }\r\n                    break;\r\n                default:\r\n                    ret.push(iterValues[cnt]);\r\n                    processed[iterValues[cnt]] = true;\r\n            }\r\n        }\r\n        //We now add the target as joined list\r\n        targetConfig.assign(targetKey).value = ret.join(\" \");\r\n        return targetConfig;\r\n    }\r\n    function fetchPassthroughValues(mappedOpts) {\r\n        return monadish_1.Stream.ofAssoc(mappedOpts)\r\n            .filter(function (item) { return !(item[0] in BlockFilter); })\r\n            .collect(new SourcesCollectors_1.AssocArrayCollector());\r\n    }\r\n    function resolveForm(requestCtx, elem, event) {\r\n        var _a, _b, _c;\r\n        var configId = (_c = (_b = (_a = requestCtx.value) === null || _a === void 0 ? void 0 : _a.myfaces) === null || _b === void 0 ? void 0 : _b.form, (_c !== null && _c !== void 0 ? _c : Const_1.Const.MF_NONE)); //requestCtx.getIf(MYFACES, \"form\").orElse(MF_NONE).value;\r\n        var form = DomQuery_1.DQ\r\n            .byId(configId)\r\n            .orElseLazy(function () { return getForm(elem.getAsElem(0).value, event); });\r\n        return form;\r\n    }\r\n    function resolveTimeout(options, requestCtx) {\r\n        var _a;\r\n        var getCfg = getLocalOrGlobalConfig;\r\n        return _a = options.getIf(Const_1.Const.CTX_PARAM_TIMEOUT).value, (_a !== null && _a !== void 0 ? _a : getCfg(requestCtx.value, Const_1.Const.CTX_PARAM_TIMEOUT, 0));\r\n    }\r\n    function resolveDelay(options, requestCtx) {\r\n        var _a;\r\n        var getCfg = getLocalOrGlobalConfig;\r\n        return _a = options.getIf(Const_1.Const.CTX_PARAM_DELAY).value, (_a !== null && _a !== void 0 ? _a : getCfg(requestCtx.value, Const_1.Const.CTX_PARAM_DELAY, 0));\r\n    }\r\n})(Implementation = exports.Implementation || (exports.Implementation = {}));\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar monadish_1 = require(\"../../ext/monadish\");\r\nvar Const_1 = require(\"../core/Const\");\r\nvar Lang_1 = require(\"./Lang\");\r\nvar getMessage = Lang_1.ExtLang.getMessage;\r\nvar makeException = Lang_1.ExtLang.makeException;\r\n/**\r\n * a set of internal code assertions\r\n * which raise an error\r\n *\r\n */\r\nvar Assertions;\r\n(function (Assertions) {\r\n    function assertRequestIntegrity(options, elem) {\r\n        /*assert if the onerror is set and once if it is set it must be of type function*/\r\n        assertFunction(options.getIf(Const_1.Const.ON_ERROR).value);\r\n        /*assert if the onevent is set and once if it is set it must be of type function*/\r\n        assertFunction(options.getIf(Const_1.Const.ON_EVENT).value);\r\n        //improve the error messages if an empty elem is passed\r\n        //Assertions.assertElementExists(elem);\r\n        assert(elem.isPresent(), getMessage(\"ERR_MUST_BE_PROVIDED1\", \"{0}: source  must be provided or exist\", \"source element id\"), \"jsf.ajax.request\", \"ArgNotSet\");\r\n    }\r\n    Assertions.assertRequestIntegrity = assertRequestIntegrity;\r\n    function assertUrlExists(node) {\r\n        if (node.attr(Const_1.Const.ATTR_URL).isAbsent()) {\r\n            throw Assertions.raiseError(new Error(), getMessage(\"ERR_RED_URL\", null, \"_Ajaxthis.processRedirect\"), \"processRedirect\");\r\n        }\r\n    }\r\n    Assertions.assertUrlExists = assertUrlExists;\r\n    /**\r\n     * checks the xml for various issues which can occur\r\n     * and prevent a proper processing\r\n     */\r\n    function assertValidXMLResponse(responseXML) {\r\n        assert(!responseXML.isAbsent(), Const_1.Const.EMPTY_RESPONSE, Const_1.Const.PHASE_PROCESS_RESPONSE);\r\n        assert(!responseXML.isXMLParserError(), responseXML.parserErrorText(\"\"), Const_1.Const.PHASE_PROCESS_RESPONSE);\r\n        assert(responseXML.querySelectorAll(Const_1.Const.RESP_PARTIAL).isPresent(), Const_1.Const.ERR_NO_PARTIAL_RESPONSE, Const_1.Const.PHASE_PROCESS_RESPONSE);\r\n    }\r\n    Assertions.assertValidXMLResponse = assertValidXMLResponse;\r\n    /**\r\n     * internal helper which raises an error in the\r\n     * format we need for further processing\r\n     *\r\n     * @param message the message\r\n     * @param title the title of the error (optional)\r\n     * @param name the name of the error (optional)\r\n     */\r\n    function raiseError(error, message, caller, title, name) {\r\n        var finalTitle = (title !== null && title !== void 0 ? title : Const_1.Const.MALFORMEDXML);\r\n        var finalName = (name !== null && name !== void 0 ? name : Const_1.Const.MALFORMEDXML);\r\n        var finalMessage = (message !== null && message !== void 0 ? message : \"\");\r\n        //TODO clean up the messy makeException, this is a perfect case for encapsulation and sane defaults\r\n        return makeException(error, finalTitle, finalName, \"Response\", caller || ((arguments.caller) ? arguments.caller.toString() : \"_raiseError\"), finalMessage);\r\n    }\r\n    Assertions.raiseError = raiseError;\r\n    /*\r\n     * using the new typescript 3.7 compiler assertion functionality to improve compiler hinting\r\n     * we are not fully there yet, but soon\r\n     */\r\n    function assert(value, msg, caller, title) {\r\n        if (msg === void 0) { msg = \"\"; }\r\n        if (caller === void 0) { caller = \"\"; }\r\n        if (title === void 0) { title = \"Assertion Error\"; }\r\n        if (!value) {\r\n            throw Assertions.raiseError(new Error(), msg, caller, title);\r\n        }\r\n    }\r\n    Assertions.assert = assert;\r\n    function assertType(value, theType, msg, caller, title) {\r\n        if (msg === void 0) { msg = \"\"; }\r\n        if (caller === void 0) { caller = \"\"; }\r\n        if (title === void 0) { title = \"Type Assertion Error\"; }\r\n        if ((!!value) && !monadish_1.Lang.assertType(value, theType)) {\r\n            throw Assertions.raiseError(new Error(), msg, caller, title);\r\n        }\r\n    }\r\n    Assertions.assertType = assertType;\r\n    function assertFunction(value, msg, caller, title) {\r\n        if (msg === void 0) { msg = \"\"; }\r\n        if (caller === void 0) { caller = \"\"; }\r\n        if (title === void 0) { title = \"Assertion Error\"; }\r\n        assertType(value, \"function\", msg, caller, title);\r\n    }\r\n    Assertions.assertFunction = assertFunction;\r\n})(Assertions = exports.Assertions || (exports.Assertions = {}));\r\n","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Const_1 = require(\"../core/Const\");\r\nvar EventData_1 = require(\"./EventData\");\r\nvar Lang_1 = require(\"../util/Lang\");\r\nvar getMessage = Lang_1.ExtLang.getMessage;\r\nvar ErrorType;\r\n(function (ErrorType) {\r\n    ErrorType[\"SERVER_ERROR\"] = \"serverError\";\r\n    ErrorType[\"HTTP_ERROR\"] = \"httpError\";\r\n    ErrorType[\"CLIENT_ERROR\"] = \"clientErrror\";\r\n    ErrorType[\"TIMEOUT\"] = \"timeout\";\r\n})(ErrorType = exports.ErrorType || (exports.ErrorType = {}));\r\n/**\r\n * the spec has a problem of having the error\r\n * object somewhat underspecified, there is no clear\r\n * description of the required contents.\r\n * I want to streamline it with mojarra here\r\n * hence we are going to move\r\n * everything into the same attributes,\r\n * I will add deprecated myfaces backwards compatibility attributes as well\r\n */\r\nvar ErrorData = /** @class */ (function (_super) {\r\n    __extends(ErrorData, _super);\r\n    function ErrorData(source, errorName, errorMessage, responseText, responseXML, responseCode, status, type) {\r\n        if (responseText === void 0) { responseText = null; }\r\n        if (responseXML === void 0) { responseXML = null; }\r\n        if (responseCode === void 0) { responseCode = \"200\"; }\r\n        if (status === void 0) { status = \"UNKNOWN\"; }\r\n        if (type === void 0) { type = ErrorType.CLIENT_ERROR; }\r\n        var _this = _super.call(this) || this;\r\n        _this.type = \"error\";\r\n        _this.source = source;\r\n        _this.type = \"error\";\r\n        _this.errorName = errorName;\r\n        _this.message = _this.errorMessage = errorMessage;\r\n        _this.responseCode = responseCode;\r\n        _this.responseText = responseText;\r\n        _this.status = status;\r\n        _this.typeDetails = type;\r\n        if (type == ErrorType.SERVER_ERROR) {\r\n            _this.serverErrorName = _this.errorName;\r\n            _this.serverErrorMessage = _this.errorMessage;\r\n        }\r\n        return _this;\r\n    }\r\n    ErrorData.fromClient = function (e) {\r\n        return new ErrorData(\"client\", e.name, e.message, e.stack);\r\n    };\r\n    ErrorData.fromHttpConnection = function (source, name, message, responseText, responseCode) {\r\n        return new ErrorData(source, name, message, responseText, responseCode, null, \"UNKNOWN\", ErrorType.HTTP_ERROR);\r\n    };\r\n    ErrorData.fromGeneric = function (context, errorCode, errorType) {\r\n        var UNKNOWN = \"UNKNOWN\";\r\n        var getMsg = this.getMsg;\r\n        var source = getMsg(context, Const_1.Const.SOURCE);\r\n        var errorName = getMsg(context, Const_1.Const.ERROR_NAME);\r\n        var errorMessage = getMsg(context, Const_1.Const.ERROR_MESSAGE);\r\n        var status = getMsg(context, Const_1.Const.STATUS);\r\n        var responseText = getMsg(context, Const_1.Const.RESPONSE_TEXT);\r\n        var responseXML = getMsg(context, Const_1.Const.RESPONSE_XML);\r\n        return new ErrorData(source, name, errorMessage, responseText, responseXML, errorCode + \"\", status, ErrorType.SERVER_ERROR);\r\n    };\r\n    ErrorData.getMsg = function (context, param) {\r\n        var UNKNOWN = \"UNKNOWN\";\r\n        return getMessage(context.getIf(param).orElse(UNKNOWN).value);\r\n    };\r\n    ErrorData.fromServerError = function (context) {\r\n        return this.fromGeneric(context, -1, ErrorType.SERVER_ERROR);\r\n    };\r\n    return ErrorData;\r\n}(EventData_1.EventData));\r\nexports.ErrorData = ErrorData;\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar monadish_1 = require(\"../../ext/monadish\");\r\nvar Const_1 = require(\"../core/Const\");\r\nvar Lang_1 = require(\"../util/Lang\");\r\nvar getMessage = Lang_1.ExtLang.getMessage;\r\nvar EventData = /** @class */ (function () {\r\n    function EventData() {\r\n    }\r\n    EventData.createFromRequest = function (request, context, /*event name*/ name) {\r\n        var _a, _b, _c, _d;\r\n        var eventData = new EventData();\r\n        var UNKNOWN = getMessage(\"UNKNOWN\");\r\n        eventData.type = Const_1.Const.EVENT;\r\n        eventData.status = name;\r\n        var sourceId = context.getIf(Const_1.Const.SOURCE)\r\n            .orElse(context.getIf(Const_1.Const.P_PARTIAL_SOURCE).value)\r\n            .orElse(context.getIf(Const_1.Const.CTX_PARAM_PASS_THR, Const_1.Const.P_PARTIAL_SOURCE).value).value;\r\n        if (sourceId) {\r\n            eventData.source = monadish_1.DQ.byId(sourceId).first().value.value;\r\n        }\r\n        if (name !== Const_1.Const.BEGIN) {\r\n            eventData.responseCode = (_b = (_a = request) === null || _a === void 0 ? void 0 : _a.status) === null || _b === void 0 ? void 0 : _b.toString();\r\n            eventData.responseText = (_c = request) === null || _c === void 0 ? void 0 : _c.responseText;\r\n            eventData.responseXML = (_d = request) === null || _d === void 0 ? void 0 : _d.responseXML;\r\n        }\r\n        return eventData;\r\n    };\r\n    return EventData;\r\n}());\r\nexports.EventData = EventData;\r\n","\"use strict\";\r\n/* Licensed to the Apache Software Foundation (ASF) under one or more\r\n * contributor license agreements.  See the NOTICE file distributed with\r\n * this work for additional information regarding copyright ownership.\r\n * The ASF licenses this file to you under the Apache License, Version 2.0\r\n * (the \"License\"); you may not use this file except in compliance with\r\n * the License.  You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\nvar _a, _b, _c;\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n///<reference path='./ApiInterfaces.ts'/>\r\n///<reference types='../../Types/Types'/>\r\nvar AjaxImpl_1 = require(\"../impl/AjaxImpl\");\r\nvar PushImpl_1 = require(\"../impl/PushImpl\");\r\nvar mf_impl = (_c = (_b = (_a = window) === null || _a === void 0 ? void 0 : _a.myfaces) === null || _b === void 0 ? void 0 : _b._impl, (_c !== null && _c !== void 0 ? _c : {}));\r\nvar jsf;\r\n(function (jsf) {\r\n    \"use strict\";\r\n    /*\r\n     * Version of the implementation for the jsf.js.\r\n     * <p />\r\n     * as specified within the jsf specifications jsf.html:\r\n     * <ul>\r\n     * <li>left two digits major release number</li>\r\n     * <li>middle two digits minor spec release number</li>\r\n     * <li>right two digits bug release number</li>\r\n     * </ul>\r\n     * @constant\r\n     */\r\n    jsf.specversion = 220000;\r\n    /**\r\n     * Implementation version as specified within the jsf specification.\r\n     * <p />\r\n     * A number increased with every implementation version\r\n     * and reset by moving to a new spec release number\r\n     *\r\n     * @constant\r\n     */\r\n    jsf.implversion = 0;\r\n    /**\r\n     * SeparatorChar as defined by UINamingContainer.getNamingContainerSeparatorChar()\r\n     * @type {Char}\r\n     */\r\n    jsf.separatorchar = getSeparatorChar();\r\n    /**\r\n     * This method is responsible for the return of a given project stage as defined\r\n     * by the jsf specification.\r\n     * <p/>\r\n     * Valid return values are:\r\n     * <ul>\r\n     *     <li>&quot;Production&quot;</li>\r\n     *     <li>&quot;Development&quot;</li>\r\n     *     <li>&quot;SystemTest&quot;</li>\r\n     *     <li>&quot;UnitTest&quot;</li>\r\n     * </li>\r\n     *\r\n     * @return {String} the current project state emitted by the server side method:\r\n     * <i>javax.faces.application.Application.getProjectStage()</i>\r\n     */\r\n    function getProjectStage() {\r\n        return AjaxImpl_1.Implementation.getProjectStage();\r\n    }\r\n    jsf.getProjectStage = getProjectStage;\r\n    /**\r\n     * collect and encode data for a given form element (must be of type form)\r\n     * find the javax.faces.ViewState element and encode its value as well!\r\n     * return a concatenated string of the encoded values!\r\n     *\r\n     * @throws an exception in case of the given element not being of type form!\r\n     * https://issues.apache.org/jira/browse/MYFACES-2110\r\n     */\r\n    function getViewState(formElement) {\r\n        return AjaxImpl_1.Implementation.getViewState(formElement);\r\n    }\r\n    jsf.getViewState = getViewState;\r\n    /**\r\n     * returns the window identifier for the given node / window\r\n     * @param {optional String | DomNode}  the node for which the client identifier has to be determined\r\n     * @return the window identifier or null if none is found\r\n     */\r\n    function getClientWindow(rootNode) {\r\n        return AjaxImpl_1.Implementation.getClientWindow(rootNode);\r\n    }\r\n    jsf.getClientWindow = getClientWindow;\r\n    //private helper functions\r\n    function getSeparatorChar() {\r\n        return AjaxImpl_1.Implementation.getSeparatorChar();\r\n    }\r\n    //We hook the old namespace system into our npm system\r\n    if (\"undefined\" == window.jsf) {\r\n        window.jsf = jsf;\r\n    }\r\n    var ajax;\r\n    (function (ajax) {\r\n        \"use strict\";\r\n        /**\r\n         * this function has to send the ajax requests\r\n         *\r\n         * following requestInternal conditions must be met:\r\n         * <ul>\r\n         *  <li> the requestInternal must be sent asynchronously! </li>\r\n         *  <li> the requestInternal must be a POST!!! requestInternal </li>\r\n         *  <li> the requestInternal url must be the form action attribute </li>\r\n         *  <li> all requests must be queued with a client side requestInternal queue to ensure the requestInternal ordering!</li>\r\n         * </ul>\r\n         *\r\n         * @param {String|Node} element: any dom element no matter being it html or jsf, from which the event is emitted\r\n         * @param {EVENT} event: any javascript event supported by that object\r\n         * @param {Map} options : map of options being pushed into the ajax cycle\r\n         */\r\n        function request(element, event, options) {\r\n            AjaxImpl_1.Implementation.request(element, event, options);\r\n            //Implementation.getInstance().requestInternal(element, event, options);\r\n        }\r\n        ajax.request = request;\r\n        /**\r\n         * response handler\r\n         * @param request the request object having triggered this response\r\n         * @param context the request context\r\n         *\r\n         * TODO add info on what can be in the context\r\n         */\r\n        function response(request, context) {\r\n            AjaxImpl_1.Implementation.response(request, context);\r\n        }\r\n        ajax.response = response;\r\n        /**\r\n         * Adds an error handler to our global error queue.\r\n         * the error handler must be of the format <i>function errorListener(&lt;errorData&gt;)</i>\r\n         * with errorData being of following format:\r\n         * <ul>\r\n         *     <li> errorData.type : &quot;error&quot;</li>\r\n         *     <li> errorData.status : the error status message</li>\r\n         *     <li> errorData.serverErrorName : the server error name in case of a server error</li>\r\n         *     <li> errorData.serverErrorMessage : the server error message in case of a server error</li>\r\n         *     <li> errorData.source  : the issuing source element which triggered the requestInternal </li>\r\n         *     <li> eventData.responseCode: the response code (aka http requestInternal response code, 401 etc...) </li>\r\n         *     <li> eventData.responseText: the requestInternal response text </li>\r\n         *     <li> eventData.responseXML: the requestInternal response xml </li>\r\n         * </ul>\r\n         *\r\n         * @param {function} errorListener error handler must be of the format <i>function errorListener(&lt;errorData&gt;)</i>\r\n         */\r\n        function addOnError(errorFunc) {\r\n            AjaxImpl_1.Implementation.addOnError(errorFunc);\r\n        }\r\n        ajax.addOnError = addOnError;\r\n        /**\r\n         * Adds a global event listener to the ajax event queue. The event listener must be a function\r\n         * of following format: <i>function eventListener(&lt;eventData&gt;)</i>\r\n         *\r\n         * @param {function} eventListener event must be of the format <i>function eventListener(&lt;eventData&gt;)</i>\r\n         */\r\n        function addOnEvent(eventFunc) {\r\n            AjaxImpl_1.Implementation.addOnEvent(eventFunc);\r\n        }\r\n        ajax.addOnEvent = addOnEvent;\r\n    })(ajax = jsf.ajax || (jsf.ajax = {}));\r\n    var util;\r\n    (function (util) {\r\n        /**\r\n         * varargs function which executes a chain of code (functions or any other code)\r\n         *\r\n         * if any of the code returns false, the execution\r\n         * is terminated prematurely skipping the rest of the code!\r\n         *\r\n         * @param {DomNode} source, the callee object\r\n         * @param {Event} event, the event object of the callee event triggering this function\r\n         * @param funcs ... arbitrary array of functions or strings\r\n         * @returns true if the chain has succeeded false otherwise\r\n         */\r\n        function chain(source, event) {\r\n            var funcs = [];\r\n            for (var _i = 2; _i < arguments.length; _i++) {\r\n                funcs[_i - 2] = arguments[_i];\r\n            }\r\n            return AjaxImpl_1.Implementation.chain.apply(AjaxImpl_1.Implementation, __spreadArrays([source, event], funcs));\r\n        }\r\n        util.chain = chain;\r\n    })(util = jsf.util || (jsf.util = {}));\r\n    var push;\r\n    (function (push) {\r\n        /**\r\n         * @param {function} onopen The function to be invoked when the web socket is opened.\r\n         * @param {function} onmessage The function to be invoked when a message is received.\r\n         * @param {function} onclose The function to be invoked when the web socket is closed.\r\n         * @param {boolean} autoconnect Whether or not to immediately open the socket. Defaults to <code>false</code>.\r\n         */\r\n        function init(socketClientId, uri, channel, onopen, onmessage, onclose, behaviorScripts, autoconnect) {\r\n            PushImpl_1.PushImpl.init(socketClientId, uri, channel, onopen, onmessage, onclose, behaviorScripts, autoconnect);\r\n        }\r\n        push.init = init;\r\n        /**\r\n         * Open the web socket on the given channel.\r\n         * @param {string} channel The name of the web socket channel.\r\n         * @throws {Error} When channel is unknown.\r\n         */\r\n        function open(socketClientId) {\r\n            PushImpl_1.PushImpl.open(socketClientId);\r\n        }\r\n        push.open = open;\r\n        /**\r\n         * Close the web socket on the given channel.\r\n         * @param {string} channel The name of the web socket channel.\r\n         * @throws {Error} When channel is unknown.\r\n         */\r\n        function close(socketClientId) {\r\n            PushImpl_1.PushImpl.close(socketClientId);\r\n        }\r\n        push.close = close;\r\n    })(push = jsf.push || (jsf.push = {}));\r\n})(jsf = exports.jsf || (exports.jsf = {}));\r\n//fullfill the window contract\r\nvar myfaces2;\r\n(function (myfaces2) {\r\n    //legacy compatibility\r\n    myfaces2._impl = mf_impl;\r\n    /**\r\n     * AB function similar to mojarra and Primefaces\r\n     * not part of the spec but a convenience accesor method\r\n     * Code provided by Thomas Andraschko\r\n     *\r\n     * @param source the event source\r\n     * @param event the event\r\n     * @param eventName event name for java.javax.faces.behavior.evemnt\r\n     * @param execute execute list as passed down in jsf.ajax.request\r\n     * @param render\r\n     * @param options\r\n     */\r\n    function ab(source, event, eventName, execute, render, options) {\r\n        if (options === void 0) { options = {}; }\r\n        if (eventName) {\r\n            options[\"javax.faces.behavior.event\"] = eventName;\r\n        }\r\n        if (execute) {\r\n            options[\"execute\"] = execute;\r\n        }\r\n        if (render) {\r\n            options[\"render\"] = render;\r\n        }\r\n        jsf.ajax.request(source, event, options);\r\n    }\r\n    myfaces2.ab = ab;\r\n})(myfaces2 = exports.myfaces2 || (exports.myfaces2 = {}));\r\n","\"use strict\";\r\n/* Licensed to the Apache Software Foundation (ASF) under one or more\r\n * contributor license agreements.  See the NOTICE file distributed with\r\n * this work for additional information regarding copyright ownership.\r\n * The ASF licenses this file to you under the Apache License, Version 2.0\r\n * (the \"License\"); you may not use this file except in compliance with\r\n * the License.  You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar monadish_1 = require(\"../../ext/monadish\");\r\nvar Const_1 = require(\"../core/Const\");\r\nvar Stream_1 = require(\"../../ext/monadish/Stream\");\r\nvar DomQuery_1 = require(\"../../ext/monadish/DomQuery\");\r\nvar isString = monadish_1.Lang.isString;\r\n/**\r\n * we simplify now compared to the old form handling\r\n * given that we have a configuration in place we can recycle that\r\n * for the entire parameter generation\r\n * then we have two fallbacks one for the non multipart case\r\n * the other one for the multipart case\r\n *\r\n * From outside we work on a single form configuration\r\n * which we can use like any other config\r\n *\r\n * TODO make this code smaller we might have\r\n * enough leverage in the streams collectors\r\n * api just to do that.\r\n */\r\nvar XhrFormData = /** @class */ (function (_super) {\r\n    __extends(XhrFormData, _super);\r\n    /**\r\n     * by the time we hit this code, datasource already must be of type form\r\n     *\r\n     * @param dataSource either a form as domquery object or an encoded url string\r\n     * @param partialIdsArray partial ids to collect\r\n     */\r\n    function XhrFormData(dataSource, partialIdsArray) {\r\n        var _this = _super.call(this, {}) || this;\r\n        _this.dataSource = dataSource;\r\n        _this.partialIdsArray = partialIdsArray;\r\n        //a call to getViewState before must pass the encoded line\r\n        //a call from getViewState passes the form element as datasource\r\n        //so we have two call points\r\n        if (isString(dataSource)) {\r\n            _this.handleStringSource();\r\n        }\r\n        else {\r\n            _this.handleFormSource();\r\n        }\r\n        return _this;\r\n    }\r\n    XhrFormData.prototype.handleFormSource = function () {\r\n        //encode and append the issuing item if not a partial ids array of ids is passed\r\n        /*\r\n         * Spec. 13.3.1\r\n         * Collect and encode input elements.\r\n         * Additionally the hidden element javax.faces.ViewState\r\n         * Enhancement partial page submit\r\n         *\r\n         */\r\n        this.encodeSubmittableFields(this, this.dataSource, this.partialIdsArray);\r\n        if (this.getIf(Const_1.Const.P_VIEWSTATE).isPresent()) {\r\n            return;\r\n        }\r\n        this.applyViewState(this.dataSource);\r\n    };\r\n    XhrFormData.prototype.handleStringSource = function () {\r\n        this.mergeEncodedString(this.dataSource);\r\n        return;\r\n    };\r\n    XhrFormData.prototype.applyViewState = function (form) {\r\n        var _this = this;\r\n        form.byId(Const_1.Const.P_VIEWSTATE)\r\n            .ifPresentLazy(function (elem) {\r\n            var value = elem.inputValue.value;\r\n            _this.assignIf(!!value, Const_1.Const.P_VIEWSTATE).value = value;\r\n        });\r\n    };\r\n    XhrFormData.prototype.mergeEncodedString = function (encoded) {\r\n        var _this = this;\r\n        var splittedEntries = encoded.split(/\\&/gi);\r\n        Stream_1.Stream.of.apply(Stream_1.Stream, splittedEntries).map(function (line) { return line.split(/\\=/gi); })\r\n            .each(function (keyVal) {\r\n            _this.assign(keyVal[0]).value = keyVal[1] || null;\r\n        });\r\n    };\r\n    // noinspection JSUnusedGlobalSymbols\r\n    /**\r\n     * @returns a Form data representation\r\n     */\r\n    XhrFormData.prototype.toFormData = function () {\r\n        var ret = new FormData();\r\n        for (var key in this.value) {\r\n            if (this.value.hasOwnProperty(key)) {\r\n                ret.append(key, this.value[key]);\r\n            }\r\n        }\r\n        return ret;\r\n    };\r\n    /**\r\n     * returns an encoded string representation of our xhr form data\r\n     *\r\n     * @param defaultStr optional default value if nothing is there to encode\r\n     */\r\n    XhrFormData.prototype.toString = function (defaultStr) {\r\n        if (defaultStr === void 0) { defaultStr = \"\"; }\r\n        if (this.isAbsent()) {\r\n            return defaultStr;\r\n        }\r\n        var entries = [];\r\n        for (var key in this.value) {\r\n            if (this.value.hasOwnProperty(key)) {\r\n                //key value already encoded so no need to reencode them again\r\n                entries.push(key + \"=\" + this.value[key]);\r\n            }\r\n        }\r\n        return entries.join(\"&\");\r\n    };\r\n    /**\r\n     * determines fields to submit\r\n     * @param {Object} targetBuf - the target form buffer receiving the data\r\n     * @param {Node} parentItem - form element item is nested in\r\n     * @param {Array} partialIds - ids fo PPS\r\n     */\r\n    XhrFormData.prototype.encodeSubmittableFields = function (targetBuf, parentItem, partialIds) {\r\n        var toEncode = null;\r\n        if (this.partialIdsArray && this.partialIdsArray.length) {\r\n            //in case of our myfaces reduced ppr we only\r\n            //only submit the partials\r\n            //TODO maybe also the window id and other defaults lets see\r\n            //this is not a spec case anyway\r\n            this._value = {};\r\n            toEncode = new (DomQuery_1.DQ.bind.apply(DomQuery_1.DQ, __spreadArrays([void 0], this.partialIdsArray)))();\r\n        }\r\n        else {\r\n            if (parentItem.isAbsent())\r\n                throw \"NO_PARITEM\";\r\n            toEncode = parentItem;\r\n        }\r\n        //lets encode the form elements\r\n        this.shallowMerge(toEncode.querySelectorAll(\"input, checkbox, select, textarea\").encodeFormElement());\r\n    };\r\n    Object.defineProperty(XhrFormData.prototype, \"isMultipartRequest\", {\r\n        get: function () {\r\n            return this.dataSource instanceof DomQuery_1.DQ && this.dataSource.querySelectorAll(\"input[type='file']\").isPresent();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return XhrFormData;\r\n}(monadish_1.Config));\r\nexports.XhrFormData = XhrFormData;\r\n","\"use strict\";\r\n/* Licensed to the Apache Software Foundation (ASF) under one or more\r\n * contributor license agreements.  See the NOTICE file distributed with\r\n * this work for additional information regarding copyright ownership.\r\n * The ASF licenses this file to you under the Apache License, Version 2.0\r\n * (the \"License\"); you may not use this file except in compliance with\r\n * the License.  You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar myfaces;\r\n(function (myfaces) {\r\n    var ConfigHolder = /** @class */ (function () {\r\n        function ConfigHolder() {\r\n            this.projectStage = null;\r\n            this.separator = null;\r\n        }\r\n        return ConfigHolder;\r\n    }());\r\n    myfaces.ConfigHolder = ConfigHolder;\r\n    myfaces.config = new ConfigHolder();\r\n    //if (window && \"undefined\" == typeof window.myfaces) {\r\n    //    window.myfaces = myfaces;\r\n    //}\r\n})(myfaces = exports.myfaces || (exports.myfaces = {}));\r\n","\"use strict\";\r\n/* Licensed to the Apache Software Foundation (ASF) under one or more\r\n * contributor license agreements.  See the NOTICE file distributed with\r\n * this work for additional information regarding copyright ownership.\r\n * The ASF licenses this file to you under the Apache License, Version 2.0\r\n * (the \"License\"); you may not use this file except in compliance with\r\n * the License.  You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar monadish_1 = require(\"../../ext/monadish\");\r\nvar Const_1 = require(\"../core/Const\");\r\nvar ResponseProcessor_1 = require(\"./ResponseProcessor\");\r\nvar ResonseDataResolver_1 = require(\"./ResonseDataResolver\");\r\nvar Response;\r\n(function (Response) {\r\n    var resolveResponseXML = ResonseDataResolver_1.ResonseDataResolver.resolveResponseXML;\r\n    var resolveContexts = ResonseDataResolver_1.ResonseDataResolver.resolveContexts;\r\n    /**\r\n     * Standardized jsf.js response\r\n     * this one is called straight from jsf.js.response\r\n     *\r\n     * The processing follows the spec by going for the responseXML\r\n     * and processing its tags\r\n     *\r\n     * @param {XMLHttpRequest} request (xhrRequest) - xhr request object\r\n     * @param {[key: string]: any} context (Map) - AJAX context\r\n     *\r\n     */\r\n    function processResponse(request, context) {\r\n        var req = monadish_1.Config.fromNullable(request);\r\n        var _a = resolveContexts(context), externalContext = _a.externalContext, internalContext = _a.internalContext;\r\n        var responseXML = resolveResponseXML(req);\r\n        var responseProcessor = new ResponseProcessor_1.ResponseProcessor(req, externalContext, internalContext);\r\n        internalContext.assign(Const_1.Const.RESPONSE_XML).value = responseXML;\r\n        //we now process the partial tags, or in none given raise an error\r\n        responseXML.querySelectorAll(Const_1.Const.RESP_PARTIAL)\r\n            .each(function (item) { return processPartialTag(item, responseProcessor, internalContext); });\r\n        //we now process the viewstates and the evals deferred\r\n        //the reason for this is that often it is better\r\n        //to wait until the document has caught up before\r\n        //doing any evals even on embedded scripts\r\n        responseProcessor.fixViewStates();\r\n        responseProcessor.globalEval();\r\n        responseProcessor.done();\r\n    }\r\n    Response.processResponse = processResponse;\r\n    /**\r\n     * highest node partial-response from there the main operations are triggered\r\n     */\r\n    function processPartialTag(node, responseProcessor, internalContext) {\r\n        internalContext.assign(Const_1.Const.PARTIAL_ID).value = node.id;\r\n        var SEL_SUB_TAGS = [Const_1.Const.CMD_ERROR, Const_1.Const.CMD_REDIRECT, Const_1.Const.CMD_CHANGES].join(\",\");\r\n        //now we can process the main operations\r\n        node.getIf(SEL_SUB_TAGS).each(function (node) {\r\n            switch (node.tagName.value) {\r\n                case Const_1.Const.CMD_ERROR:\r\n                    responseProcessor.error(node);\r\n                    break;\r\n                case Const_1.Const.CMD_REDIRECT:\r\n                    responseProcessor.redirect(node);\r\n                    break;\r\n                case Const_1.Const.CMD_CHANGES:\r\n                    processChangesTag(node, responseProcessor);\r\n                    break;\r\n            }\r\n        });\r\n    }\r\n    var processInsert = function (responseProcessor, node) {\r\n        //path1 insert after as child tags\r\n        if (node.querySelectorAll([Const_1.Const.TAG_BEFORE, Const_1.Const.TAG_AFTER].join(\",\")).length) {\r\n            responseProcessor.insertWithSubtags(node);\r\n        }\r\n        else { //insert before after with id\r\n            responseProcessor.insert(node);\r\n        }\r\n    };\r\n    /**\r\n     * next level changes tag\r\n     *\r\n     * @param node\r\n     * @param responseProcessor\r\n     */\r\n    function processChangesTag(node, responseProcessor) {\r\n        var ALLOWED_TAGS = [Const_1.Const.CMD_UPDATE, Const_1.Const.CMD_EVAL, Const_1.Const.CMD_INSERT, Const_1.Const.CMD_DELETE, Const_1.Const.CMD_ATTRIBUTES, Const_1.Const.CMD_EXTENSION].join(\",\");\r\n        node.getIf(ALLOWED_TAGS).each(function (node) {\r\n            switch (node.tagName.value) {\r\n                case Const_1.Const.CMD_UPDATE:\r\n                    processUpdateTag(node, responseProcessor);\r\n                    break;\r\n                case Const_1.Const.CMD_EVAL:\r\n                    responseProcessor.eval(node);\r\n                    break;\r\n                case Const_1.Const.CMD_INSERT:\r\n                    processInsert(responseProcessor, node);\r\n                    break;\r\n                case Const_1.Const.CMD_DELETE:\r\n                    responseProcessor.delete(node);\r\n                    break;\r\n                case Const_1.Const.CMD_ATTRIBUTES:\r\n                    responseProcessor.attributes(node);\r\n                    break;\r\n                case Const_1.Const.CMD_EXTENSION:\r\n                    break;\r\n            }\r\n        });\r\n        return true;\r\n    }\r\n    /**\r\n     * branch tag update.. drill further down into the updates\r\n     * special case viewstate in that case it is a leaf\r\n     * and the viewstate must be processed\r\n     *\r\n     * @param node\r\n     * @param responseProcessor\r\n     */\r\n    function processUpdateTag(node, responseProcessor) {\r\n        if (!responseProcessor.processViewState(node)) {\r\n            handleElementUpdate(node, responseProcessor);\r\n        }\r\n    }\r\n    /**\r\n     * element update\r\n     *\r\n     * @param node\r\n     * @param responseProcessor\r\n     */\r\n    function handleElementUpdate(node, responseProcessor) {\r\n        var cdataBlock = node.cDATAAsString;\r\n        switch (node.id.value) {\r\n            case Const_1.Const.P_VIEWROOT:\r\n                responseProcessor.replaceViewRoot(monadish_1.DQ.fromMarkup(cdataBlock.substring(cdataBlock.indexOf(\"<html\"))));\r\n                break;\r\n            case Const_1.Const.P_VIEWHEAD:\r\n                responseProcessor.replaceHead(monadish_1.DQ.fromMarkup(cdataBlock));\r\n                break;\r\n            case Const_1.Const.P_VIEWBODY:\r\n                responseProcessor.replaceBody(monadish_1.DQ.fromMarkup(cdataBlock));\r\n                break;\r\n            default: //htmlItem replacement\r\n                responseProcessor.update(node, cdataBlock);\r\n                break;\r\n        }\r\n    }\r\n})(Response = exports.Response || (exports.Response = {}));\r\n","\"use strict\";\r\n/* Licensed to the Apache Software Foundation (ASF) under one or more\r\n * contributor license agreements.  See the NOTICE file distributed with\r\n * this work for additional information regarding copyright ownership.\r\n * The ASF licenses this file to you under the Apache License, Version 2.0\r\n * (the \"License\"); you may not use this file except in compliance with\r\n * the License.  You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Lang_1 = require(\"./Lang\");\r\nvar DomQuery_1 = require(\"./DomQuery\");\r\nvar isString = Lang_1.Lang.isString;\r\n/**\r\n * xml query as specialized case for DomQuery\r\n */\r\nvar XMLQuery = /** @class */ (function (_super) {\r\n    __extends(XMLQuery, _super);\r\n    function XMLQuery(rootNode, docType) {\r\n        if (docType === void 0) { docType = \"text/xml\"; }\r\n        var _this = this;\r\n        var createIe11DomQueryShim = function () {\r\n            //at the time if wroting ie11 is the only relevant browser\r\n            //left withut any DomQuery support\r\n            var parser = new ActiveXObject(\"Microsoft.XMLDOM\");\r\n            parser.async = false;\r\n            //we shim th dom parser from ie in\r\n            return {\r\n                parseFromString: function (text, contentType) {\r\n                    return parser.loadXML(text);\r\n                }\r\n            };\r\n        };\r\n        var parseXML = function (xml) {\r\n            if (xml == null) {\r\n                return null;\r\n            }\r\n            var domParser = Lang_1.Lang.saveResolveLazy(function () { return new window.DOMParser(); }, function () { return createIe11DomQueryShim(); }).value;\r\n            return domParser.parseFromString(xml, docType);\r\n        };\r\n        if (isString(rootNode)) {\r\n            _this = _super.call(this, parseXML(rootNode)) || this;\r\n        }\r\n        else {\r\n            _this = _super.call(this, rootNode) || this;\r\n        }\r\n        return _this;\r\n    }\r\n    XMLQuery.prototype.isXMLParserError = function () {\r\n        return this.querySelectorAll(\"parsererror\").isPresent();\r\n    };\r\n    XMLQuery.prototype.toString = function () {\r\n        var ret = [];\r\n        this.eachElem(function (node) {\r\n            var _a, _b, _c, _d, _e;\r\n            var serialized = (_d = (_c = (_b = (_a = window) === null || _a === void 0 ? void 0 : _a.XMLSerializer) === null || _b === void 0 ? void 0 : _b.constructor()) === null || _c === void 0 ? void 0 : _c.serializeToString(node), (_d !== null && _d !== void 0 ? _d : (_e = node) === null || _e === void 0 ? void 0 : _e.xml));\r\n            if (!!serialized) {\r\n                ret.push(serialized);\r\n            }\r\n        });\r\n        return ret.join(\"\");\r\n    };\r\n    XMLQuery.prototype.parserErrorText = function (joinstr) {\r\n        return this.querySelectorAll(\"parsererror\").textContent(joinstr);\r\n    };\r\n    XMLQuery.parseXML = function (txt) {\r\n        return new XMLQuery(txt);\r\n    };\r\n    XMLQuery.parseHTML = function (txt) {\r\n        return new XMLQuery(txt, \"text/html\");\r\n    };\r\n    XMLQuery.fromString = function (txt, parseType) {\r\n        if (parseType === void 0) { parseType = \"text/xml\"; }\r\n        return new XMLQuery(txt, parseType);\r\n    };\r\n    return XMLQuery;\r\n}(DomQuery_1.DomQuery));\r\nexports.XMLQuery = XMLQuery;\r\nexports.XQ = XMLQuery;\r\n","\"use strict\";\r\n/* Licensed to the Apache Software Foundation (ASF) under one or more\r\n * contributor license agreements.  See the NOTICE file distributed with\r\n * this work for additional information regarding copyright ownership.\r\n * The ASF licenses this file to you under the Apache License, Version 2.0\r\n * (the \"License\"); you may not use this file except in compliance with\r\n * the License.  You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar monadish_1 = require(\"../../ext/monadish\");\r\nvar Const_1 = require(\"../core/Const\");\r\nvar AjaxImpl_1 = require(\"../AjaxImpl\");\r\nvar Assertions_1 = require(\"../util/Assertions\");\r\nvar ErrorData_1 = require(\"./ErrorData\");\r\nvar DomQuery_1 = require(\"../../ext/monadish/DomQuery\");\r\nvar Lang_1 = require(\"../util/Lang\");\r\nvar trim = monadish_1.Lang.trim;\r\nvar getLocalOrGlobalConfig = Lang_1.ExtLang.getLocalOrGlobalConfig;\r\nvar ImplTypes_1 = require(\"../core/ImplTypes\");\r\nvar EventData_1 = require(\"./EventData\");\r\n/**\r\n * Response processor\r\n *\r\n * Each  XML tag is either a node or a leaf\r\n * or both\r\n *\r\n * the processor provides a set of operations\r\n * which are executed on a single leaf node per operation\r\n * and present the core functionality of our response\r\n *\r\n */\r\nvar ResponseProcessor = /** @class */ (function () {\r\n    function ResponseProcessor(request, externalContext, internalContext) {\r\n        this.request = request;\r\n        this.externalContext = externalContext;\r\n        this.internalContext = internalContext;\r\n    }\r\n    ResponseProcessor.prototype.replaceHead = function (shadowDocument) {\r\n        var shadowHead = shadowDocument.querySelectorAll(Const_1.Const.TAG_HEAD);\r\n        if (!shadowHead.isPresent()) {\r\n            return;\r\n        }\r\n        var shadowInnerHTML = shadowHead.html().value;\r\n        var oldHead = DomQuery_1.DQ.querySelectorAll(Const_1.Const.TAG_HEAD);\r\n        //delete all to avoid script and style overlays\r\n        oldHead.querySelectorAll(Const_1.Const.SEL_SCRIPTS_STYLES).delete();\r\n        this.storeForEval(shadowHead);\r\n    };\r\n    /**\r\n     * replaces the body in the expected manner\r\n     * which means the entire body content is refreshed\r\n     * however also the body attributes must be transferred\r\n     * keeping event handlers etc... in place\r\n     *\r\n     * @param shadowDocument .. an incoming shadow document hosting the new nodes\r\n     */\r\n    ResponseProcessor.prototype.replaceBody = function (shadowDocument) {\r\n        var shadowBody = shadowDocument.querySelectorAll(Const_1.Const.TAG_BODY);\r\n        if (!shadowBody.isPresent()) {\r\n            return;\r\n        }\r\n        var shadowInnerHTML = shadowBody.html().value;\r\n        var resultingBody = DomQuery_1.DQ.querySelectorAll(Const_1.Const.TAG_BODY).html(shadowInnerHTML);\r\n        var updateForms = resultingBody.querySelectorAll(Const_1.Const.TAG_FORM);\r\n        resultingBody.copyAttrs(shadowBody);\r\n        this.storeForPostProcessing(updateForms, resultingBody);\r\n    };\r\n    /**\r\n     * Leaf Tag eval... process whatever is in the evals cdata block\r\n     *\r\n     * @param node the node to eval\r\n     */\r\n    ResponseProcessor.prototype.eval = function (node) {\r\n        DomQuery_1.DQ.globalEval(node.cDATAAsString);\r\n    };\r\n    /**\r\n     * processes an incoming error from the response\r\n     * which is hosted under the &lt;error&gt; tag\r\n     * @param request the current request\r\n     * @param context the context object\r\n     * @param node the node in the xml hosting the error message\r\n     */\r\n    ResponseProcessor.prototype.error = function (node) {\r\n        /**\r\n         * <error>\r\n         *      <error-name>String</error-name>\r\n         *      <error-message><![CDATA[message]]></error-message>\r\n         * <error>\r\n         */\r\n        var mergedErrorData = new monadish_1.Config({});\r\n        mergedErrorData.assign(Const_1.Const.SOURCE).value = this.externalContext.getIf(Const_1.Const.P_PARTIAL_SOURCE).get(0).value;\r\n        mergedErrorData.assign(Const_1.Const.ERROR_NAME).value = node.getIf(Const_1.Const.ERROR_NAME).textContent(\"\");\r\n        mergedErrorData.assign(Const_1.Const.ERROR_MESSAGE).value = node.getIf(Const_1.Const.ERROR_MESSAGE).cDATAAsString;\r\n        var hasResponseXML = this.internalContext.get(Const_1.Const.RESPONSE_XML).isPresent();\r\n        mergedErrorData.assignIf(hasResponseXML, Const_1.Const.RESPONSE_XML).value = this.internalContext.getIf(Const_1.Const.RESPONSE_XML).value.get(0).value;\r\n        var errorData = ErrorData_1.ErrorData.fromServerError(mergedErrorData);\r\n        this.externalContext.getIf(Const_1.Const.ON_ERROR).orElse(this.internalContext.getIf(Const_1.Const.ON_ERROR).value).orElse(Const_1.Const.EMPTY_FUNC).value(errorData);\r\n        AjaxImpl_1.Implementation.sendError(errorData);\r\n    };\r\n    /**\r\n     * process the redirect operation\r\n     *\r\n     * @param node\r\n     */\r\n    ResponseProcessor.prototype.redirect = function (node) {\r\n        Assertions_1.Assertions.assertUrlExists(node);\r\n        var redirectUrl = trim(node.attr(Const_1.Const.ATTR_URL).value);\r\n        if (redirectUrl != \"\") {\r\n            window.location.href = redirectUrl;\r\n        }\r\n    };\r\n    /**\r\n     * processes the update operation and updates the node with the cdata block\r\n     * @param context\r\n     * @param internalContext\r\n     * @param node\r\n     * @param cdataBlock\r\n     */\r\n    ResponseProcessor.prototype.update = function (node, cdataBlock) {\r\n        var _a;\r\n        var result = DomQuery_1.DQ.byId(node.id.value).outerHTML(cdataBlock, false, false);\r\n        var sourceForm = (_a = result) === null || _a === void 0 ? void 0 : _a.parents(Const_1.Const.TAG_FORM).orElse(result.byTagName(Const_1.Const.TAG_FORM, true));\r\n        if (sourceForm) {\r\n            this.storeForPostProcessing(sourceForm, result);\r\n        }\r\n    };\r\n    ResponseProcessor.prototype.delete = function (node) {\r\n        DomQuery_1.DQ.byId(node.id.value).delete();\r\n    };\r\n    /**\r\n     * attributes leaf tag... process the attributes\r\n     *\r\n     * @param node\r\n     */\r\n    ResponseProcessor.prototype.attributes = function (node) {\r\n        var elem = DomQuery_1.DQ.byId(node.id.value);\r\n        node.byTagName(Const_1.Const.TAG_ATTR).each(function (item) {\r\n            elem.attr(item.attr(Const_1.Const.ATTR_NAME).value).value = item.attr(Const_1.Const.ATTR_VALUE).value;\r\n        });\r\n    };\r\n    /**\r\n     * @param shadownResponse\r\n     */\r\n    ResponseProcessor.prototype.replaceViewRoot = function (shadowDocument) {\r\n        this.replaceHead(shadowDocument);\r\n        this.replaceBody(shadowDocument);\r\n    };\r\n    /**\r\n     * insert handling, either before or after\r\n     *\r\n     * @param node\r\n     */\r\n    ResponseProcessor.prototype.insert = function (node) {\r\n        //let insertId = node.id; //not used atm\r\n        var before = node.attr(Const_1.Const.TAG_BEFORE);\r\n        var after = node.attr(Const_1.Const.TAG_AFTER);\r\n        var insertNodes = DomQuery_1.DQ.fromMarkup(node.cDATAAsString);\r\n        if (before.isPresent()) {\r\n            var res = DomQuery_1.DQ.byId(before.value).insertBefore(insertNodes);\r\n            this.internalContext.assign(Const_1.Const.UPDATE_ELEMS).value.push(insertNodes);\r\n        }\r\n        if (after.isPresent()) {\r\n            var domQuery = DomQuery_1.DQ.byId(after.value);\r\n            domQuery.insertAfter(insertNodes);\r\n            this.internalContext.assign(Const_1.Const.UPDATE_ELEMS).value.push(insertNodes);\r\n        }\r\n    };\r\n    ResponseProcessor.prototype.insertWithSubtags = function (node) {\r\n        var _this = this;\r\n        var before = node.querySelectorAll(Const_1.Const.TAG_BEFORE);\r\n        var after = node.querySelectorAll(Const_1.Const.TAG_AFTER);\r\n        before.each(function (item) {\r\n            var insertId = item.attr(Const_1.Const.ATTR_ID);\r\n            var insertNodes = DomQuery_1.DQ.fromMarkup(item.cDATAAsString);\r\n            if (insertId.isPresent()) {\r\n                DomQuery_1.DQ.byId(insertId.value).insertBefore(insertNodes);\r\n                _this.internalContext.assign(Const_1.Const.UPDATE_ELEMS).value.push(insertNodes);\r\n            }\r\n        });\r\n        after.each(function (item) {\r\n            var insertId = item.attr(Const_1.Const.ATTR_ID);\r\n            var insertNodes = DomQuery_1.DQ.fromMarkup(item.cDATAAsString);\r\n            if (insertId.isPresent()) {\r\n                DomQuery_1.DQ.byId(insertId.value).insertAfter(insertNodes);\r\n                _this.internalContext.assign(Const_1.Const.UPDATE_ELEMS).value.push(insertNodes);\r\n            }\r\n        });\r\n    };\r\n    /**\r\n     * process the viewState update, update the affected\r\n     * forms with their respective new viewstate values\r\n     *\r\n     */\r\n    ResponseProcessor.prototype.processViewState = function (node) {\r\n        if (this.isViewStateNode(node)) {\r\n            var viewStateValue = node.textContent();\r\n            this.internalContext.assign(Const_1.Const.APPLIED_VST, node.id.value).value = new ImplTypes_1.ViewState(node.id.value, viewStateValue);\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n    ResponseProcessor.prototype.globalEval = function () {\r\n        var updateElems = new (DomQuery_1.DQ.bind.apply(DomQuery_1.DQ, __spreadArrays([void 0], this.internalContext.getIf(Const_1.Const.UPDATE_ELEMS).value)))();\r\n        updateElems.runCss();\r\n        updateElems.runScripts();\r\n    };\r\n    ResponseProcessor.prototype.fixViewStates = function () {\r\n        var _this = this;\r\n        monadish_1.Stream.ofAssoc(this.internalContext.getIf(Const_1.Const.APPLIED_VST).orElse({}).value)\r\n            .each(function (item) {\r\n            var key = item[0];\r\n            var value = item[1];\r\n            var nameSpace = DomQuery_1.DQ.byId(value.nameSpace).orElse(document.body);\r\n            var affectedForms = nameSpace.byTagName(Const_1.Const.TAG_FORM);\r\n            var affectedForms2 = nameSpace.filter(function (item) { return item.tagName.orElse(\"\").value.toLowerCase() == Const_1.Const.TAG_FORM; });\r\n            _this.appendViewStateToForms(new monadish_1.DomQuery(affectedForms, affectedForms2), value.value);\r\n        });\r\n    };\r\n    ResponseProcessor.prototype.done = function () {\r\n        var eventData = EventData_1.EventData.createFromRequest(this.request.value, this.externalContext, Const_1.Const.SUCCESS);\r\n        //because some frameworks might decorate them over the context in the response\r\n        var eventHandler = this.externalContext.getIf(Const_1.Const.ON_EVENT).orElse(this.internalContext.getIf(Const_1.Const.ON_EVENT).value).orElse(Const_1.Const.EMPTY_FUNC).value;\r\n        AjaxImpl_1.Implementation.sendEvent(eventData, eventHandler);\r\n    };\r\n    ResponseProcessor.prototype.isAllFormResolution = function (context) {\r\n        return getLocalOrGlobalConfig(context, \"no_portlet_env\", false);\r\n    };\r\n    ResponseProcessor.prototype.appendViewStateToForms = function (forms, viewState) {\r\n        var _this = this;\r\n        forms.each(function (form) {\r\n            var viewStateElems = form.querySelectorAll(Const_1.Const.SEL_VIEWSTATE_ELEM)\r\n                .orElseLazy(function () { return _this.newViewStateElement(form); });\r\n            viewStateElems.attr(\"value\").value = viewState;\r\n        });\r\n    };\r\n    /**\r\n     * Helper to Create a new JSF ViewState Element\r\n     *\r\n     * @param parent, the parent node to attach the viewstate element to\r\n     * (usually a form node)\r\n     */\r\n    ResponseProcessor.prototype.newViewStateElement = function (parent) {\r\n        var newViewState = DomQuery_1.DQ.fromMarkup(Const_1.Const.HTML_VIEWSTATE);\r\n        newViewState.appendTo(parent);\r\n        return newViewState;\r\n    };\r\n    /**\r\n     * Stores certain aspects of the dom for later post processing\r\n     *\r\n     * @param updateForms the update forms which should receive standardized internal jsf data\r\n     * @param toBeEvaled the resulting elements which should be evaled\r\n     */\r\n    ResponseProcessor.prototype.storeForPostProcessing = function (updateForms, toBeEvaled) {\r\n        this.storeForUpdate(updateForms);\r\n        this.storeForEval(toBeEvaled);\r\n    };\r\n    ResponseProcessor.prototype.storeForUpdate = function (updateForms) {\r\n        this.internalContext.assign(Const_1.Const.UPDATE_FORMS).value.push(updateForms);\r\n    };\r\n    ResponseProcessor.prototype.storeForEval = function (toBeEvaled) {\r\n        this.internalContext.assign(Const_1.Const.UPDATE_ELEMS).value.push(toBeEvaled);\r\n    };\r\n    ResponseProcessor.prototype.isViewStateNode = function (node) {\r\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;\r\n        var separatorchar = window.jsf.separatorchar;\r\n        return \"undefined\" != typeof ((_b = (_a = node) === null || _a === void 0 ? void 0 : _a.id) === null || _b === void 0 ? void 0 : _b.value) && (((_d = (_c = node) === null || _c === void 0 ? void 0 : _c.id) === null || _d === void 0 ? void 0 : _d.value) == Const_1.Const.P_VIEWSTATE ||\r\n            ((_g = (_f = (_e = node) === null || _e === void 0 ? void 0 : _e.id) === null || _f === void 0 ? void 0 : _f.value) === null || _g === void 0 ? void 0 : _g.indexOf([separatorchar, Const_1.Const.P_VIEWSTATE].join(\"\"))) != -1 ||\r\n            ((_k = (_j = (_h = node) === null || _h === void 0 ? void 0 : _h.id) === null || _j === void 0 ? void 0 : _j.value) === null || _k === void 0 ? void 0 : _k.indexOf([Const_1.Const.P_VIEWSTATE, separatorchar].join(\"\"))) != -1);\r\n    };\r\n    return ResponseProcessor;\r\n}());\r\nexports.ResponseProcessor = ResponseProcessor;\r\n","\"use strict\";\r\n/* Licensed to the Apache Software Foundation (ASF) under one or more\r\n * contributor license agreements.  See the NOTICE file distributed with\r\n * this work for additional information regarding copyright ownership.\r\n * The ASF licenses this file to you under the Apache License, Version 2.0\r\n * (the \"License\"); you may not use this file except in compliance with\r\n * the License.  You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Messages = /** @class */ (function () {\r\n    function Messages() {\r\n        this.MSG_TEST = \"Testmessage\";\r\n        /*Messages*/\r\n        /** @constant */\r\n        this.MSG_DEV_MODE = \"Note, this message is only sent, because project stage is development and no \" +\r\n            \"other error listeners are registered.\";\r\n        /** @constant */\r\n        this.MSG_AFFECTED_CLASS = \"Affected Class=\";\r\n        /** @constant */\r\n        this.MSG_AFFECTED_METHOD = \"Affected Method=\";\r\n        /** @constant */\r\n        this.MSG_ERROR_NAME = \"Error Name=\";\r\n        /** @constant */\r\n        this.MSG_ERROR_MESSAGE = \"Error Message=\";\r\n        /** @constant */\r\n        this.MSG_SERVER_ERROR_NAME = \"Server Error Name=\";\r\n        /** @constant */\r\n        this.MSG_ERROR_DESC = \"Error Description=\";\r\n        /** @constant */\r\n        this.MSG_ERROR_NO = \"Error Number=\";\r\n        /** @constant */\r\n        this.MSG_ERROR_LINENO = \"Error Line Number=\";\r\n        /*Errors and messages*/\r\n        /** @constant */\r\n        this.ERR_FORM = \"Sourceform could not be determined, either because element is not attached to a form or we have multiple forms with named elements of the same identifier or name, stopping the ajax processing\";\r\n        /** @constant */\r\n        this.ERR_VIEWSTATE = \"jsf.viewState= param value not of type form!\";\r\n        /** @constant */\r\n        this.ERR_TRANSPORT = \"Transport type {0} does not exist\";\r\n        /** @constant */\r\n        this.ERR_EVT_PASS = \"an event must be passed down (either a an event object null or undefined) \";\r\n        /** @constant */\r\n        this.ERR_CONSTRUCT = \"Parts of the response couldn't be retrieved when constructing the event data= {0} \";\r\n        /** @constant */\r\n        this.ERR_MALFORMEDXML = \"The server response could not be parsed, the server has returned with a response which is not xml !\";\r\n        /** @constant */\r\n        this.ERR_SOURCE_FUNC = \"source cannot be a function (probably source and event were not defined or set to null\";\r\n        /** @constant */\r\n        this.ERR_EV_OR_UNKNOWN = \"An event object or unknown must be passed as second parameter\";\r\n        /** @constant */\r\n        this.ERR_SOURCE_NOSTR = \"source cannot be a string\";\r\n        /** @constant */\r\n        this.ERR_SOURCE_DEF_NULL = \"source must be defined or null\";\r\n        //_Lang.js\r\n        /** @constant */\r\n        this.ERR_MUST_STRING = \"{0}: {1} namespace must be of type String\";\r\n        /** @constant */\r\n        this.ERR_REF_OR_ID = \"{0}: {1} a reference node or identifier must be provided\";\r\n        /** @constant */\r\n        this.ERR_PARAM_GENERIC = \"{0}: parameter {1} must be of type {2}\";\r\n        /** @constant */\r\n        this.ERR_PARAM_STR = \"{0}: {1} param must be of type string\";\r\n        /** @constant */\r\n        this.ERR_PARAM_STR_RE = \"{0}: {1} param must be of type string or a regular expression\";\r\n        /** @constant */\r\n        this.ERR_PARAM_MIXMAPS = \"{0}: both a source as well as a destination map must be provided\";\r\n        /** @constant */\r\n        this.ERR_MUST_BE_PROVIDED = \"{0}: an {1} and a {2} must be provided\";\r\n        /** @constant */\r\n        this.ERR_MUST_BE_PROVIDED1 = \"{0}: {1} must be set\";\r\n        /** @constant */\r\n        this.ERR_REPLACE_EL = \"replaceElements called while evalNodes is not an array\";\r\n        /** @constant */\r\n        this.ERR_EMPTY_RESPONSE = \"{0}: The response cannot be null or empty!\";\r\n        /** @constant */\r\n        this.ERR_ITEM_ID_NOTFOUND = \"{0}: item with identifier {1} could not be found\";\r\n        /** @constant */\r\n        this.ERR_PPR_IDREQ = \"{0}: Error in PPR Insert, id must be present\";\r\n        /** @constant */\r\n        this.ERR_PPR_INSERTBEFID = \"{0}: Error in PPR Insert, before id or after id must be present\";\r\n        /** @constant */\r\n        this.ERR_PPR_INSERTBEFID_1 = \"{0}: Error in PPR Insert, before  node of id {1} does not exist in document\";\r\n        /** @constant */\r\n        this.ERR_PPR_INSERTBEFID_2 = \"{0}: Error in PPR Insert, after  node of id {1} does not exist in document\";\r\n        /** @constant */\r\n        this.ERR_PPR_DELID = \"{0}: Error in delete, id not in xml markup\";\r\n        /** @constant */\r\n        this.ERR_PPR_UNKNOWNCID = \"{0}:  Unknown Html-Component-ID= {1}\";\r\n        /** @constant */\r\n        this.ERR_NO_VIEWROOTATTR = \"{0}: Changing of ViewRoot attributes is not supported\";\r\n        /** @constant */\r\n        this.ERR_NO_HEADATTR = \"{0}: Changing of Head attributes is not supported\";\r\n        /** @constant */\r\n        this.ERR_RED_URL = \"{0}: Redirect without url\";\r\n        /** @constant */\r\n        this.ERR_REQ_FAILED_UNKNOWN = \"Request failed with unknown status\";\r\n        /** @constant */\r\n        this.ERR_REQU_FAILED = \"Request failed with status {0} and reason {1}\";\r\n        /** @constant */\r\n        this.UNKNOWN = \"UNKNOWN\";\r\n    }\r\n    return Messages;\r\n}());\r\nexports.Messages = Messages;\r\n","\"use strict\";\r\n/* Licensed to the Apache Software Foundation (ASF) under one or more\r\n * contributor license agreements.  See the NOTICE file distributed with\r\n * this work for additional information regarding copyright ownership.\r\n * The ASF licenses this file to you under the Apache License, Version 2.0\r\n * (the \"License\"); you may not use this file except in compliance with\r\n * the License.  You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Const_1 = require(\"./Const\");\r\n/**\r\n * a helper class to isolate the\r\n * view state data processing\r\n */\r\nvar ViewState = /** @class */ (function () {\r\n    function ViewState(id, value) {\r\n        this.id = id;\r\n        this.value = value;\r\n        var viewStatePos = id.indexOf(Const_1.Const.P_VIEWSTATE);\r\n        this.nameSpace = viewStatePos > 0 ? id.substr(0, viewStatePos - 1) : \"\";\r\n    }\r\n    Object.defineProperty(ViewState.prototype, \"hasNameSpace\", {\r\n        get: function () {\r\n            var _a, _b;\r\n            return !!(_b = (_a = this) === null || _a === void 0 ? void 0 : _a.nameSpace, (_b !== null && _b !== void 0 ? _b : \"\")).length;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return ViewState;\r\n}());\r\nexports.ViewState = ViewState;\r\n","\"use strict\";\r\n/* Licensed to the Apache Software Foundation (ASF) under one or more\r\n * contributor license agreements.  See the NOTICE file distributed with\r\n * this work for additional information regarding copyright ownership.\r\n * The ASF licenses this file to you under the Apache License, Version 2.0\r\n * (the \"License\"); you may not use this file except in compliance with\r\n * the License.  You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar monadish_1 = require(\"../../ext/monadish\");\r\nvar Const_1 = require(\"../core/Const\");\r\nvar Assertions_1 = require(\"../util/Assertions\");\r\nvar DomQuery_1 = require(\"../../ext/monadish/DomQuery\");\r\n/**\r\n * Resolver for various aspects of the response data\r\n *\r\n * stateless because it might be called from various\r\n * parts of the response classes\r\n */\r\nvar ResonseDataResolver;\r\n(function (ResonseDataResolver) {\r\n    /**\r\n     * fetches the response XML\r\n     * as XML Query object\r\n     *\r\n     * @param request the request hosting the responseXML\r\n     *\r\n     * Throws an error in case of non existent or wrong xml data\r\n     *\r\n     */\r\n    function resolveResponseXML(request) {\r\n        var ret = new monadish_1.XMLQuery(request.getIf(Const_1.Const.SEL_RESPONSE_XML).value);\r\n        Assertions_1.Assertions.assertValidXMLResponse(ret);\r\n        return ret;\r\n    }\r\n    ResonseDataResolver.resolveResponseXML = resolveResponseXML;\r\n    /**\r\n     * Splits the incoming passthrough context apart\r\n     * in an internal and an external nomalized context\r\n     * the internal one is just for our internal processing\r\n     *\r\n     * @param context the root context as associative array\r\n     */\r\n    function resolveContexts(context) {\r\n        /**\r\n         * we split the context apart into the external one and\r\n         * some internal values\r\n         */\r\n        var externalContext = monadish_1.Config.fromNullable(context);\r\n        var internalContext = externalContext.getIf(Const_1.Const.CTX_PARAM_MF_INTERNAL);\r\n        if (!internalContext.isPresent()) {\r\n            internalContext = monadish_1.Config.fromNullable({});\r\n        }\r\n        /**\r\n         * prepare storage for some deferred operations\r\n         */\r\n        internalContext.assign(Const_1.Const.UPDATE_FORMS).value = [];\r\n        internalContext.assign(Const_1.Const.UPDATE_ELEMS).value = [];\r\n        return { externalContext: externalContext, internalContext: internalContext };\r\n    }\r\n    ResonseDataResolver.resolveContexts = resolveContexts;\r\n    /**\r\n     * fetches the source element out of our conexts\r\n     *\r\n     * @param context the external context which shpuld host the source id\r\n     * @param internalContext internal passthrough fall back\r\n     *\r\n     */\r\n    function resolveSourceElement(context, internalContext) {\r\n        var elemId = resolveSourceElementId(context, internalContext);\r\n        var elem = DomQuery_1.DQ.byId(elemId.value);\r\n        return elem;\r\n    }\r\n    ResonseDataResolver.resolveSourceElement = resolveSourceElement;\r\n    /**\r\n     * fetches the source form if it still exists\r\n     * also embedded forms and parent forms are taken into consideration\r\n     * as fallbacks\r\n     *\r\n     * @param internalContext\r\n     * @param elem\r\n     */\r\n    function resolveSourceForm(internalContext, elem) {\r\n        var sourceFormId = internalContext.getIf(Const_1.Const.CTX_PARAM_SRC_FRM_ID);\r\n        var sourceForm = new DomQuery_1.DQ(sourceFormId.isPresent() ? document.forms[sourceFormId.value] : null);\r\n        sourceForm = sourceForm.orElse(elem.parents(Const_1.Const.TAG_FORM))\r\n            .orElse(elem.querySelectorAll(Const_1.Const.TAG_FORM))\r\n            .orElse(DomQuery_1.DQ.querySelectorAll(Const_1.Const.TAG_FORM));\r\n        return sourceForm;\r\n    }\r\n    ResonseDataResolver.resolveSourceForm = resolveSourceForm;\r\n    function resolveSourceElementId(context, internalContext) {\r\n        //?internal context?? used to be external one\r\n        return internalContext.getIf(Const_1.Const.CTX_PARAM_SRC_CTL_ID)\r\n            .orElseLazy(function () { return context.getIf(Const_1.Const.SOURCE, \"id\").value; });\r\n    }\r\n})(ResonseDataResolver = exports.ResonseDataResolver || (exports.ResonseDataResolver = {}));\r\n","\"use strict\";\r\n/* Licensed to the Apache Software Foundation (ASF) under one or more\r\n * contributor license agreements.  See the NOTICE file distributed with\r\n * this work for additional information regarding copyright ownership.\r\n * The ASF licenses this file to you under the Apache License, Version 2.0\r\n * (the \"License\"); you may not use this file except in compliance with\r\n * the License.  You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar AjaxImpl_1 = require(\"../AjaxImpl\");\r\nvar Const_1 = require(\"../core/Const\");\r\nvar XhrFormData_1 = require(\"./XhrFormData\");\r\nvar ErrorData_1 = require(\"./ErrorData\");\r\nvar EventData_1 = require(\"./EventData\");\r\nvar Lang_1 = require(\"../util/Lang\");\r\nvar monadish_1 = require(\"../../ext/monadish\");\r\nvar failSaveExecute = Lang_1.ExtLang.failSaveExecute;\r\nvar XhrRequest = /** @class */ (function () {\r\n    /**\r\n     * Reqired Parameters\r\n     *\r\n     * @param source the issuing element\r\n     * @param sourceForm the form which is related to the issuing element\r\n     * @param requestContext the request context with all pass through values\r\n     *\r\n     * Optional Parameters\r\n     *\r\n     * @param partialIdsArray an optional restricting partial ids array for encoding\r\n     * @param timeout optional xhr timeout\r\n     * @param ajaxType optional request type, default \"POST\"\r\n     * @param contentType optional content type, default \"application/x-www-form-urlencoded\"\r\n     * @param xhrObject optional xhr object which must fullfill the XMLHTTPRequest api, default XMLHttpRequest\r\n     */\r\n    function XhrRequest(source, sourceForm, requestContext, internalContext, partialIdsArray, timeout, ajaxType, contentType, xhrObject) {\r\n        var _this = this;\r\n        if (partialIdsArray === void 0) { partialIdsArray = []; }\r\n        if (timeout === void 0) { timeout = Const_1.Const.NO_TIMEOUT; }\r\n        if (ajaxType === void 0) { ajaxType = Const_1.Const.REQ_TYPE_POST; }\r\n        if (contentType === void 0) { contentType = Const_1.Const.URL_ENCODED; }\r\n        if (xhrObject === void 0) { xhrObject = new XMLHttpRequest(); }\r\n        this.source = source;\r\n        this.sourceForm = sourceForm;\r\n        this.requestContext = requestContext;\r\n        this.internalContext = internalContext;\r\n        this.partialIdsArray = partialIdsArray;\r\n        this.timeout = timeout;\r\n        this.ajaxType = ajaxType;\r\n        this.contentType = contentType;\r\n        this.xhrObject = xhrObject;\r\n        this.stopProgress = false;\r\n        /**\r\n         * helper support so that we do not have to drag in Promise shims\r\n         */\r\n        this.catchFuncs = [];\r\n        this.thenFunc = [];\r\n        /*\r\n        * we omit promises here\r\n        * some browsers do not support it and we do not need shim code\r\n        */\r\n        this.registerXhrCallbacks(function (data) { _this.resolve(data); }, function (data) { _this.reject(data); });\r\n    }\r\n    XhrRequest.prototype.start = function () {\r\n        var _this = this;\r\n        var fsExec = failSaveExecute;\r\n        var xhrObject = this.xhrObject;\r\n        try {\r\n            var viewState = jsf.getViewState(this.sourceForm.getAsElem(0).value);\r\n            var formData = new XhrFormData_1.XhrFormData(viewState);\r\n            this.contentType = formData.isMultipartRequest ? Const_1.Const.MULTIPART : this.contentType;\r\n            //next step the pass through parameters are merged in for post params\r\n            var requestContext = this.requestContext;\r\n            var passThroughParams = requestContext.getIf(Const_1.Const.CTX_PARAM_PASS_THR);\r\n            formData.shallowMerge(passThroughParams);\r\n            this.responseContext = passThroughParams.deepCopy;\r\n            //we have to shift the internal passthroughs around to build up our response context\r\n            var responseContext = this.responseContext;\r\n            responseContext.assign(Const_1.Const.CTX_PARAM_MF_INTERNAL).value = this.internalContext.value;\r\n            //per spec the onevent and onerrors must be passed through to the response\r\n            responseContext.assign(Const_1.Const.ON_EVENT).value = requestContext.getIf(Const_1.Const.ON_EVENT).value;\r\n            responseContext.assign(Const_1.Const.ON_ERROR).value = requestContext.getIf(Const_1.Const.ON_ERROR).value;\r\n            xhrObject.open(this.ajaxType, this.resolveFinalUrl(formData), true);\r\n            //adding timeout\r\n            this.timeout ? xhrObject.timeout = this.timeout : null;\r\n            //a bug in the xhr stub library prevents the setRequestHeader to be properly executed on fake xhr objects\r\n            //normal browsers should resolve this\r\n            //tests can quietly fail on this one\r\n            fsExec(function () { return xhrObject.setRequestHeader(Const_1.Const.CONTENT_TYPE, _this.contentType + \"; charset=utf-8\"); });\r\n            fsExec(function () { return xhrObject.setRequestHeader(Const_1.Const.HEAD_FACES_REQ, Const_1.Const.VAL_AJAX); });\r\n            //probably not needed anymore, will test this\r\n            //some webkit based mobile browsers do not follow the w3c spec of\r\n            // setting the accept headers automatically\r\n            fsExec(function () { return xhrObject.setRequestHeader(Const_1.Const.REQ_ACCEPT, Const_1.Const.STD_ACCEPT); });\r\n            this.sendEvent(Const_1.Const.BEGIN);\r\n            this.sendRequest(formData);\r\n        }\r\n        catch (e) {\r\n            //_onError//_onError\r\n            this.handleError(e);\r\n        }\r\n        return this;\r\n    };\r\n    XhrRequest.prototype.cancel = function () {\r\n        try {\r\n            this.xhrObject.abort();\r\n        }\r\n        catch (e) {\r\n            this.handleError(e);\r\n        }\r\n    };\r\n    XhrRequest.prototype.resolve = function (data) {\r\n        monadish_1.Stream.of.apply(monadish_1.Stream, this.thenFunc).reduce(function (inputVal, thenFunc) {\r\n            return thenFunc(inputVal);\r\n        }, data);\r\n    };\r\n    XhrRequest.prototype.reject = function (data) {\r\n        monadish_1.Stream.of.apply(monadish_1.Stream, this.catchFuncs).reduce(function (inputVal, catchFunc) {\r\n            return catchFunc(inputVal);\r\n        }, data);\r\n    };\r\n    XhrRequest.prototype.catch = function (func) {\r\n        //this.$promise.catch(func);\r\n        this.catchFuncs.push(func);\r\n        return this;\r\n    };\r\n    XhrRequest.prototype.finally = function (func) {\r\n        //no ie11 support we probably are going to revert to shims for that one\r\n        //(<any>this.$promise).then(func).catch(func);\r\n        this.catchFuncs.push(func);\r\n        this.thenFunc.push(func);\r\n        return this;\r\n    };\r\n    XhrRequest.prototype.then = function (func) {\r\n        //this.$promise.then(func);\r\n        this.thenFunc.push(func);\r\n        return this;\r\n    };\r\n    /**\r\n     * attaches the internal event and processing\r\n     * callback within the promise to our xhr object\r\n     *\r\n     * @param resolve\r\n     * @param reject\r\n     */\r\n    XhrRequest.prototype.registerXhrCallbacks = function (resolve, reject) {\r\n        var _this = this;\r\n        var xhrObject = this.xhrObject;\r\n        xhrObject.onabort = function () {\r\n            _this.onAbort(resolve, reject);\r\n        };\r\n        xhrObject.ontimeout = function () {\r\n            _this.onTimeout(resolve, reject);\r\n        };\r\n        xhrObject.onload = function () {\r\n            _this.onSuccess(_this.xhrObject, resolve, reject);\r\n        };\r\n        xhrObject.onloadend = function () {\r\n            _this.onDone(_this.xhrObject, resolve, reject);\r\n        };\r\n        xhrObject.onerror = function (errorData) {\r\n            _this.onError(errorData, resolve, reject);\r\n        };\r\n    };\r\n    /*\r\n     * xhr processing callbacks\r\n     *\r\n     * Those methods are the callbacks called by\r\n     * the xhr object depending on its own state\r\n     */\r\n    XhrRequest.prototype.onAbort = function (resolve, reject) {\r\n        reject();\r\n    };\r\n    XhrRequest.prototype.onTimeout = function (resolve, reject) {\r\n        this.sendEvent(Const_1.Const.STATE_EVT_TIMEOUT);\r\n        reject();\r\n    };\r\n    XhrRequest.prototype.onSuccess = function (data, resolve, reject) {\r\n        var _a, _b, _c;\r\n        this.sendEvent(Const_1.Const.COMPLETE);\r\n        //malforms always result in empty response xml\r\n        if (!((_b = (_a = this) === null || _a === void 0 ? void 0 : _a.xhrObject) === null || _b === void 0 ? void 0 : _b.responseXML)) {\r\n            this.handleMalFormedXML(resolve);\r\n            return;\r\n        }\r\n        jsf.ajax.response(this.xhrObject, (_c = this.responseContext.value, (_c !== null && _c !== void 0 ? _c : {})));\r\n    };\r\n    XhrRequest.prototype.handleMalFormedXML = function (resolve) {\r\n        var _a;\r\n        this.stopProgress = true;\r\n        var errorData = {\r\n            type: Const_1.Const.ERROR,\r\n            status: Const_1.Const.MALFORMEDXML,\r\n            responseCode: 200,\r\n            responseText: (_a = this.xhrObject) === null || _a === void 0 ? void 0 : _a.responseText,\r\n            source: {\r\n                id: this.source.id.value\r\n            }\r\n        };\r\n        try {\r\n            AjaxImpl_1.Implementation.sendError(errorData);\r\n        }\r\n        finally {\r\n            resolve(errorData);\r\n        }\r\n        //non blocking non clearing\r\n    };\r\n    XhrRequest.prototype.onDone = function (data, resolve, reject) {\r\n        if (this.stopProgress) {\r\n            return;\r\n        }\r\n        resolve(data);\r\n    };\r\n    XhrRequest.prototype.onError = function (errorData, resolve, reject) {\r\n        this.handleError(errorData);\r\n        reject();\r\n    };\r\n    /*\r\n     * other helpers\r\n     */\r\n    XhrRequest.prototype.sendEvent = function (evtType) {\r\n        var eventData = EventData_1.EventData.createFromRequest(this.xhrObject, this.requestContext, evtType);\r\n        try {\r\n            //user code error, we might cover\r\n            //this in onError but also we cannot swallow it\r\n            //we need to resolve the local handlers lazyly,\r\n            //because some frameworks might decorate them over the context in the response\r\n            var eventHandler = this.resolveHandlerFunc(Const_1.Const.ON_EVENT);\r\n            ;\r\n            AjaxImpl_1.Implementation.sendEvent(eventData, eventHandler);\r\n        }\r\n        catch (e) {\r\n            this.handleError(e);\r\n            throw e;\r\n        }\r\n    };\r\n    XhrRequest.prototype.handleError = function (exception) {\r\n        var errorData = ErrorData_1.ErrorData.fromClient(exception);\r\n        var eventHandler = this.resolveHandlerFunc(Const_1.Const.ON_ERROR);\r\n        AjaxImpl_1.Implementation.sendError(errorData, eventHandler);\r\n    };\r\n    /**\r\n     * resolves the event handlers lazly\r\n     * so that if some decoration happens in between we can deal with it\r\n     *\r\n     * @param funcName\r\n     */\r\n    XhrRequest.prototype.resolveHandlerFunc = function (funcName) {\r\n        return this.responseContext.getIf(funcName)\r\n            .orElse(this.requestContext.getIf(funcName).value)\r\n            .orElse(Const_1.Const.EMPTY_FUNC).value;\r\n    };\r\n    XhrRequest.prototype.resolveTargetUrl = function (srcFormElement) {\r\n        return (typeof srcFormElement.elements[Const_1.Const.ENCODED_URL] == 'undefined') ?\r\n            srcFormElement.action :\r\n            srcFormElement.elements[Const_1.Const.ENCODED_URL].value;\r\n    };\r\n    XhrRequest.prototype.sendRequest = function (formData) {\r\n        var isPost = this.ajaxType != Const_1.Const.REQ_TYPE_GET;\r\n        if (formData.isMultipartRequest) {\r\n            this.xhrObject.send((isPost) ? formData.toFormData() : null);\r\n        }\r\n        else {\r\n            this.xhrObject.send((isPost) ? formData.toString() : null);\r\n        }\r\n    };\r\n    XhrRequest.prototype.resolveFinalUrl = function (formData) {\r\n        var targetUrl = this.resolveTargetUrl(this.sourceForm.getAsElem(0).value);\r\n        return targetUrl + (this.ajaxType == Const_1.Const.REQ_TYPE_GET ? \"?\" + formData.toString() : \"\");\r\n    };\r\n    return XhrRequest;\r\n}());\r\nexports.XhrRequest = XhrRequest;\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/**\r\n * Asynchronous queue which starts to work\r\n * through the callbacks until the queue is empty\r\n *\r\n * Every callback must be of async runnable\r\n * which is sort of an extended promise which has\r\n * added a decicated cancel and start point\r\n *\r\n * This interface can be used as wrapper contract\r\n * for normal promises if needed.\r\n */\r\nvar AsynchronouseQueue = /** @class */ (function () {\r\n    function AsynchronouseQueue() {\r\n        this.runnableQueue = [];\r\n    }\r\n    Object.defineProperty(AsynchronouseQueue.prototype, \"isEmpty\", {\r\n        get: function () {\r\n            return !this.runnableQueue.length;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * enequeues an element and starts the\r\n     * asynchronous work loop if not already running\r\n     *\r\n     * @param element the element to be queued and processed\r\n     * @param delay possible delay after our usual process or drop if something newer is incoming algorithm\r\n     */\r\n    AsynchronouseQueue.prototype.enqueue = function (element, delay) {\r\n        var _this = this;\r\n        if (delay === void 0) { delay = 0; }\r\n        if (this.delayTimeout) {\r\n            clearTimeout(this.delayTimeout);\r\n            this.delayTimeout = null;\r\n        }\r\n        if (delay) {\r\n            this.delayTimeout = setTimeout(function () {\r\n                _this.appendElement(element);\r\n            });\r\n        }\r\n        else {\r\n            this.appendElement(element);\r\n        }\r\n    };\r\n    AsynchronouseQueue.prototype.dequeue = function () {\r\n        return this.runnableQueue.shift();\r\n    };\r\n    AsynchronouseQueue.prototype.cleanup = function () {\r\n        this.currentlyRunning = null;\r\n        this.runnableQueue.length = 0;\r\n    };\r\n    AsynchronouseQueue.prototype.appendElement = function (element) {\r\n        //only if the first element is added we start with a trigger\r\n        //otherwise a process already is running and not finished yet at that\r\n        //time\r\n        this.runnableQueue.push(element);\r\n        if (!this.currentlyRunning) {\r\n            this.runEntry();\r\n        }\r\n    };\r\n    AsynchronouseQueue.prototype.runEntry = function () {\r\n        var _this = this;\r\n        if (this.isEmpty) {\r\n            this.currentlyRunning = null;\r\n            return;\r\n        }\r\n        this.currentlyRunning = this.dequeue();\r\n        this.currentlyRunning\r\n            .catch(function (e) {\r\n            //in case of an error we always clean up the remaining calls\r\n            //to allow a clean recovery of the application\r\n            _this.cleanup();\r\n            throw e;\r\n        })\r\n            .then(\r\n        //the idea is to trigger the next over an event to reduce\r\n        //the number of recursive calls (stacks might be limited\r\n        //compared to ram)\r\n        //naturally give we have a DOM, the DOM is the natural event dispatch system\r\n        //which we can use, to decouple the calls from a recursive stack call\r\n        //(the browser engine will take care of that)\r\n        function () { return _this.callForNextElementToProcess(); }).start();\r\n    };\r\n    AsynchronouseQueue.prototype.cancel = function () {\r\n        try {\r\n            if (this.currentlyRunning) {\r\n                this.currentlyRunning.cancel();\r\n            }\r\n        }\r\n        finally {\r\n            this.cleanup();\r\n        }\r\n    };\r\n    AsynchronouseQueue.prototype.callForNextElementToProcess = function () {\r\n        this.runEntry();\r\n    };\r\n    AsynchronouseQueue.prototype.processNextElement = function () {\r\n        this.currentlyRunning = null;\r\n        if (!this.isEmpty) {\r\n            this.runEntry();\r\n        }\r\n    };\r\n    AsynchronouseQueue.EVT_NEXT = \"__mf_queue_next__\";\r\n    return AsynchronouseQueue;\r\n}());\r\nexports.AsynchronouseQueue = AsynchronouseQueue;\r\n","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Monad_1 = require(\"../../ext/monadish/Monad\");\r\nvar Const_1 = require(\"../core/Const\");\r\nvar DomQuery_1 = require(\"../../ext/monadish/DomQuery\");\r\n/**\r\n * Extension which adds implementation specific\r\n * meta data to our dom qury\r\n *\r\n * Usage\r\n * el = new ExtDQ(oldReference)\r\n * nonce = el.nonce\r\n * windowId = el.getWindowId\r\n */\r\nvar ExtDomquery = /** @class */ (function (_super) {\r\n    __extends(ExtDomquery, _super);\r\n    function ExtDomquery() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    Object.defineProperty(ExtDomquery, \"windowId\", {\r\n        get: function () {\r\n            return new ExtDomquery(document.body).windowId;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ExtDomquery, \"nonce\", {\r\n        get: function () {\r\n            return new ExtDomquery(document.body).nonce;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ExtDomquery.prototype, \"windowId\", {\r\n        get: function () {\r\n            var fetchWindowIdFromURL = function () {\r\n                var href = window.location.href;\r\n                var windowId = \"windowId\";\r\n                var regex = new RegExp(\"[\\\\?&]\" + windowId + \"=([^&#\\\\;]*)\");\r\n                var results = regex.exec(href);\r\n                //initial trial over the url and a regexp\r\n                if (results != null)\r\n                    return results[1];\r\n                return null;\r\n            };\r\n            //byId ($)\r\n            if (this.value.isPresent()) {\r\n                var result = this.querySelectorAll(\"form input[name='\" + Const_1.Const.P_WIN_ID + \"']\");\r\n                if (result.length > 0) {\r\n                    throw Error(\"Multiple different windowIds found in document\");\r\n                }\r\n                return (result.isPresent()) ? result.getAsElem(0).value.value : fetchWindowIdFromURL();\r\n            }\r\n            else {\r\n                return fetchWindowIdFromURL();\r\n            }\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ExtDomquery.prototype, \"nonce\", {\r\n        /*\r\n        determines the jsfjs nonce and adds them to the namespace\r\n        * this is done once and only lazily\r\n        */\r\n        get: function () {\r\n            //already processed\r\n            var myfacesConfig = new Monad_1.Config(window.myfaces);\r\n            var nonce = myfacesConfig.assign(\"config\", \"cspMeta\", \"nonce\");\r\n            if (nonce.value) {\r\n                return nonce.value;\r\n            }\r\n            var curScript = new DomQuery_1.DQ(document.currentScript);\r\n            //since our baseline atm is ie11 we cannot use document.currentScript globally\r\n            if (curScript.attr(\"nonce\").value != null) {\r\n                //fastpath for modern browsers\r\n                return curScript.attr(\"nonce\").value;\r\n            }\r\n            var nonceScript = DomQuery_1.DQ.querySelectorAll(\"script[src], link[src]\").lazyStream\r\n                .filter(function (item) { return item.attr(\"nonce\").value != null && item.attr(\"src\") != null; })\r\n                .map((function (item) { return !item.attr(\"src\").value.match(/jsf\\.js\\?ln\\=javax\\.faces/gi); }))\r\n                .first();\r\n            if (nonceScript.isPresent()) {\r\n                nonce.value = DomQuery_1.DomQuery.byId(nonceScript.value).attr(\"nonce\").value;\r\n            }\r\n            return nonce.value;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ExtDomquery.searchJsfJsFor = function (item) {\r\n        return new ExtDomquery(document).searchJsfJsFor(item);\r\n    };\r\n    ExtDomquery.prototype.searchJsfJsFor = function (rexp) {\r\n        //perfect application for lazy stream\r\n        return DomQuery_1.DQ.querySelectorAll(\"script\").lazyStream\r\n            .filter(function (item) {\r\n            var _a;\r\n            return (_a = item.attr(\"src\").value, (_a !== null && _a !== void 0 ? _a : \"\")).search(/\\/javax\\.faces\\.resource.*\\/jsf\\.js.*separator/) != -1;\r\n        }).map(function (item) {\r\n            var result = item.attr(\"src\").value.match(rexp);\r\n            return decodeURIComponent(result[1]);\r\n        }).first();\r\n    };\r\n    ExtDomquery.prototype.globalEval = function (code, nonce) {\r\n        return _super.prototype.globalEval.call(this, code, (nonce !== null && nonce !== void 0 ? nonce : this.nonce));\r\n    };\r\n    return ExtDomquery;\r\n}(DomQuery_1.DQ));\r\nexports.ExtDomquery = ExtDomquery;\r\nexports.ExtDQ = DomQuery_1.DQ;\r\n","\"use strict\";\r\n/**\r\n * Typescript port of the jsf.push part in the myfaces implementation\r\n */\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n//TODO still work in progress\r\n//this is a 1:1 port for the time being\r\nvar Jsf_1 = require(\"../api/Jsf\");\r\nvar Const_1 = require(\"./core/Const\");\r\n/**\r\n * Implementation class for the push functionality\r\n */\r\nvar PushImpl;\r\n(function (PushImpl) {\r\n    var URL_PROTOCOL = window.location.protocol.replace(\"http\", \"ws\") + \"//\";\r\n    //we expose the member variables for testing purposes\r\n    //they are not directly touched outside of tests\r\n    /* socket map by token */\r\n    PushImpl.sockets = {};\r\n    /* component attributes by clientId */\r\n    PushImpl.components = {};\r\n    /* client ids by token (share websocket connection) */\r\n    PushImpl.clientIdsByTokens = {};\r\n    //needed for testing\r\n    function reset() {\r\n        PushImpl.sockets = {};\r\n        PushImpl.components = {};\r\n        PushImpl.clientIdsByTokens = {};\r\n    }\r\n    PushImpl.reset = reset;\r\n    /*\r\n     * Api implementations, exposed functions\r\n     */\r\n    /**\r\n     *\r\n     * @param {function} onopen The function to be invoked when the web socket is opened.\r\n     * @param {function} onmessage The function to be invoked when a message is received.\r\n     * @param {function} onclose The function to be invoked when the web socket is closed.\r\n     * @param {boolean} autoconnect Whether or not to immediately open the socket. Defaults to <code>false</code>.\r\n     */\r\n    function init(socketClientId, uri, channel, onopen, onmessage, onclose, behaviorScripts, autoconnect) {\r\n        onclose = resolveFunction(onclose);\r\n        if (!window.WebSocket) { // IE6-9.\r\n            onclose(-1, channel);\r\n            return;\r\n        }\r\n        var channelToken = uri.substr(uri.indexOf('?') + 1);\r\n        if (!PushImpl.components[socketClientId]) {\r\n            PushImpl.components[socketClientId] = {\r\n                'channelToken': channelToken,\r\n                'onopen': resolveFunction(onopen),\r\n                'onmessage': resolveFunction(onmessage),\r\n                'onclose': onclose,\r\n                'behaviors': behaviorScripts,\r\n                'autoconnect': autoconnect\r\n            };\r\n            if (!PushImpl.clientIdsByTokens[channelToken]) {\r\n                PushImpl.clientIdsByTokens[channelToken] = [];\r\n            }\r\n            PushImpl.clientIdsByTokens[channelToken].push(socketClientId);\r\n            if (!PushImpl.sockets[channelToken]) {\r\n                PushImpl.sockets[channelToken] = new Socket(channelToken, getBaseURL(uri), channel);\r\n            }\r\n        }\r\n        if (autoconnect) {\r\n            Jsf_1.jsf.push.open(socketClientId);\r\n        }\r\n    }\r\n    PushImpl.init = init;\r\n    function open(socketClientId) {\r\n        var _a, _b;\r\n        getSocket((_b = (_a = PushImpl.components) === null || _a === void 0 ? void 0 : _a[socketClientId]) === null || _b === void 0 ? void 0 : _b.channelToken).open();\r\n    }\r\n    PushImpl.open = open;\r\n    function close(socketClientId) {\r\n        var _a;\r\n        getSocket((_a = PushImpl.components) === null || _a === void 0 ? void 0 : _a[socketClientId].channelToken).close();\r\n    }\r\n    PushImpl.close = close;\r\n    // Private helper classes\r\n    // Private classes functions ----------------------------------------------------------------------------------\r\n    /**\r\n     * Creates a reconnecting web socket. When the web socket successfully connects on first attempt, then it will\r\n     * automatically reconnect on timeout with cumulative intervals of 500ms with a maximum of 25 attempts (~3 minutes).\r\n     * The <code>onclose</code> function will be called with the error code of the last attempt.\r\n     * @constructor\r\n     * @param {string} channelToken the channel token associated with this websocket connection\r\n     * @param {string} url The URL of the web socket\r\n     * @param {string} channel The name of the web socket channel.\r\n     */\r\n    var Socket = /** @class */ (function () {\r\n        function Socket(channelToken, url, channel) {\r\n            this.channelToken = channelToken;\r\n            this.url = url;\r\n            this.channel = channel;\r\n            this.reconnectAttempts = 0;\r\n        }\r\n        Socket.prototype.open = function () {\r\n            if (this.socket && this.socket.readyState == 1) {\r\n                return;\r\n            }\r\n            this.socket = new WebSocket(this.url);\r\n            this.bindCallbacks();\r\n        };\r\n        Socket.prototype.onopen = function (event) {\r\n            if (!this.reconnectAttempts) {\r\n                var clientIds = PushImpl.clientIdsByTokens[this.channelToken];\r\n                for (var i = clientIds.length - 1; i >= 0; i--) {\r\n                    var socketClientId = clientIds[i];\r\n                    PushImpl.components[socketClientId]['onopen'](this.channel);\r\n                }\r\n            }\r\n            this.reconnectAttempts = 0;\r\n        };\r\n        Socket.prototype.onmmessage = function (event) {\r\n            var message = JSON.parse(event.data);\r\n            for (var i = PushImpl.clientIdsByTokens[this.channelToken].length - 1; i >= 0; i--) {\r\n                var socketClientId = PushImpl.clientIdsByTokens[this.channelToken][i];\r\n                if (document.getElementById(socketClientId)) {\r\n                    try {\r\n                        PushImpl.components[socketClientId]['onmessage'](message, this.channel, event);\r\n                    }\r\n                    catch (e) {\r\n                        //Ignore\r\n                    }\r\n                    var behaviors = PushImpl.components[socketClientId]['behaviors'];\r\n                    var functions = behaviors[message];\r\n                    if (functions && functions.length) {\r\n                        for (var j = 0; j < functions.length; j++) {\r\n                            try {\r\n                                functions[j](null);\r\n                            }\r\n                            catch (e) {\r\n                                //Ignore\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    PushImpl.clientIdsByTokens[this.channelToken].splice(i, 1);\r\n                }\r\n            }\r\n            if (PushImpl.clientIdsByTokens[this.channelToken].length == 0) {\r\n                //tag dissapeared\r\n                this.close();\r\n            }\r\n        };\r\n        Socket.prototype.onclose = function (event) {\r\n            var _a, _b;\r\n            if (!this.socket\r\n                || (event.code == 1000 && event.reason == Const_1.Const.REASON_EXPIRED)\r\n                || (event.code == 1008)\r\n                || (!this.reconnectAttempts)\r\n                || (this.reconnectAttempts >= Const_1.Const.MAX_RECONNECT_ATTEMPTS)) {\r\n                var clientIds = PushImpl.clientIdsByTokens[this.channelToken];\r\n                for (var i = clientIds.length - 1; i >= 0; i--) {\r\n                    var socketClientId = clientIds[i];\r\n                    PushImpl.components[socketClientId]['onclose']((_a = event) === null || _a === void 0 ? void 0 : _a.code, (_b = this) === null || _b === void 0 ? void 0 : _b.channel, event);\r\n                }\r\n            }\r\n            else {\r\n                setTimeout(this.open, Const_1.Const.RECONNECT_INTERVAL * this.reconnectAttempts++);\r\n            }\r\n        };\r\n        ;\r\n        Socket.prototype.close = function () {\r\n            if (this.socket) {\r\n                var s = this.socket;\r\n                this.socket = null;\r\n                s.close();\r\n            }\r\n        };\r\n        /**\r\n         * bind the callbacks to the socket callbacks\r\n         */\r\n        Socket.prototype.bindCallbacks = function () {\r\n            var _this = this;\r\n            this.socket.onopen = function (event) { return _this.onopen(event); };\r\n            this.socket.onmessage = function (event) { return _this.onmmessage(event); };\r\n            this.socket.onclose = function (event) { return _this.onclose(event); };\r\n        };\r\n        return Socket;\r\n    }());\r\n    // Private static functions ---------------------------------------------------------------------------------------\r\n    function getBaseURL(url) {\r\n        if (url.indexOf(\"://\") < 0) {\r\n            var base = window.location.hostname + \":\" + window.location.port;\r\n            return URL_PROTOCOL + base + url;\r\n        }\r\n        else {\r\n            return url;\r\n        }\r\n    }\r\n    /**\r\n     * Get socket associated with given channelToken.\r\n     * @param {string} channelToken The name of the web socket channelToken.\r\n     * @return {Socket} Socket associated with given channelToken.\r\n     * @throws {Error} When channelToken is unknown, you may need to initialize\r\n     *                 it first via <code>init()</code> function.\r\n     */\r\n    function getSocket(channelToken) {\r\n        var socket = PushImpl.sockets[channelToken];\r\n        if (socket) {\r\n            return socket;\r\n        }\r\n        else {\r\n            throw new Error(\"Unknown channelToken: \" + channelToken);\r\n        }\r\n    }\r\n    function resolveFunction(fn) {\r\n        if (fn === void 0) { fn = function () {\r\n        }; }\r\n        return ((typeof fn !== \"function\") && (fn = window[fn]), fn);\r\n    }\r\n})(PushImpl = exports.PushImpl || (exports.PushImpl = {}));\r\n"],"sourceRoot":""}